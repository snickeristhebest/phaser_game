/**
 * @license
 * Phaser Box2D v1.1.0
 * Wednesday 1 January 2025 at 15:57
 * 
 * This library includes code that is ported from the original C version. The original C code is Copyright 2023 Erin Catto
 * and was released under the MIT license. The JavaScript port of the C code along with all additional code is
 * Copyright 2025 Phaser Studio Inc and is released under the MIT license.
 */

function Ye(t){let e=Yt(t);if(e<Xt)return{length:0,normal:new g(0,0)};let o=1/e;return{length:e,normal:new g(o*t.x,o*t.y)}}var Co=3.14159265359,Xt=1e-10,wn=Xt*Xt,Ne={b2Vec2Count:0,b2Rot2Count:0,b2ManifoldCount:0,b2ManifoldPointCount:0,b2FrameCount:0,b2PolyCollideCount:0,b2ContactSimCount:0,b2TOIInputCount:0,b2ShapeCastPairInputCount:0,b2SweepCount:0},v2={calls:{}},J2={calls:{}},M2={calls:{}};var g=class t{constructor(e=0,o=0){this.x=e,this.y=o}copy(e){return this.x=e.x,this.y=e.y,this}clone(){return new t(this.x,this.y)}},rt=class t{constructor(e=1,o=0){this.c=e,this.s=o}copy(e){return this.c=e.c,this.s=e.s,this}clone(){return new t(this.c,this.s)}},at=class t{constructor(e=null,o=null){this.p=e,this.q=o}static identity(){return new t(new g,new rt)}clone(){return new t(this.p,this.q)}deepClone(){return new t(this.p.clone(),this.q.clone())}},ao=class t{constructor(e=new g,o=new g){this.cx=e,this.cy=o}clone(){return new t(this.cx.clone(),this.cy.clone())}},xt=class{constructor(e=0,o=0,n=0,s=0){this.lowerBoundX=e,this.lowerBoundY=o,this.upperBoundX=n,this.upperBoundY=s}};function D2(t,e){return t<e?t:e}function P2(t,e){return t>e?t:e}function k2(t){return t<0?-t:t}function ht(t,e,o){return t<e?e:t>o?o:t}function T2(t,e){return t<e?t:e}function G2(t,e){return t>e?t:e}function R2(t){return t<0?-t:t}function L2(t,e,o){return t<e?e:t>o?o:t}function j(t,e){return t.x*e.x+t.y*e.y}function z(t,e){return t.x*e.y-t.y*e.x}function Oo(t,e){return new g(e*t.y,-e*t.x)}function Gt(t,e){return new g(-t*e.y,t*e.x)}function le(t){return new g(-t.y,t.x)}function de(t){return new g(t.y,-t.x)}function U(t,e){return new g(t.x+e.x,t.y+e.y)}function J(t,e){return new g(t.x-e.x,t.y-e.y)}function Ht(t){return new g(-t.x,-t.y)}function $t(t,e,o){return new g((1-o)*t.x+o*e.x,(1-o)*t.y+o*e.y)}function E2(t,e){return new g(t.x*e.x,t.y*e.y)}function it(t,e){return new g(t*e.x,t*e.y)}function $(t,e,o){return new g(t.x+e*o.x,t.y+e*o.y)}function wi(t,e,o,n){n.x=t.x+e*o.x,n.y=t.y+e*o.y}function yt(t,e,o){return new g(t.x-e*o.x,t.y-e*o.y)}function Ma(t,e,o){let n=t.x-e.x,s=t.y-e.y;return n*o.x+s*o.y}function nr(t){return new g(Math.abs(t.x),Math.abs(t.y))}function vi(t,e){return new g(Math.min(t.x,e.x),Math.min(t.y,e.y))}function Ji(t,e){return new g(Math.max(t.x,e.x),Math.max(t.y,e.y))}function j2(t,e,o){return new g(ht(t.x,e.x,o.x),ht(t.y,e.y,o.y))}function Yt(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function Da(t,e){return Math.sqrt(t*t+e*e)}function be(t){return t.x*t.x+t.y*t.y}function os(t,e){let o=e.x-t.x,n=e.y-t.y;return Math.sqrt(o*o+n*n)}function pe(t,e){let o=e.x-t.x,n=e.y-t.y;return o*o+n*n}function Mi(t){return new rt(Math.cos(t),Math.sin(t))}function sr(t){let e=Math.sqrt(t.s*t.s+t.c*t.c),o=e>0?1/e:0;return new rt(t.c*o,t.s*o)}function F2(t,e){let o=Math.sqrt(e*e+t*t);return o>0?1/o:0}function Ci(t){let e=t.s*t.s+t.c*t.c;return 1-6e-4<e&&e<1+6e-4}function Di(t,e,o){let n=1-o,s=new rt(n*t.c+o*e.c,n*t.s+o*e.s);return sr(s)}function X2(t,e){let o=t.c-e*t.s,n=t.s+e*t.c,s=Math.sqrt(n*n+o*o),r=s>0?1/s:0;return new rt(o*r,n*r)}function q2(t,e,o){let n=t.c-e*t.s,s=t.s+e*t.c,r=Math.sqrt(s*s+n*n),i=r>0?1/r:0;o.c=n*i,o.s=s*i}function V2(t,e,o){return o*(e.s*t.c-e.c*t.s)}function Y2(t){return Math.atan2(t.s,t.c)}function N2(t){return new g(t.c,t.s)}function W2(t){return new g(-t.s,t.c)}function Pa(t,e){return new rt(t.c*e.c-t.s*e.s,t.s*e.c+t.c*e.s)}function O2(t,e){return t.c*e.c-t.s*e.s}function U2(t,e){return t.s*e.c+t.c*e.s}function z2(t,e){return new rt(t.c*e.c+t.s*e.s,t.c*e.s-t.s*e.c)}function oe(t,e){let o=t.s*e.c-t.c*e.s,n=t.c*e.c+t.s*e.s;return Math.atan2(o,n)}function wo(t){return t<-Co?t+2*Co:t>Co?t-2*Co:t}function K(t,e){return new g(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)}function Ie(t,e){return new g(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)}function H(t,e){let o=t.q.c*e.x-t.q.s*e.y+t.p.x,n=t.q.s*e.x+t.q.c*e.y+t.p.y;return new g(o,n)}function Se(t,e,o){let n=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;o.x=n,o.y=s}function K2(t,e,o){o.p.x=t.q.c*e.x-t.q.s*e.y+t.p.x,o.p.y=t.q.s*e.x+t.q.c*e.y+t.p.y,o.q.c=t.q.c,o.q.s=t.q.s}function Re(t,e){let o=e.x-t.p.x,n=e.y-t.p.y;return new g(t.q.c*o+t.q.s*n,-t.q.s*o+t.q.c*n)}function H2(t,e){let o=new at;return o.q=Pa(t.q,e.q),o.p=U(K(t.q,e.p),t.p),o}function Pi(t,e){let o=new at(new g,new rt);o.q.c=t.q.c*e.q.c+t.q.s*e.q.s,o.q.s=t.q.c*e.q.s-t.q.s*e.q.c;let n=e.p.x-t.p.x,s=e.p.y-t.p.y;return o.p.x=t.q.c*n+t.q.s*s,o.p.y=-t.q.s*n+t.q.c*s,o}function Uo(t,e,o){let n=o;n.q.c=t.q.c*e.q.c+t.q.s*e.q.s,n.q.s=t.q.c*e.q.s-t.q.s*e.q.c;let s=e.p.x-t.p.x,r=e.p.y-t.p.y;n.p.x=t.q.c*s+t.q.s*r,n.p.y=-t.q.s*s+t.q.c*r}function ns(t,e){return new g(t.cx.x*e.x+t.cy.x*e.y,t.cx.y*e.x+t.cy.y*e.y)}function ss(t){let e=t.cx.x,o=t.cy.x,n=t.cx.y,s=t.cy.y,r=e*s-o*n;return r!==0&&(r=1/r),new ao(new g(r*s,-r*n),new g(-r*o,r*e))}function zo(t,e){let o=t.cx.x,n=t.cy.x,s=t.cx.y,r=t.cy.y,i=o*r-n*s;return i!==0&&(i=1/i),new g(i*(r*e.x-n*e.y),i*(o*e.y-s*e.x))}function vo(t,e){return t.lowerBoundX<=e.lowerBoundX&&t.lowerBoundY<=e.lowerBoundY&&e.upperBoundX<=t.upperBoundX&&e.upperBoundY<=t.upperBoundY}function Le(t){return new g(.5*(t.lowerBoundX+t.upperBoundX),.5*(t.lowerBoundY+t.upperBoundY))}function rs(t){return new g(.5*(t.upperBoundX-t.lowerBoundX),.5*(t.upperBoundY-t.lowerBoundY))}function qt(t,e){let o=new xt;return o.lowerBoundX=Math.min(t.lowerBoundX,e.lowerBoundX),o.lowerBoundY=Math.min(t.lowerBoundY,e.lowerBoundY),o.upperBoundX=Math.max(t.upperBoundX,e.upperBoundX),o.upperBoundY=Math.max(t.upperBoundY,e.upperBoundY),o}function ae(t){return isFinite(t)&&!isNaN(t)}function rr(t){return t&&ae(t.x)&&ae(t.y)}function $2(t){return t&&ae(t.s)&&ae(t.c)&&Ci(t)}function ka(t){if(!t)return!1;let e=t.upperBoundX-t.lowerBoundX,o=t.upperBoundY-t.lowerBoundY;return e>=0&&o>=0&&ae(t.lowerBoundX)&&ae(t.lowerBoundY)&&ae(t.upperBoundX)&&ae(t.upperBoundY)}function dt(t){let e=Yt(t);if(e>Xt){let o=1/e;return new g(t.x*o,t.y*o)}return new g(0,0)}function ki(t){let o=1/Yt(t);return new g(t.x*o,t.y*o)}var Ti=class{constructor(e=0,o=0,n=0){this.major=e,this.minor=o,this.revision=n}};var Z2=1,x=-1;function Ta(t){Z2=t}function Ga(){return Z2}function Ra(t){}function La(){return new Ti(3,0,0)}var We=1,De=1e5*We,te=2,It=.005*We;var th=.25*Math.PI,Qt=4*It,vn=.1*We,eh=.5;function oh(){}function nh(){}function sh(){}function rh(){}function ih(){}function ah(t){}function ch(t){}function lh(){}var Jo=class{constructor(e=0,o=0){this.index1=e,this.revision=o}},Ee=class{constructor(e=0,o=0,n=0){this.index1=e,this.world0=o,this.revision=n}},St=class{constructor(e=0,o=0,n=0){this.index1=e,this.world0=o,this.revision=n}},zt=class{constructor(e=0,o=0,n=0){this.index1=e,this.world0=o,this.revision=n}},Mo=class{constructor(e=0,o=0,n=0){this.index1=e,this.world0=o,this.revision=n}};function dh(t){return t.index1===0}function bh(t){return t.index1!==0}function ph(t,e){return t.index1===e.index1&&t.world0===e.world0&&t.revision===e.revision}var Ce=8;var Pn=4294967295,Po=class{constructor(){this.origin=null,this.translation=null,this.maxFraction=0}},Ko=class{constructor(){this.points=[],this.count=0,this.radius=0,this.translation=null,this.maxFraction=0}},me=class{constructor(e=null,o=null){this.normal=e,this.point=o,this.fraction=0,this.iterations=0,this.hit=!1}},je=class{constructor(){this.mass=0,this.center=null,this.rotationalInertia=0}},ce=class{constructor(e=null,o=0){this.center=e,this.center||(this.center=new g(0,0)),this.radius=o}},_e=class{constructor(){this.center1=null,this.center2=null,this.radius=0}},ge=class{constructor(e){e>0?(this.vertices=new Array(e).fill().map(()=>new g(0,0)),this.normals=new Array(e).fill().map(()=>new g(0,0))):(this.vertices=[],this.normals=[]),this.centroid=null,this.radius=0,this.count=0}},Oe=class{constructor(e=null,o=null){this.point1=e,this.point2=o}},Ue=class{constructor(){this.ghost1=null,this.segment=null,this.ghost2=null,this.chainId=0}},Jn=class{constructor(){this.points=[],this.count=0}},is=class{constructor(){this.closest1=null,this.closest2=null,this.fraction1=0,this.fraction2=0,this.distanceSquared=0}},Pe=class t{constructor(e=[],o=null,n=0){this.points=e,this.count=o,this.radius=n}clone(){let e=[];for(let o=0,n=this.points.length;o<n;o++)e.push(this.points[o]);return new t(e,this.count,this.radius)}},ye=class t{constructor(){this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}clone(){let e=new t;return e.count=this.count,e.indexA=[...this.indexA],e.indexB=[...this.indexB],e}},ue=class{constructor(){this.proxyA=new Pe,this.proxyB=new Pe,this.transformA=new at(new g(0,0),new rt(0,0)),this.transformB=new at(new g(0,0),new rt(0,0)),this.useRadii=!1}},as=class{constructor(){this.pointA=new g(0,0),this.pointB=new g(0,0),this.distance=0,this.iterations=0,this.simplexCount=0}},Do=class t{constructor(){this.wA=null,this.wB=null,this.w=null,this.a=0,this.indexA=0,this.indexB=0}clone(){let e=new t;return e.wA=this.wA.clone(),e.wB=this.wB.clone(),e.w=this.w.clone(),e.a=this.a,e.indexA=this.indexA,e.indexB=this.indexB,e}},Mn=class{constructor(){this.v1=new Do,this.v2=new Do,this.v3=new Do,this.count=0}},co=class{constructor(){this.proxyA=new Pe,this.proxyB=new Pe,this.transformA=new at(new g(0,0),new rt(0,0)),this.transformB=new at(new g(0,0),new rt(0,0)),this.translationB=new g(0,0),this.maxFraction=0}},lo=class t{constructor(e=null,o=null,n=null,s=null,r=null){this.localCenter=e,this.c1=o,this.c2=n,this.q1=s,this.q2=r}clone(){return new t(this.localCenter.clone(),this.c1.clone(),this.c2.clone(),this.q1.clone(),this.q2.clone())}},cs=class t{constructor(e=null,o=null,n=null,s=null,r=0){this.proxyA=e,this.proxyB=o,this.sweepA=n,this.sweepB=s,this.tMax=r}clone(){return new t(this.proxyA.clone(),this.proxyB.clone(),this.sweepA.clone(),this.sweepB.clone(),this.tMax)}},Go={b2_toiStateUnknown:0,b2_toiStateFailed:1,b2_toiStateOverlapped:2,b2_toiStateHit:3,b2_toiStateSeparated:4},ls=class{constructor(){this.state=Go.b2_toiStateUnknown,this.t=0}},ko=class t{constructor(){this.pointX=0,this.pointY=0,this.anchorAX=0,this.anchorAY=0,this.anchorBX=0,this.anchorBY=0,this.separation=0,this.normalImpulse=0,this.tangentImpulse=0,this.maxNormalImpulse=0,this.normalVelocity=0,this.id=0,this.persisted=!1}clone(){let e=new t;return e.pointX=this.pointX,e.pointY=this.pointY,e.anchorAX=this.anchorAX,e.anchorAY=this.anchorAY,e.anchorBX=this.anchorBX,e.anchorBY=this.anchorBY,e.separation=this.separation,e.normalImpulse=this.normalImpulse,e.tangentImpulse=this.tangentImpulse,e.maxNormalImpulse=this.maxNormalImpulse,e.normalVelocity=this.normalVelocity,e.id=this.id,e.persisted=this.persisted,e}clear(){return this.pointX=0,this.pointY=0,this.anchorAX=0,this.anchorAY=0,this.anchorBX=0,this.anchorBY=0,this.separation=0,this.normalImpulse=0,this.tangentImpulse=0,this.maxNormalImpulse=0,this.normalVelocity=0,this.id=0,this.persisted=!1,this}copyTo(e){e.pointX=this.pointX,e.pointY=this.pointY,e.anchorAX=this.anchorAX,e.anchorAY=this.anchorAY,e.anchorBX=this.anchorBX,e.anchorBY=this.anchorBY,e.separation=this.separation,e.normalImpulse=this.normalImpulse,e.tangentImpulse=this.tangentImpulse,e.maxNormalImpulse=this.maxNormalImpulse,e.normalVelocity=this.normalVelocity,e.id=this.id,e.persisted=this.persisted}},To=class t{constructor(e=new ko,o=new ko){this.points=[e,o],this.normalX=this.normalY=0,this.pointCount=0}clone(){let e=new t;return this.copyTo(e),e}clear(){return this.points[0]&&this.points[0].clear(),this.points[1]&&this.points[1].clear(),this.normalX=this.normalY=0,this.pointCount=0,this}copyTo(e){this.points[0].copyTo(e.points[0]),this.points[1].copyTo(e.points[1]),e.normalX=this.normalX,e.normalY=this.normalY,e.pointCount=this.pointCount}},Dn=class{constructor(){this.aabb=null,this.categoryBits=0,this.parent_next=x,this.child1=x,this.child2=x,this.userData=0,this.height=-1,this.enlarged=!1}};function Gi(){return new Map}function Ri(t){t.clear()}function Ea(t){t.clear()}function Li(t,e){return t.has(e)}function ir(t,e){return t.has(e)?!0:(t.set(e,1),!1)}function ar(t,e){return t.delete(e)}var cr=(t,e)=>t<e?BigInt(t)<<32n|BigInt(e):BigInt(e)<<32n|BigInt(t);var ds=class{constructor(){this.data=null,this.entries=null}},ja=class{constructor(){this.data=null,this.name=null,this.size=0}};function Fa(t){let e=new ds;return e.data=[],e.entries=[],e}function Xa(t){t.data=null,t.entries=null}function ze(t,e,o,n=null){let s=new ja;s.size=e,s.name=o,s.data=[];for(let r=0;r<e;r++)n?s.data.push(n()):s.data.push(null);return t.entries.push(s),s.data}function Ke(t,e){let o=t.entries.length,n=t.entries[o-1];t.entries.pop()}function bo(t,e=null){let o=[];if(e)for(let n=0;n<t;n++)o[n]=e();return o}function kn(t,e,o=null){let n=t.length;if(o)for(let s=n;s<e;s++)t[s]=o();return t}var po=!1;function lr(){let t=new bs;return t.gravity=new g(0,-10),t.hitEventThreshold=1*We,t.restitutionThreshold=10*We,t.contactPushoutVelocity=5*We,t.contactHertz=30,t.contactDampingRatio=10,t.jointHertz=60,t.jointDampingRatio=5,t.maximumLinearVelocity=400*We,t.enableSleep=!0,t.enableContinuous=!0,t}function Fe(){let t=new ps;return t.type=tt.b2_staticBody,t.position=new g(0,0),t.rotation=new rt(1,0),t.linearVelocity=new g(0,0),t.angularVelocity=0,t.linearDamping=0,t.angularDamping=0,t.gravityScale=1,t.sleepThreshold=.05*We,t.userData=null,t.enableSleep=!0,t.isAwake=!0,t.fixedRotation=!1,t.isBullet=!1,t.isEnabled=!0,t.updateBodyMass=!0,t.allowFastRotation=!1,t}function dr(){let t=new uo;return t.categoryBits=1,t.maskBits=4294967295,t.groupIndex=0,t}function qa(){let t=new ms;return t.categoryBits=1,t.maskBits=4294967295,t}function fe(){let t=new us;return t.friction=.6,t.density=1,t.restitution=.1,t.filter=dr(),t.enableSensorEvents=!0,t.enableContactEvents=!0,t}function Va(){let t=new hs;return t.friction=.6,t.filter=dr(),t}var tt={b2_staticBody:0,b2_kinematicBody:1,b2_dynamicBody:2,b2_bodyTypeCount:3},Y={b2_circleShape:0,b2_capsuleShape:1,b2_segmentShape:2,b2_polygonShape:3,b2_chainSegmentShape:4,b2_shapeTypeCount:5},k={b2_distanceJoint:0,b2_motorJoint:1,b2_mouseJoint:2,b2_prismaticJoint:3,b2_revoluteJoint:4,b2_weldJoint:5,b2_wheelJoint:6,b2_unknown:-1},ys=class{constructor(){this.shapeId=null,this.point=new g(0,0),this.normal=new g(0,0),this.fraction=0,this.hit=!1}},bs=class{constructor(){this.gravity=new g(0,0),this.restitutionThreshold=0,this.contactPushoutVelocity=0,this.hitEventThreshold=0,this.contactHertz=0,this.contactDampingRatio=0,this.jointHertz=0,this.jointDampingRatio=0,this.maximumLinearVelocity=0,this.enableSleep=!1,this.enableContinuous=!0,this.workerCount=0}},ps=class{constructor(){this.type=tt.b2_staticBody,this.position=new g(0,0),this.rotation=new rt(1,0),this.linearVelocity=new g(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.gravityScale=0,this.sleepThreshold=0,this.userData=null,this.enableSleep=!1,this.isAwake=!1,this.fixedRotation=!1,this.isBullet=!1,this.isEnabled=!1,this.updateBodyMass=!1,this.allowFastRotation=!1}},us=class{constructor(){this.userData=null,this.friction=0,this.restitution=0,this.density=0,this.filter=new uo,this.customColor=V.b2_colorAqua,this.isSensor=!1,this.enableSensorEvents=!1,this.enableContactEvents=!1,this.enableHitEvents=!1,this.enablePreSolveEvents=!1,this.forceContactCreation=!1}},hs=class{constructor(){this.userData=null,this.points=null,this.count=0,this.friction=0,this.restitution=0,this.filter=new uo,this.isLoop=!1}},Ho=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new g(0,0),this.localAnchorB=new g(0,0),this.length=0,this.enableSpring=!1,this.hertz=0,this.dampingRatio=0,this.enableLimit=!1,this.minLength=0,this.maxLength=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0,this.collideConnected=!1,this.userData=null}},$o=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.linearOffset=new g(0,0),this.angularOffset=0,this.maxForce=0,this.maxTorque=0,this.correctionFactor=0,this.collideConnected=!1,this.userData=null}},Qo=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.target=new g(0,0),this.hertz=0,this.dampingRatio=0,this.maxForce=0,this.collideConnected=!1,this.userData=null}},Zo=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new g(0,0),this.localAnchorB=new g(0,0),this.localAxisA=new g(0,0),this.referenceAngle=0,this.enableSpring=!1,this.hertz=0,this.dampingRatio=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0,this.collideConnected=!1,this.userData=null}},ho=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new g(0,0),this.localAnchorB=new g(0,0),this.referenceAngle=0,this.enableSpring=!1,this.hertz=0,this.dampingRatio=0,this.enableLimit=!1,this.lowerAngle=0,this.upperAngle=0,this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.drawSize=0,this.collideConnected=!1,this.userData=null}},tn=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new g(0,0),this.localAnchorB=new g(0,0),this.referenceAngle=0,this.linearHertz=0,this.angularHertz=0,this.linearDampingRatio=0,this.angularDampingRatio=0,this.collideConnected=!1,this.userData=null}},en=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new g(0,0),this.localAnchorB=new g(0,0),this.localAxisA=new g(0,0),this.enableSpring=!1,this.hertz=0,this.dampingRatio=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.collideConnected=!1,this.userData=null}},br=class{constructor(){this.sensorShapeId=null,this.visitorShapeId=null}},Tn=class{constructor(){this.sensorShapeId=null,this.visitorShapeId=null}},Gn=class{constructor(){this.beginEvents=null,this.endEvents=null,this.beginCount=0,this.endCount=0}},Ei=class{constructor(){this.shapeIdA=null,this.shapeIdB=null,this.manifold=null}},Rn=class{constructor(e=null,o=null){this.shapeIdA=e,this.shapeIdB=o}},ji=class{constructor(){this.shapeIdA=null,this.shapeIdB=null,this.pointX=0,this.pointY=0,this.normalX=0,this.normalY=0,this.approachSpeed=0}},Ln=class{constructor(){this.beginEvents=null,this.endEvents=null,this.hitEvents=null,this.beginCount=0,this.endCount=0,this.hitCount=0}},Fi=class{constructor(){this.transform=null,this.bodyId=null,this.userData=null,this.fellAsleep=!1}},En=class{constructor(){this.moveEvents=null,this.moveCount=0}},Xi=class{constructor(){this.shapeIdA=null,this.shapeIdB=null,this.manifold=null}},V={b2_colorAliceBlue:15792383,b2_colorAntiqueWhite:16444375,b2_colorAqua:65535,b2_colorAquamarine:8388564,b2_colorAzure:15794175,b2_colorBeige:16119260,b2_colorBisque:16770244,b2_colorBlack:1,b2_colorBlanchedAlmond:16772045,b2_colorBlue:255,b2_colorBlueViolet:9055202,b2_colorBrown:10824234,b2_colorBurlywood:14596231,b2_colorCadetBlue:6266528,b2_colorChartreuse:8388352,b2_colorChocolate:13789470,b2_colorCoral:16744272,b2_colorCornflowerBlue:6591981,b2_colorCornsilk:16775388,b2_colorCrimson:14423100,b2_colorCyan:65535,b2_colorDarkBlue:139,b2_colorDarkCyan:35723,b2_colorDarkGoldenrod:12092939,b2_colorDarkGray:11119017,b2_colorDarkGreen:25600,b2_colorDarkKhaki:12433259,b2_colorDarkMagenta:9109643,b2_colorDarkOliveGreen:5597999,b2_colorDarkOrange:16747520,b2_colorDarkOrchid:10040012,b2_colorDarkRed:9109504,b2_colorDarkSalmon:15308410,b2_colorDarkSeaGreen:9419919,b2_colorDarkSlateBlue:4734347,b2_colorDarkSlateGray:3100495,b2_colorDarkTurquoise:52945,b2_colorDarkViolet:9699539,b2_colorDeepPink:16716947,b2_colorDeepSkyBlue:49151,b2_colorDimGray:6908265,b2_colorDodgerBlue:2003199,b2_colorFirebrick:11674146,b2_colorFloralWhite:16775920,b2_colorForestGreen:2263842,b2_colorFuchsia:16711935,b2_colorGainsboro:14474460,b2_colorGhostWhite:16316671,b2_colorGold:16766720,b2_colorGoldenrod:14329120,b2_colorGray:12500670,b2_colorGray1:1710618,b2_colorGray2:3355443,b2_colorGray3:5066061,b2_colorGray4:6710886,b2_colorGray5:8355711,b2_colorGray6:10066329,b2_colorGray7:11776947,b2_colorGray8:13421772,b2_colorGray9:15066597,b2_colorGreen:65280,b2_colorGreenYellow:11403055,b2_colorHoneydew:15794160,b2_colorHotPink:16738740,b2_colorIndianRed:13458524,b2_colorIndigo:4915330,b2_colorIvory:16777200,b2_colorKhaki:15787660,b2_colorLavender:15132410,b2_colorLavenderBlush:16773365,b2_colorLawnGreen:8190976,b2_colorLemonChiffon:16775885,b2_colorLightBlue:11393254,b2_colorLightCoral:15761536,b2_colorLightCyan:14745599,b2_colorLightGoldenrod:15654274,b2_colorLightGoldenrodYellow:16448210,b2_colorLightGray:13882323,b2_colorLightGreen:9498256,b2_colorLightPink:16758465,b2_colorLightSalmon:16752762,b2_colorLightSeaGreen:2142890,b2_colorLightSkyBlue:8900346,b2_colorLightSlateBlue:8679679,b2_colorLightSlateGray:7833753,b2_colorLightSteelBlue:11584734,b2_colorLightYellow:16777184,b2_colorLime:65280,b2_colorLimeGreen:3329330,b2_colorLinen:16445670,b2_colorMagenta:16711935,b2_colorMaroon:11546720,b2_colorMediumAquamarine:6737322,b2_colorMediumBlue:205,b2_colorMediumOrchid:12211667,b2_colorMediumPurple:9662683,b2_colorMediumSeaGreen:3978097,b2_colorMediumSlateBlue:8087790,b2_colorMediumSpringGreen:64154,b2_colorMediumTurquoise:4772300,b2_colorMediumVioletRed:13047173,b2_colorMidnightBlue:1644912,b2_colorMintCream:16121850,b2_colorMistyRose:16770273,b2_colorMoccasin:16770229,b2_colorNavajoWhite:16768685,b2_colorNavy:128,b2_colorNavyBlue:128,b2_colorOldLace:16643558,b2_colorOlive:8421376,b2_colorOliveDrab:7048739,b2_colorOrange:16753920,b2_colorOrangeRed:16729344,b2_colorOrchid:14315734,b2_colorPaleGoldenrod:15657130,b2_colorPaleGreen:10025880,b2_colorPaleTurquoise:11529966,b2_colorPaleVioletRed:14381203,b2_colorPapayaWhip:16773077,b2_colorPeachPuff:16767673,b2_colorPeru:13468991,b2_colorPink:16761035,b2_colorPlum:14524637,b2_colorPowderBlue:11591910,b2_colorPurple:10494192,b2_colorRebeccaPurple:6697881,b2_colorRed:16711680,b2_colorRosyBrown:12357519,b2_colorRoyalBlue:4286945,b2_colorSaddleBrown:9127187,b2_colorSalmon:16416882,b2_colorSandyBrown:16032864,b2_colorSeaGreen:3050327,b2_colorSeashell:16774638,b2_colorSienna:10506797,b2_colorSilver:12632256,b2_colorSkyBlue:8900331,b2_colorSlateBlue:6970061,b2_colorSlateGray:7372944,b2_colorSnow:16775930,b2_colorSpringGreen:65407,b2_colorSteelBlue:4620980,b2_colorTan:13808780,b2_colorTeal:32896,b2_colorThistle:14204888,b2_colorTomato:16737095,b2_colorTurquoise:4251856,b2_colorViolet:15631086,b2_colorVioletRed:13639824,b2_colorWheat:16113331,b2_colorWhite:16777215,b2_colorWhiteSmoke:16119285,b2_colorYellow:16776960,b2_colorYellowGreen:10145074,b2_colorBox2DRed:14430514,b2_colorBox2DBlue:3190463,b2_colorBox2DGreen:9226532,b2_colorBox2DYellow:16772748},pr=class{constructor(){this.DrawPolygon=null,this.DrawImagePolygon=null,this.DrawSolidPolygon=null,this.DrawCircle=null,this.DrawImageCircle=null,this.DrawSolidCircle=null,this.DrawCapsule=null,this.DrawImageCapsule=null,this.DrawSolidCapsule=null,this.DrawSegment=null,this.DrawTransform=null,this.DrawPoint=null,this.DrawString=null,this.SetPosition=null,this.drawingBounds=new xt,this.useDrawingBounds=!1,this.positionOffset=new g,this.drawShapes=!0,this.drawJoints=!1,this.drawAABBs=!1,this.drawMass=!1,this.drawContacts=!1,this.drawGraphColors=!1,this.drawContactNormals=!1,this.drawContactImpulses=!1,this.drawFrictionImpulses=!1,this.context=null}},uo=class{constructor(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}},ms=class{constructor(){this.categoryBits=65535,this.maskBits=65535}};var qi=class{constructor(e){this.name=e,this.freeArray=[],this.nextIndex=0}};function fs(t){return t.nextIndex}function Ro(t="pool"){return new qi(t)}function Lo(t){t.freeArray=null,t.nextIndex=0}function ne(t){if(t.freeArray.length>0)return t.freeArray.pop();let e=t.nextIndex;return t.nextIndex++,e}function xe(t,e){if(e===t.nextIndex-1){t.nextIndex--;return}t.freeArray.push(e)}function on(t){return t.nextIndex-t.freeArray.length}function we(t,e){let o=new at;o.p=U(it(1-e,t.c1),it(e,t.c2));let n=new rt((1-e)*t.q1.c+e*t.q2.c,(1-e)*t.q1.s+e*t.q2.s);return o.q=sr(n),o.p=J(o.p,K(o.q,t.localCenter)),o}var xs=new is;function hr(t,e,o,n,s,r,i,c){let a=0,l=0,d=o-t,p=n-e,b=i-s,u=c-r,h=t-s,m=e-r,f=d*d+p*p,y=b*b+u*u,I=h*b+m*u,C=h*d+m*p;if(f<wn||y<wn)f>=wn?(a=ht(-C/f,0,1),l=0):y>=wn&&(a=0,l=ht(I/y,0,1));else{let P=d*b+p*u,T=f*y-P*P,R=0;T!==0&&(R=ht((P*I-C*y)/T,0,1));let X=(P*R+I)/y;X<0?(X=0,R=ht(-C/f,0,1)):X>1&&(X=1,R=ht((P-C)/f,0,1)),a=R,l=X}let _=t+a*d,S=e+a*p,A=s+l*b,B=r+l*u,w=_-A,D=S-B,v=w*w+D*D;return xs.closest1=xs.closest2=null,xs.fraction1=a,xs.fraction2=l,xs.distanceSquared=v,xs}function vt(t,e,o){e=Math.min(e,Ce);let n=new Pe;n.points=[],n.count=e,n.radius=o;for(let s=0;s<e;++s)n.points[s]=t[s].clone();return n}function ur(t,e,o,n){return new g(t*e.x+o*n.x,t*e.y+o*n.y)}function uh(t,e,o,n,s,r){return new g(t*e.x+o*n.x+s*r.x,t*e.y+o*n.y+s*r.y)}function mo(t,e){let o=0,n=j(t.points[0],e);for(let s=1;s<t.count;++s){let r=j(t.points[s],e);r>n&&(o=s,n=r)}return o}function um(t,e,o,n,s){let r=new Mn;r.count=t.count;let i=[r.v1,r.v2,r.v3];for(let c=0;c<r.count;++c){let a=i[c];a.indexA=t.indexA[c],a.indexB=t.indexB[c];let l=e.points[a.indexA],d=n.points[a.indexB];a.wA=H(o,l),a.wB=H(s,d),a.w=J(a.wB,a.wA),a.a=-1}if(r.count===0){let c=i[0];c.indexA=0,c.indexB=0;let a=e.points[0],l=n.points[0];c.wA=H(o,a),c.wB=H(s,l),c.w=J(c.wB,c.wA),c.a=1,r.count=1}return r}function hm(t,e){t.count=e.count;let o=[e.v1,e.v2,e.v3];for(let n=0;n<e.count;++n)t.indexA[n]=o[n].indexA,t.indexB[n]=o[n].indexB}function mm(t){switch(t.count){case 1:return Ht(t.v1.w);case 2:let e=J(t.v2.w,t.v1.w);return z(e,Ht(t.v1.w))>0?le(e):de(e);default:return new g(0,0)}}function ym(t){switch(t.count){case 0:return new g(0,0);case 1:return t.v1.w;case 2:return ur(t.v1.a,t.v1.w,t.v2.a,t.v2.w);case 3:return new g(0,0);default:return new g(0,0)}}function mh(t,e,o){switch(o.count){case 0:break;case 1:t.x=o.v1.wA.x,t.y=o.v1.wA.y,e.x=o.v1.wB.x,e.y=o.v1.wB.y;break;case 2:t.x=ur(o.v1.a,o.v1.wA,o.v2.a,o.v2.wA).x,t.y=ur(o.v1.a,o.v1.wA,o.v2.a,o.v2.wA).y,e.x=ur(o.v1.a,o.v1.wB,o.v2.a,o.v2.wB).x,e.y=ur(o.v1.a,o.v1.wB,o.v2.a,o.v2.wB).y;break;case 3:t.x=uh(o.v1.a,o.v1.wA,o.v2.a,o.v2.wA,o.v3.a,o.v3.wA).x,t.y=uh(o.v1.a,o.v1.wA,o.v2.a,o.v2.wA,o.v3.a,o.v3.wA).y,e.x=t.x,e.y=t.y;break;default:break}}function yh(t){let e=t.v1.w,o=t.v2.w,n=J(o,e),s=-j(e,n);if(s<=0){t.v1.a=1,t.count=1;return}let r=j(o,n);if(r<=0){t.v2.a=1,t.count=1,t.v1=t.v2;return}let i=1/(r+s);t.v1.a=r*i,t.v2.a=s*i,t.count=2}function fh(t){let e=t.v1.w,o=t.v2.w,n=t.v3.w,s=J(o,e),r=j(e,s),c=j(o,s),a=-r,l=J(n,e),d=j(e,l),b=j(n,l),u=-d,h=J(n,o),m=j(o,h),y=j(n,h),I=-m,C=z(s,l),_=C*z(o,n),S=C*z(n,e),A=C*z(e,o);if(a<=0&&u<=0){t.v1.a=1,t.count=1;return}if(c>0&&a>0&&A<=0){let w=1/(c+a);t.v1.a=c*w,t.v2.a=a*w,t.count=2;return}if(b>0&&u>0&&S<=0){let w=1/(b+u);t.v1.a=b*w,t.v3.a=u*w,t.count=2,t.v2=t.v3.clone();return}if(c<=0&&I<=0){t.v2.a=1,t.count=1,t.v1=t.v2.clone();return}if(b<=0&&y<=0){t.v3.a=1,t.count=1,t.v1=t.v3.clone();return}if(y>0&&I>0&&_<=0){let w=1/(y+I);t.v2.a=y*w,t.v3.a=I*w,t.count=2,t.v1=t.v3.clone();return}let B=1/(_+S+A);t.v1.a=_*B,t.v2.a=S*B,t.v3.a=A*B,t.count=3}var Is=new g;function Be(t,e,o,n){let s=new as,r=e.proxyA,i=e.proxyB,c=e.transformA,a=e.transformB,l=um(t,r,c,i,a),d=0;o!==null&&d<n&&(o[d]=l,d+=1);let p=[l.v1,l.v2,l.v3],b=20,u=[0,0,0],h=[0,0,0],m=0;for(;m<b;){let f=l.count;for(let _=0;_<f;++_)u[_]=p[_].indexA,h[_]=p[_].indexB;switch(l.count){case 1:break;case 2:yh(l);break;case 3:fh(l);break;default:break}if(l.count===3)break;o!==null&&d<n&&(o[d]=l,d+=1);let y=mm(l);if(j(y,y)<Xt*Xt)break;let I=p[l.count];I.indexA=mo(r,Ie(c.q,Ht(y))),I.wA=H(c,r.points[I.indexA]),I.indexB=mo(i,Ie(a.q,y)),I.wB=H(a,i.points[I.indexB]),I.w=J(I.wB,I.wA),++m;let C=!1;for(let _=0;_<f;++_)if(I.indexA===u[_]&&I.indexB===h[_]){C=!0;break}if(C)break;++l.count}if(o!==null&&d<n&&(o[d]=l,d+=1),mh(s.pointA,s.pointB,l),s.distance=os(s.pointA,s.pointB),s.iterations=m,s.simplexCount=d,hm(t,l),e.useRadii)if(s.distance<Xt)Is.x=.5*(s.pointA.x+s.pointB.x),Is.y=.5*(s.pointA.y+s.pointB.y),s.pointA.x=Is.x,s.pointA.y=Is.y,s.pointB.x=Is.x,s.pointB.y=Is.y,s.distance=0;else{let f=r.radius,y=i.radius;s.distance=Math.max(0,s.distance-f-y);let I=dt(J(s.pointB,s.pointA)),C=f*I.x,_=f*I.y,S=y*I.x,A=y*I.y;s.pointA.x+=C,s.pointA.y+=_,s.pointB.x-=S,s.pointB.y-=A}return s}var fm=new g(0,0),xm=new g(0,1);function jo(t){let e=new me(xm,fm);e.fraction=t.maxFraction;let o=t.proxyA,n=t.transformA,s=t.transformB,r=Pi(n,s),i=new Pe;i.count=t.proxyB.count,i.radius=t.proxyB.radius,i.points=[];for(let v=0;v<i.count;++v)i.points[v]=H(r,t.proxyB.points[v]);let c=o.radius+i.radius,a=K(r.q,t.translationB),l=0,d=t.maxFraction,p=new Mn;p.count=0,p.v1=new Do,p.v2=new Do,p.v3=new Do;let b=[p.v1,p.v2,p.v3],u=mo(o,Ht(a)),h=o.points[u],m=mo(i,a),f=i.points[m],y=J(h,f),I=.005,C=Math.max(I,c-I),_=20,S=0;for(;S<_&&Yt(y)>C+.5*I;){e.iterations+=1,u=mo(o,Ht(y)),h=o.points[u],m=mo(i,y),f=i.points[m];let v=J(h,f);y=dt(y);let P=j(y,v),T=j(y,a);if(P-C>l*T){if(T<=0||(l=(P-C)/T,l>d))return e;p.count=0}let R=b[p.count];switch(R.indexA=m,R.wA=new g(f.x+l*a.x,f.y+l*a.y),R.indexB=u,R.wB=h.clone(),R.w=J(R.wB,R.wA),R.a=1,p.count+=1,p.count){case 1:break;case 2:yh(p);break;case 3:fh(p);break;default:}if(p.count===3)return e;y=ym(p),++S}if(S===0||l===0)return e;let A=new g,B=new g;mh(B,A,p);let w=dt(Ht(y)),D=new g(A.x+o.radius*w.x,A.y+o.radius*w.y);return e.point=H(n,D),e.normal=K(n.q,w),e.fraction=l,e.iterations=S,e.hit=!0,e}var Eo={b2_pointsType:0,b2_faceAType:1,b2_faceBType:2},Ya=class{constructor(){this.proxyA=null,this.proxyB=null,this.sweepA=null,this.sweepB=null,this.localPoint=new g,this.axis=new g,this.type=0}};function Im(t,e,o,n,s,r){let i=new Ya;i.proxyA=e,i.proxyB=n;let c=t.count;i.sweepA=new lo,Object.assign(i.sweepA,o),i.sweepB=new lo,Object.assign(i.sweepB,s),i.localPoint=new g,i.axis=new g,i.type=0;let a=we(o,r),l=we(s,r);if(c===1){i.type=Eo.b2_pointsType;let y=e.points[t.indexA[0]],I=n.points[t.indexB[0]],C=H(a,y),_=H(l,I);return i.axis=dt(J(_,C)),i.localPoint=new g,i}if(t.indexA[0]===t.indexA[1]){i.type=Eo.b2_faceBType;let y=n.points[t.indexB[0]],I=n.points[t.indexB[1]];i.axis=Oo(J(I,y),1),i.axis=dt(i.axis);let C=K(l.q,i.axis);i.localPoint=new g(.5*(y.x+I.x),.5*(y.y+I.y));let _=H(l,i.localPoint),S=e.points[t.indexA[0]],A=H(a,S);return j(J(A,_),C)<0&&(i.axis=Ht(i.axis)),i}i.type=Eo.b2_faceAType;let d=e.points[t.indexA[0]],p=e.points[t.indexA[1]];i.axis=Oo(J(p,d),1),i.axis=dt(i.axis);let b=K(a.q,i.axis);i.localPoint=new g(.5*(d.x+p.x),.5*(d.y+p.y));let u=H(a,i.localPoint),h=n.points[t.indexB[0]],m=H(l,h);return j(J(m,u),b)<0&&(i.axis=Ht(i.axis)),i}var Ss=class{constructor(e,o,n){this.indexA=e,this.indexB=o,this.separation=n}};function Sm(t,e){let o=we(t.sweepA,e),n=we(t.sweepB,e);switch(t.type){case Eo.b2_pointsType:{let s=Ie(o.q,t.axis),r=Ie(n.q,Ht(t.axis)),i=mo(t.proxyA,s),c=mo(t.proxyB,r),a=t.proxyA.points[i],l=t.proxyB.points[c],d=H(o,a),p=H(n,l),b=j(J(p,d),t.axis);return new Ss(i,c,b)}case Eo.b2_faceAType:{let s=K(o.q,t.axis),r=H(o,t.localPoint),i=Ie(n.q,Ht(s)),c=-1,a=mo(t.proxyB,i),l=t.proxyB.points[a],d=H(n,l),p=j(J(d,r),s);return new Ss(c,a,p)}case Eo.b2_faceBType:{let s=K(n.q,t.axis),r=H(n,t.localPoint),i=Ie(o.q,Ht(s)),c=-1,a=mo(t.proxyA,i),l=t.proxyA.points[a],d=H(o,l),p=j(J(d,r),s);return new Ss(a,c,p)}default:return new Ss(-1,-1,0)}}function hh(t,e,o,n){let s=we(t.sweepA,n),r=we(t.sweepB,n);switch(t.type){case Eo.b2_pointsType:{let i=t.proxyA.points[e],c=t.proxyB.points[o],a=H(s,i),l=H(r,c);return j(J(l,a),t.axis)}case Eo.b2_faceAType:{let i=K(s.q,t.axis),c=H(s,t.localPoint),a=t.proxyB.points[o],l=H(r,a);return j(J(l,c),i)}case Eo.b2_faceBType:{let i=K(r.q,t.axis),c=H(r,t.localPoint),a=t.proxyA.points[e],l=H(s,a);return j(J(l,c),i)}default:return 0}}function _s(t){let e=new ls;e.state=Go.b2_toiStateUnknown,e.t=t.tMax;let o=t.proxyA,n=t.proxyB,s=t.sweepA,r=t.sweepB,i=t.tMax,c=o.radius+n.radius,a=Math.max(It,c-It),l=.25*It,d=0,p=20,b=0,u=new ye,h=new ue;for(h.proxyA=t.proxyA,h.proxyB=t.proxyB,h.useRadii=!1;;){let m=we(s,d),f=we(r,d);h.transformA=m,h.transformB=f;let y=Be(u,h,null,0);if(y.distance<=0){e.state=Go.b2_toiStateOverlapped,e.t=0;break}if(y.distance<a+l){e.state=Go.b2_toiStateHit,e.t=d;break}let I=Im(u,o,s,n,r,d),C=!1,_=i,S=0;for(;;){let A=Sm(I,_),B=A.separation,w=A.indexA,D=A.indexB;if(B>a+l){e.state=Go.b2_toiStateSeparated,e.t=i,C=!0;break}if(B>a-l){d=_;break}let v=hh(I,w,D,d);if(v<a-l){e.state=Go.b2_toiStateFailed,e.t=d,C=!0;break}if(v<=a+l){e.state=Go.b2_toiStateHit,e.t=d,C=!0;break}let P=0,T=d,R=_;for(;;){let X;P&1?X=T+(a-v)*(R-T)/(B-v):X=.5*(T+R),++P;let F=hh(I,w,D,X);if(Math.abs(F-a)<l){_=X;break}if(F>a?(T=X,v=F):(R=X,B=F),P==50)break}if(++S,S==Ce)break}if(++b,C)break;if(b==p){e.state=Go.b2_toiStateFailed,e.t=d;break}}return e}function Vi(t,e,o,n){let s=new Jn;if(n===0)return s;let r=dt(J(e,t)),i=[],c=0,a=0,l=z(J(o[a],t),r);l>0&&(i[c++]=o[a]);for(let u=1;u<n;++u){let h=z(J(o[u],t),r);h>l&&(a=u,l=h),h>0&&(i[c++]=o[u])}if(l<2*It)return s;let d=o[a],p=Vi(t,d,i,c),b=Vi(d,e,i,c);for(let u=0;u<p.count;++u)s.points[s.count++]=p.points[u];s.points[s.count++]=d;for(let u=0;u<b.count;++u)s.points[s.count++]=b.points[u];return s}function xh(t,e){let o=0;for(let n=0;n<e;n++){let s=(n+1)%e;o+=(t[s].x-t[n].x)*(t[s].y+t[n].y)}return o<0}function nn(t,e){let o=new Jn;if(e<3||e>Ce)return o;let n=new xt(Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=[],r=0,i=16*It*It;for(let A=0;A<e;++A){n.lowerBoundX=Math.min(n.lowerBoundX,t[A].x),n.lowerBoundY=Math.min(n.lowerBoundY,t[A].y),n.upperBoundX=Math.max(n.upperBoundX,t[A].x),n.upperBoundY=Math.max(n.upperBoundY,t[A].y);let B=t[A],w=!0;for(let D=0;D<A;++D){let v=t[D];if(pe(B,v)<i){w=!1;break}}w&&(s[r++]=B)}if(r<3)return o;let c=Le(n),a=0,l=pe(c,s[a]);for(let A=1;A<r;++A){let B=pe(c,s[A]);B>l&&(a=A,l=B)}let d=s[a];s[a]=s[r-1],r=r-1;let p=0,b=pe(d,s[p]);for(let A=1;A<r;++A){let B=pe(d,s[A]);B>b&&(p=A,b=B)}let u=s[p];s[p]=s[r-1],r=r-1;let h=[],m=0,f=[],y=0,I=dt(J(u,d));for(let A=0;A<r;++A){let B=z(J(s[A],d),I);B>=2*It?h[m++]=s[A]:B<=-2*It&&(f[y++]=s[A])}let C=Vi(d,u,h,m),_=Vi(u,d,f,y);if(C.count===0&&_.count===0)return o;o.points[o.count++]=d;for(let A=0;A<C.count;++A)o.points[o.count++]=C.points[A];o.points[o.count++]=u;for(let A=0;A<_.count;++A)o.points[o.count++]=_.points[A];let S=!0;for(;S&&o.count>2;){S=!1;for(let A=0;A<o.count;++A){let B=A,w=(A+1)%o.count,D=(A+2)%o.count,v=o.points[B],P=o.points[w],T=o.points[D],R=dt(J(T,v));if(z(J(P,v),R)<=2*It){for(let F=w;F<o.count-1;++F)o.points[F]=o.points[F+1];o.count-=1,S=!0;break}}}return o.count<3&&(o.count=0),o}function mr(t){if(!po)return!0;if(t.count<3||Ce<t.count||!xh(t.points,t.count))return!1;for(let e=0;e<t.count;++e){let o=e,n=e<t.count-1?o+1:0,s=t.points[o],r=dt(J(t.points[n],s));for(let i=0;i<t.count;++i){if(i===o||i===n)continue;if(z(J(t.points[i],s),r)>=0)return!1}}for(let e=0;e<t.count;++e){let o=e,n=(e+1)%t.count,s=(e+2)%t.count,r=t.points[o],i=t.points[n],c=t.points[s],a=dt(J(c,r));if(z(J(i,r),a)<=It)return!1}return!0}function Na(t){return rr(t.origin)&&rr(t.translation)&&ae(t.maxFraction)&&0<=t.maxFraction&&t.maxFraction<De}function Ih(t,e){let o=new g(0,0),n=0,s=t[0],r=1/3;for(let c=1;c<e-1;++c){let a=J(t[c],s),l=J(t[c+1],s),d=.5*z(a,l);o=$(o,d*r,U(a,l)),n+=d}let i=1/n;return o.x*=i,o.y*=i,o=U(s,o),o}function sn(t,e,o=!0){if(o&&!mr(t))return null;if(t.count<3)return xr(.5);let n=new ge;n.count=t.count,n.radius=e;for(let s=0;s<n.count;++s)n.vertices[s]=t.points[s];for(let s=0;s<n.count;++s){let r=s,i=s+1<n.count?s+1:0,c=J(n.vertices[i],n.vertices[r]);n.normals[s]=dt(Oo(c,1))}return n.centroid=Ih(n.vertices,n.count),n}function gs(t,e,o,n=!0){if(t.count<3)return xr(.5);let s=new ge;s.count=t.count,s.radius=e;for(let r=0;r<s.count;++r)s.vertices[r]=H(o,t.points[r]);for(let r=0;r<s.count;++r){let i=r,c=r+1<s.count?r+1:0,a=J(s.vertices[c],s.vertices[i]);s.normals[r]=dt(Oo(a,1))}return s.centroid=Ih(s.vertices,s.count),s}function xr(t){return Fo(t,t)}function Fo(t,e){let o=new ge;return o.count=4,o.vertices[0]=new g(-t,-e),o.vertices[1]=new g(t,-e),o.vertices[2]=new g(t,e),o.vertices[3]=new g(-t,e),o.normals[0]=new g(0,-1),o.normals[1]=new g(1,0),o.normals[2]=new g(0,1),o.normals[3]=new g(-1,0),o.radius=0,o.centroid=new g(0,0),o}function Wa(t,e,o){let n=Fo(t,e);return n.radius=o,n}function Ir(t,e,o,n=0){let s=new at;s.p=o,s.q=Mi(n);let r=new ge;return r.count=4,r.vertices[0]=H(s,new g(-t,-e)),r.vertices[1]=H(s,new g(t,-e)),r.vertices[2]=H(s,new g(t,e)),r.vertices[3]=H(s,new g(-t,e)),r.normals[0]=K(s.q,new g(0,-1)),r.normals[1]=K(s.q,new g(1,0)),r.normals[2]=K(s.q,new g(0,1)),r.normals[3]=K(s.q,new g(-1,0)),r.radius=0,r.centroid=o,r}function Oa(t,e){let o=e;for(let n=0;n<o.count;++n)o.vertices[n]=H(t,o.vertices[n]),o.normals[n]=K(t.q,o.normals[n]);return o.centroid=H(t,o.centroid),o}function Bs(t,e){let o=t.radius*t.radius,n=new je;return n.mass=e*Math.PI*o,n.center=t.center.clone(),n.rotationalInertia=n.mass*(.5*o+j(t.center,t.center)),n}function As(t,e){let o=t.radius,n=o*o,s=t.center1,r=t.center2,i=Yt(J(r,s)),c=i*i,a=e*Math.PI*n,l=e*(2*o*i),d=new je;d.mass=a+l,d.center=new g(.5*(s.x+r.x),.5*(s.y+r.y));let p=4*o/(3*Math.PI),b=.5*i,u=a*(.5*n+b*b+2*b*p),h=l*(4*n+c)/12;return d.rotationalInertia=u+h,d.rotationalInertia+=d.mass*j(d.center,d.center),d}function Sr(t,e){if(t.count==1){let b=new ce;return b.center=t.vertices[0].clone(),b.radius=t.radius,Bs(b,e)}if(t.count==2){let b=new _e;return b.center1=t.vertices[0].clone(),b.center2=t.vertices[1].clone(),b.radius=t.radius,As(b,e)}let o=new Array(Ce),n=t.count,s=t.radius;if(s>0)for(let u=0;u<n;++u){let h=u==0?n-1:u-1,m=t.normals[h],f=t.normals[u],y=dt(U(m,f));o[u]=$(t.vertices[u],1.412*s,y)}else for(let b=0;b<n;++b)o[b]=t.vertices[b];let r=new g(0,0),i=0,c=0,a=o[0],l=1/3;for(let b=1;b<n-1;++b){let u=J(o[b],a),h=J(o[b+1],a),m=z(u,h),f=.5*m;i+=f,r=$(r,f*l,U(u,h));let y=u.x,I=u.y,C=h.x,_=h.y,S=y*y+C*y+C*C,A=I*I+_*I+_*_;c+=.25*l*m*(S+A)}let d=new je;d.mass=e*i;let p=1/i;return r.x*=p,r.y*=p,d.center=U(a,r),d.rotationalInertia=e*c,d.rotationalInertia+=d.mass*(j(d.center,d.center)-j(r,r)),d}function jn(t,e){let o=e.q.c*t.center.x-e.q.s*t.center.y+e.p.x,n=e.q.s*t.center.x+e.q.c*t.center.y+e.p.y,s=t.radius;return new xt(o-s,n-s,o+s,n+s)}function Fn(t,e){let o=H(e,t.center1),n=H(e,t.center2),s=Math.min(o.x,n.x)-t.radius,r=Math.min(o.y,n.y)-t.radius,i=Math.max(o.x,n.x)+t.radius,c=Math.max(o.y,n.y)+t.radius;return new xt(s,r,i,c)}function Xn(t,e){let o=t.vertices[0],n=e.q.c*o.x-e.q.s*o.y+e.p.x,s=e.q.s*o.x+e.q.c*o.y+e.p.y,r=n,i=s;for(let l=1;l<t.count;++l){let d=t.vertices[l],p=e.q.c*d.x-e.q.s*d.y+e.p.x,b=e.q.s*d.x+e.q.c*d.y+e.p.y;n=Math.min(n,p),s=Math.min(s,b),r=Math.max(r,p),i=Math.max(i,b)}let c=t.radius;return n-=c,s-=c,r+=c,i+=c,new xt(n,s,r,i)}function Cs(t,e){let o=H(e,t.point1),n=H(e,t.point2),s=vi(o,n),r=Ji(o,n);return new xt(s.x,s.y,r.x,r.y)}function _r(t,e){let o=e.center;return pe(t,o)<=e.radius*e.radius}function gr(t,e){let o=e.radius*e.radius,n=e.center1,s=e.center2,r=J(s,n),i=j(r,r);if(i==0)return pe(t,n)<=o;let c=j(J(t,n),r)/i;c=ht(c,0,1);let a=$(n,c,r);return pe(t,a)<=o}function Br(t,e){let o=new ue;o.proxyA=vt(e.vertices,e.count,0),o.proxyB=vt([t],1,0),o.transformA=new at(new g(0,0),new rt(1,0)),o.transformB=new at(new g(0,0),new rt(1,0)),o.useRadii=!1;let n=new ye;return Be(n,o,null,0).distance<=e.radius}var yr=new g(0,0),fr=new g(0,1);function He(t,e){let o=e.center.clone(),n=new me(fr,yr),s=J(t.origin,o),r=Ye(t.translation),i=r.length;if(i==0)return n;let c=r.normal,a=-j(s,c),l=$(s,a,c),d=j(l,l),p=e.radius,b=p*p;if(d>b)return n;let u=Math.sqrt(b-d),h=a-u;if(h<0||t.maxFraction*i<h)return n;let m=$(s,h,c);return n.fraction=h/i,n.normal=dt(m),n.point=$(o,e.radius,n.normal),n.hit=!0,n}function ws(t,e){let o=new me(fr,yr),n=e.center1,s=e.center2,r=J(s,n),i=Ye(r),c=i.length,a=i.normal;if(c<Xt){let T=new ce;return T.center=n,T.radius=e.radius,He(t,T)}let l=t.origin,d=t.translation,p=J(l,n),b=j(p,a),u=$(p,-b,a),h=e.radius;if(j(u,u)<h*h){if(b<0){let T=new ce;return T.center=n,T.radius=e.radius,He(t,T)}if(b>1){let T=new ce;return T.center=s,T.radius=e.radius,He(t,T)}return o}let m=new g(a.y,-a.x),f=Ye(d),y=f.length,I=f.normal,C=-a.x*I.y+I.x*a.y;if(-Xt<C&&C<Xt)return o;let _=yt(p,h,m),S=$(p,h,m),A=1/C,B=(a.x*_.y-_.x*a.y)*A,w=(a.x*S.y-S.x*a.y)*A,D,v;if(B<w?(D=B,v=_):(D=w,v=S,m=Ht(m)),D<0||t.maxFraction*y<D)return o;let P=(-v.x*I.y+I.x*v.y)*A;if(P<0){let T=new ce;return T.center=n,T.radius=e.radius,He(t,T)}else if(c<P){let T=new ce;return T.center=s,T.radius=e.radius,He(t,T)}else return o.fraction=D/y,o.point=U($t(n,s,P/c),it(e.radius,m)),o.normal=m,o.hit=!0,o}function rn(t,e,o){if(o&&z(J(t.origin,e.point1),J(e.point2,e.point1))<0)return new me(fr,yr);let n=t.origin,s=t.translation,r=e.point1,i=e.point2,c=J(i,r),a=new me(fr,yr),l=Ye(c),d=l.length,p=l.normal;if(d==0)return a;let b=de(p),u=j(b,J(r,n)),h=j(b,s);if(h==0)return a;let m=u/h;if(m<0||t.maxFraction<m)return a;let f=$(n,m,s),y=j(J(f,r),p);return y<0||d<y||(u>0&&(b=Ht(b)),a.fraction=m,a.point=$(n,m,s),a.normal=b,a.hit=!0),a}function vs(t,e){if(e.radius===0){let n=t.origin,s=t.translation,r=0,i=t.maxFraction,c=-1,a=new me(fr,yr);for(let l=0;l<e.count;++l){let d=j(e.normals[l],J(e.vertices[l],n)),p=j(e.normals[l],s);if(p===0){if(d<0)return a}else p<0&&d<r*p?(r=d/p,c=l):p>0&&d<i*p&&(i=d/p);if(i<r)return a}return c>=0&&(a.fraction=r,a.normal=e.normals[c],a.point=$(n,r,s),a.hit=!0),a}let o=new co;return o.proxyA=vt(e.vertices,e.count,e.radius),o.proxyB=vt([t.origin],1,0),o.transformA=new at(new g(0,0),new rt(1,0)),o.transformB=new at(new g(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,jo(o)}function Ar(t,e){let o=new co;return o.proxyA=vt([e.center.clone()],1,e.radius),o.proxyB=vt(t.points,t.count,t.radius),o.transformA=new at(new g(0,0),new rt(1,0)),o.transformB=new at(new g(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,jo(o)}function Cr(t,e){let o=new co;return o.proxyA=vt([e.center1,e.center2],2,e.radius),o.proxyB=vt(t.points,t.count,t.radius),o.transformA=new at(new g(0,0),new rt(1,0)),o.transformB=new at(new g(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,jo(o)}function Js(t,e){let o=new co;return o.proxyA=vt([e.point1,e.point2],2,0),o.proxyB=vt(t.points,t.count,t.radius),o.transformA=new at(new g(0,0),new rt(1,0)),o.transformB=new at(new g(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,jo(o)}function wr(t,e){let o=new co;return o.proxyA=vt(e.vertices,e.count,e.radius),o.proxyB=vt(t.points,t.count,t.radius),o.transformA=new at(new g(0,0),new rt(1,0)),o.transformB=new at(new g(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,jo(o)}function Bt(t,e){let o=e.index1-1;return t.shapeArray[o]}function za(t,e){return he(t,e.bodyId)}function Sh(t,e){let o=e.index1-1;return t.chainArray[o]}function Ua(t,e,o){let n=Qt,s=vn,r=Xo(t,e);r.lowerBoundX-=n,r.lowerBoundY-=n,r.upperBoundX+=n,r.upperBoundY+=n,t.aabb=r;let i=o==tt.b2_staticBody?n:s,c=new xt(r.lowerBoundX-i,r.lowerBoundY-i,r.upperBoundX+i,r.upperBoundY+i);t.fatAABB=c}function vr(t,e,o,n,s,r){let i=ne(t.shapeIdPool);i==t.shapeArray.length&&t.shapeArray.push(new Ni);let c=t.shapeArray[i];switch(r){case Y.b2_capsuleShape:c.capsule=s;break;case Y.b2_circleShape:c.circle=s;break;case Y.b2_polygonShape:c.polygon=s;break;case Y.b2_segmentShape:c.segment=s;break;case Y.b2_chainSegmentShape:c.chainSegment=s;break;default:break}if(c.id=i,c.bodyId=e.id,c.type=r,c.density=n.density,c.friction=n.friction,c.restitution=n.restitution,c.filter=n.filter,c.userData=n.userData,c.customColor=n.customColor,c.isSensor=n.isSensor,c.enlargedAABB=!1,c.enableSensorEvents=n.enableSensorEvents,c.enableContactEvents=n.enableContactEvents,c.enableHitEvents=n.enableHitEvents,c.enablePreSolveEvents=n.enablePreSolveEvents,c.isFast=!1,c.proxyKey=x,c.localCentroid=Ds(c),c.aabb=new xt,c.fatAABB=new xt,c.revision+=1,e.setIndex!=M.b2_disabledSet){let a=e.type;Vn(c,t.broadPhase,a,o,n.forceContactCreation)}if(e.headShapeId!=x){let a=t.shapeArray[e.headShapeId];a.prevShapeId=i}return c.prevShapeId=x,c.nextShapeId=e.headShapeId,e.headShapeId=i,e.shapeCount+=1,Lt(t),c}function Jr(t,e,o,n){let s=ft(t.world0);if(s===null)return new St(0,0,0);let r=Z(s,t),i=Rt(s,r),c=vr(s,r,i,e,o,n);return r.updateBodyMass===!0&&cn(s,r),Lt(s),new St(c.id+1,t.world0,c.revision)}function Ms(t,e,o){return Jr(t,e,o,Y.b2_circleShape)}function qn(t,e,o){if(pe(o.center1,o.center2)<=It*It){let s=new ce;return s.center=$t(o.center1,o.center2,.5),s.radius=o.radius,Jr(t,e,s,Y.b2_circleShape)}return Jr(t,e,o,Y.b2_capsuleShape)}function yo(t,e,o){return Jr(t,e,o,Y.b2_polygonShape)}function Ka(t,e,o){return pe(o.point1,o.point2)<=It*It?new St:Jr(t,e,o,Y.b2_segmentShape)}function _h(t,e,o,n){let s=e.id;e.prevShapeId!==x&&(t.shapeArray[e.prevShapeId].nextShapeId=e.nextShapeId),e.nextShapeId!==x&&(t.shapeArray[e.nextShapeId].prevShapeId=e.prevShapeId),s===o.headShapeId&&(o.headShapeId=e.nextShapeId),o.shapeCount-=1,an(e,t.broadPhase);let r=o.headContactKey;for(;r!==x;){let i=r>>1,c=r&1,a=t.contactArray[i];r=a.edges[c].nextKey,(a.shapeIdA===s||a.shapeIdB===s)&&fo(t,a,n)}xe(t.shapeIdPool,s),e.id=x,Lt(t)}function Ha(t){let e=ft(t.world0),o=t.index1-1,n=e.shapeArray[o],s=!0,r=_t(e,n.bodyId);_h(e,n,r,s),r.updateBodyMass===!0&&cn(e,r)}function $a(t,e){let o=ft(t.world0);if(o===null)return new Mo;let n=Z(o,t),s=Rt(o,n),r=ne(o.chainIdPool);r===o.chainArray.length&&o.chainArray.push(new Wi);let i=o.chainArray[r];i.id=r,i.bodyId=n.id,i.nextChainId=n.headChainId,i.revision+=1,n.headChainId=r;let c=fe();c.userData=e.userData,c.restitution=e.restitution,c.friction=e.friction,c.filter=e.filter,c.enableContactEvents=!1,c.enableHitEvents=!1,c.enableSensorEvents=!1;let a=e.count,l=e.points,d;if(e.isLoop){i.count=a,i.shapeIndices=new Array(a);let b=a-1;for(let h=0;h<a-2;++h){d=new Ue,d.ghost1=l[b].clone(),d.segment=new Oe,d.segment.point1=l[h].clone(),d.segment.point2=l[h+1].clone(),d.ghost2=l[h+2].clone(),d.chainId=r,b=h;let m=vr(o,n,s,c,d,Y.b2_chainSegmentShape);i.shapeIndices[h]=m.id}d=new Ue,d.ghost1=l[a-3].clone(),d.segment=new Oe,d.segment.point1=l[a-2].clone(),d.segment.point2=l[a-1].clone(),d.ghost2=l[0].clone(),d.chainId=r;let u=vr(o,n,s,c,d,Y.b2_chainSegmentShape);i.shapeIndices[a-2]=u.id,d=new Ue,d.ghost1=l[a-2].clone(),d.segment=new Oe,d.segment.point1=l[a-1].clone(),d.segment.point2=l[0].clone(),d.ghost2=l[1].clone(),d.chainId=r,u=vr(o,n,s,c,d,Y.b2_chainSegmentShape),i.shapeIndices[a-1]=u.id}else{i.count=a-3,i.shapeIndices=new Array(a);for(let b=0;b<a-3;++b){d=new Ue,d.ghost1=l[b].clone(),d.segment=new Oe,d.segment.point1=l[b+1].clone(),d.segment.point2=l[b+2].clone(),d.ghost2=l[b+3].clone(),d.chainId=r;let u=vr(o,n,s,c,d,Y.b2_chainSegmentShape);i.shapeIndices[b]=u.id}}return new Mo(r+1,o.worldId,i.revision)}function Qa(t){let e=ft(t.world0),o=t.index1-1,n=e.chainArray[o],s=!0,r=_t(e,n.bodyId),i=r.headChainId,c=!1;for(;i!==null;){if(i===n.id){c=!0;break}i=e.chainArray[i].nextChainId}if(c===!1)return;let a=n.count;for(let l=0;l<a;++l){let d=n.shapeIndices[l],p=e.shapeArray[d];_h(e,p,r,s)}n.shapeIndices=null,xe(e.chainIdPool,o),n.id=null,Lt(e)}function Xo(t,e){switch(t.type){case Y.b2_capsuleShape:return Fn(t.capsule,e);case Y.b2_circleShape:return jn(t.circle,e);case Y.b2_polygonShape:return Xn(t.polygon,e);case Y.b2_segmentShape:return Cs(t.segment,e);case Y.b2_chainSegmentShape:return Cs(t.chainSegment.segment,e);default:return new xt(e.p.x,e.p.y,e.p.x,e.p.y)}}function Ds(t){switch(t.type){case Y.b2_capsuleShape:return $t(t.capsule.center1,t.capsule.center2,.5);case Y.b2_circleShape:return t.circle.center.clone();case Y.b2_polygonShape:return t.polygon.centroid.clone();case Y.b2_segmentShape:return $t(t.segment.point1,t.segment.point2,.5);case Y.b2_chainSegmentShape:return $t(t.chainSegment.segment.point1,t.chainSegment.segment.point2,.5);default:return new g(0,0)}}function Za(t){switch(t.type){case Y.b2_capsuleShape:return 2*Yt(J(t.capsule.center1,t.capsule.center2))+2*Math.PI*t.capsule.radius;case Y.b2_circleShape:return 2*Math.PI*t.circle.radius;case Y.b2_polygonShape:{let e=t.polygon.vertices,o=t.polygon.count,n=2*Math.PI*t.polygon.radius,s=e[o-1];for(let r=0;r<o;++r){let i=e[r];n+=Yt(J(i,s)),s=i}return n}case Y.b2_segmentShape:return 2*Yt(J(t.segment.point1,t.segment.point2));case Y.b2_chainSegmentShape:return 2*Yt(J(t.chainSegment.segment.point1,t.chainSegment.segment.point2));default:return 0}}function tc(t){switch(t.type){case Y.b2_capsuleShape:return As(t.capsule,t.density);case Y.b2_circleShape:return Bs(t.circle,t.density);case Y.b2_polygonShape:return Sr(t.polygon,t.density);default:return new je}}function Yi(t,e){let o=new Oi;switch(t.type){case Y.b2_capsuleShape:{let n=t.capsule.radius;o.minExtent=n;let s=J(t.capsule.center1,e),r=J(t.capsule.center2,e);o.maxExtent=Math.sqrt(Math.max(be(s),be(r)))+n}break;case Y.b2_circleShape:{let n=t.circle.radius;o.minExtent=n,o.maxExtent=Yt(J(t.circle.center,e))+n}break;case Y.b2_polygonShape:{let n=t.polygon,s=Number.MAX_VALUE,r=0,i=n.count;for(let c=0;c<i;++c){let a=n.vertices[c],l=j(n.normals[c],J(a,n.centroid));s=Math.min(s,l);let d=be(J(a,e));r=Math.max(r,d)}o.minExtent=s+n.radius,o.maxExtent=Math.sqrt(r)+n.radius}break;case Y.b2_segmentShape:{o.minExtent=0;let n=J(t.segment.point1,e),s=J(t.segment.point2,e);o.maxExtent=Math.sqrt(Math.max(be(n),be(s)))}break;case Y.b2_chainSegmentShape:{o.minExtent=0;let n=J(t.chainSegment.segment.point1,e),s=J(t.chainSegment.segment.point2,e);o.maxExtent=Math.sqrt(Math.max(be(n),be(s)))}break;default:break}return o}var _m=new g(0,0),gm=new g(0,1);function ec(t,e,o){let n=t;n.origin=Re(o,t.origin),n.translation=Ie(o.q,t.translation);let s=new me;switch(s.hit=!1,s.fraction=0,s.normal=new g(0,0),s.point=new g(0,0),e.type){case Y.b2_capsuleShape:s=ws(n,e.capsule);break;case Y.b2_circleShape:s=He(n,e.circle);break;case Y.b2_polygonShape:s=vs(n,e.polygon);break;case Y.b2_segmentShape:s=rn(n,e.segment,!1);break;case Y.b2_chainSegmentShape:s=rn(n,e.chainSegment.segment,!0);break;default:return s}return s.point=H(o,s.point),s.normal=K(o.q,s.normal),s}function oc(t,e,o){let n=t;for(let r=0;r<n.count;++r)n.points[r]=Re(o,t.points[r]);n.translation=Ie(o.q,t.translation);let s=new me;switch(s.hit=!1,s.fraction=0,s.normal=new g(0,0),s.point=new g(0,0),e.type){case Y.b2_capsuleShape:s=Cr(n,e.capsule);break;case Y.b2_circleShape:s=Ar(n,e.circle);break;case Y.b2_polygonShape:s=wr(n,e.polygon);break;case Y.b2_segmentShape:s=Js(n,e.segment);break;case Y.b2_chainSegmentShape:s=Js(n,e.chainSegment.segment);break;default:return s}return s.point=H(o,s.point),s.normal=K(o.q,s.normal),s}function Vn(t,e,o,n,s){Ua(t,n,o),t.proxyKey=Ui(e,o,t.fatAABB,t.filter.categoryBits,t.id,s)}function an(t,e){t.proxyKey!=x&&(zi(e,t.proxyKey),t.proxyKey=x)}function $e(t){switch(t.type){case Y.b2_capsuleShape:return vt([t.capsule.center1.clone(),t.capsule.center2.clone()],2,t.capsule.radius);case Y.b2_circleShape:return vt([t.circle.center.clone()],1,t.circle.radius);case Y.b2_polygonShape:return vt(t.polygon.vertices,t.polygon.count,t.polygon.radius);case Y.b2_segmentShape:return vt([t.segment.point1,t.segment.point2],2,0);case Y.b2_chainSegmentShape:return vt([t.chainSegment.segment.point1.clone(),t.chainSegment.segment.point2.clone()],2,0);default:return new Pe}}function nc(t){let e=O(t.world0),o=Bt(e,t);return Ps(e,o.bodyId)}function sc(t,e){let o=O(t.world0),n=Bt(o,t);n.userData=e}function rc(t){let e=O(t.world0);return Bt(e,t).userData}function ic(t){let e=O(t.world0);return Bt(e,t).isSensor}function ac(t,e){let o=O(t.world0),n=Bt(o,t),s=za(o,n),r=Re(s,e);switch(n.type){case Y.b2_capsuleShape:return gr(r,n.capsule);case Y.b2_circleShape:return _r(r,n.circle);case Y.b2_polygonShape:return Br(r,n.polygon);default:return!1}}function cc(t,e,o){let n=O(t.world0),s=Bt(n,t),r=za(n,s),i=new Po;i.maxFraction=1,i.origin=Re(r,e),i.translation=Ie(r.q,o);let c=new me(gm,_m);switch(s.type){case Y.b2_capsuleShape:c=ws(i,s.capsule);break;case Y.b2_circleShape:c=He(i,s.circle);break;case Y.b2_segmentShape:c=rn(i,s.segment,!1);break;case Y.b2_polygonShape:c=vs(i,s.polygon);break;case Y.b2_chainSegmentShape:c=rn(i,s.chainSegment.segment,!0);break;default:return c}return c.hit&&(c.normal=K(r.q,c.normal),c.point=H(r,c.point)),c}function lc(t,e){let o=ft(t.world0);if(o==null)return;let n=Bt(o,t);e!=n.density&&(n.density=e)}function dc(t){let e=O(t.world0);return Bt(e,t).density}function bc(t,e){let o=O(t.world0);if(o.locked)return;let n=Bt(o,t);n.friction=e}function pc(t){let e=O(t.world0);return Bt(e,t).friction}function uc(t,e){let o=O(t.world0);if(o.locked)return;let n=Bt(o,t);n.restitution=e}function hc(t){let e=O(t.world0);return Bt(e,t).restitution}function mc(t){let e=O(t.world0);return Bt(e,t).filter}function Mr(t,e,o,n){let s=_t(t,e.bodyId),r=e.id,i=s.headContactKey;for(;i!==x;){let a=i>>1,l=i&1,d=t.contactArray[a];i=d.edges[l].nextKey,(d.shapeIdA===r||d.shapeIdB===r)&&fo(t,d,o)}let c=Rt(t,s);if(e.proxyKey!==x){let a=qo(e.proxyKey);if(Ua(e,c,a),n){zi(t.broadPhase,e.proxyKey);let l=!0;e.proxyKey=Ui(t.broadPhase,a,e.fatAABB,e.filter.categoryBits,r,l)}else Dr(t.broadPhase,e.proxyKey,e.fatAABB)}else{let a=s.type;Ua(e,c,a)}Lt(t)}function yc(t,e){let o=ft(t.world0);if(o===null)return;let n=Bt(o,t);if(e.maskBits===n.filter.maskBits&&e.categoryBits===n.filter.categoryBits&&e.groupIndex===n.filter.groupIndex)return;let s=e.categoryBits===n.filter.categoryBits;n.filter=e,Mr(o,n,!0,s)}function fc(t,e){let o=ft(t.world0);if(o===null)return;let n=Bt(o,t);n.enableSensorEvents=e}function xc(t){let e=O(t.world0);return Bt(e,t).enableSensorEvents}function Ic(t,e){let o=ft(t.world0);if(o===null)return;let n=Bt(o,t);n.enableContactEvents=e}function Sc(t){let e=O(t.world0);return Bt(e,t).enableContactEvents}function _c(t,e){let o=ft(t.world0);if(o===null)return;let n=Bt(o,t);n.enablePreSolveEvents=e}function gc(t){let e=O(t.world0);return Bt(e,t).enablePreSolveEvents}function Bc(t,e){let o=ft(t.world0);if(o===null)return;let n=Bt(o,t);n.enableHitEvents=e}function Ac(t){let e=O(t.world0);return Bt(e,t).enableHitEvents}function Cc(t){let e=O(t.world0);return Bt(e,t).type}function wc(t){let e=O(t.world0);return Bt(e,t).circle}function vc(t){let e=O(t.world0);return Bt(e,t).segment}function Jc(t){let e=O(t.world0);return Bt(e,t).chainSegment}function Mc(t){let e=O(t.world0);return Bt(e,t).capsule}function Dc(t){let e=O(t.world0);return Bt(e,t).polygon}function Pc(t,e){let o=ft(t.world0);if(o===null)return;let n=Bt(o,t);n.circle=e,n.type=Y.b2_circleShape,Mr(o,n,!0,!0)}function kc(t,e){let o=ft(t.world0);if(o===null)return;let n=Bt(o,t);n.capsule=e,n.type=Y.b2_capsuleShape,Mr(o,n,!0,!0)}function Tc(t,e){let o=ft(t.world0);if(o===null)return;let n=Bt(o,t);n.segment=e,n.type=Y.b2_segmentShape,Mr(o,n,!0,!0)}function Gc(t,e){let o=ft(t.world0);if(o===null)return;let n=Bt(o,t);n.polygon=e,n.type=Y.b2_polygonShape,Mr(o,n,!0,!0)}function Rc(t){let e=O(t.world0),o=Bt(e,t);if(o.type===Y.b2_chainSegmentShape){let n=o.chainSegment.chainId;if(n!==x){let s=e.chainArray[n];return new Mo(n+1,t.world0,s.revision)}}return new Mo}function Lc(t,e){let o=ft(t.world0);if(o===null)return;let n=Sh(o,t),s=n.count;for(let r=0;r<s;++r){let i=n.shapeIndices[r],c=o.shapeArray[i];c.friction=e}}function Ec(t,e){let o=ft(t.world0);if(o===null)return;let n=Sh(o,t),s=n.count;for(let r=0;r<s;++r){let i=n.shapeIndices[r],c=o.shapeArray[i];c.restitution=e}}function jc(t){let e=ft(t.world0);if(e===null)return 0;let o=Bt(e,t);return o.isSensor?0:_t(e,o.bodyId).contactCount}function Fc(t,e,o){let n=ft(t.world0);if(n===null)return 0;let s=Bt(n,t);if(s.isSensor)return 0;let i=_t(n,s.bodyId).headContactKey,c=0;for(;i!==x&&c<o;){let a=i>>1,l=i&1,d=n.contactArray[a];if((d.shapeIdA===t.index1-1||d.shapeIdB===t.index1-1)&&d.flags&mt.b2_contactTouchingFlag){let p=n.shapeArray[d.shapeIdA],b=n.shapeArray[d.shapeIdB];e[c].shapeIdA=new St(p.id+1,t.world0,p.revision),e[c].shapeIdB=new St(b.id+1,t.world0,b.revision);let u=Yn(n,d);e[c].manifold=u.manifold,c+=1}i=d.edges[l].nextKey}return c}function Xc(t){let e=O(t.world0);return e===null?new xt:Bt(e,t).aabb}function qc(t,e){let o=O(t.world0);if(o===null)return new g(0,0);let n=Bt(o,t),s=_t(o,n.bodyId),r=Rt(o,s),i=new ue;i.proxyA=$e(n),i.proxyB=vt([e],1,0),i.transformA=r,i.transformB=new at(new g(0,0),new rt(1,0)),i.useRadii=!0;let c=new ye;return Be(c,i,null,0).pointA}var Ni=class{constructor(){this.id=0,this.bodyId=0,this.prevShapeId=0,this.nextShapeId=0,this.type=Y.e_unknown,this.density=0,this.friction=0,this.restitution=0,this.aabb=new xt,this.fatAABB=new xt,this.localCentroid=new g,this.proxyKey=0,this.filter=new uo,this.userData=null,this.customColor=0,this.capsule=new _e,this.circle=new ce,this.polygon=new ge,this.segment=new Oe,this.chainSegment=new Ue,this.revision=0,this.isSensor=!1,this.enableSensorEvents=!1,this.enableContactEvents=!1,this.enableHitEvents=!1,this.enablePreSolveEvents=!1,this.enlargedAABB=!1,this.isFast=!1,this.imageNoDebug=!1,this.image=null,this.imageScale=null,this.imageOffset=null,this.imageRect=null}},Wi=class{constructor(){this.id=0,this.bodyId=0,this.nextChainId=0,this.shapeIndices=[],this.count=0,this.revision=0}},Oi=class{constructor(){this.minExtent=0,this.maxExtent=0}};var Ki=8;function Qe(t){let e=new ke,o=Math.floor((t+Ki*8-1)/(Ki*8));return e.blockCapacity=o,e.blockCount=0,e.bits=new BigUint64Array(e.blockCapacity),e.bits.fill(0n),e}function Ze(t){t.blockCapacity=0,t.blockCount=0,t.bits=null}function to(t,e){let o=Math.floor((e+Ki*8-1)/(Ki*8));if(t.blockCapacity<o){Ze(t);let n=e+(e>>1);t=Qe(n)}return t.blockCount=o,t.bits.fill(0n),t}function ks(t,e){let o=t.blockCount;for(let n=0;n<o;++n)t.bits[n]|=e.bits[n]}var ke=class{constructor(){this.bits=null,this.blockCapacity=0,this.blockCount=0}};function eo(t,e){let o=Math.floor(e/64);t.bits[o]|=BigInt(1)<<BigInt(e%64)}function xo(t,e){let o=Math.floor(e/64);o>=t.blockCount||(t.bits[o]&=~(BigInt(1)<<BigInt(e%64)))}function gh(t,e){let o=Math.floor(e/64);return o>=t.blockCount?!1:(t.bits[o]&BigInt(1)<<BigInt(e%64))!==BigInt(0)}var Mt=te-1,Hi=class{constructor(){this.bodySet=new ke,this.contacts=new ln,this.joints=new dn,this.overflowConstraints=null}},Ts=class{constructor(){this.colors=[];for(let e=0;e<te;e++)this.colors.push(new Hi)}};function Vc(t,e){t=new Ts,e=Math.max(e,8);for(let o=0;o<Mt;o++){let n=t.colors[o];n.bodySet=Qe(e),n.bodySet=to(n.bodySet,e)}return t}function Yc(t){for(let e=0;e<te;e++){let o=t.colors[e];Ze(o.bodySet),o.bodySet=null,o.contacts=null,o.joints=null}}function Pr(t,e,o){if(e.manifold.pointCount<=0)throw new Error("Assert failed: contactSim.manifold.pointCount > 0");if(!(e.simFlags&Nt.b2_simTouchingFlag))throw new Error("Assert failed: contactSim.simFlags & b2_simTouchingFlag");if(!(o.flags&mt.b2_contactTouchingFlag))throw new Error("Assert failed: contact.flags & b2_contactTouchingFlag");let n=t.constraintGraph,s=Mt,r=o.edges[0].bodyId,i=o.edges[1].bodyId;se(t.bodyArray,r),se(t.bodyArray,i);let c=t.bodyArray[r],a=t.bodyArray[i],l=c.setIndex==M.b2_staticSet,d=a.setIndex==M.b2_staticSet;if(l&&d)throw new Error("Assert failed: staticA == false || staticB == false");let p=n.colors[s];o.colorIndex=s,o.localIndex=p.contacts.count;let b=Xe(p.contacts);if(b.set(e),l)b.bodySimIndexA=x,b.invMassA=0,b.invIA=0;else{if(c.setIndex!==M.b2_awakeSet)throw new Error("Assert failed: bodyA.setIndex == b2SetType.b2_awakeSet");let u=t.solverSetArray[M.b2_awakeSet],h=c.localIndex;if(!(0<=h&&h<u.sims.count))throw new Error("Assert failed: 0 <= localIndex && localIndex < awakeSet.sims.count");b.bodySimIndexA=h;let m=u.sims.data[h];b.invMassA=m.invMass,b.invIA=m.invInertia}if(d)b.bodySimIndexB=x,b.invMassB=0,b.invIB=0;else{if(a.setIndex!==M.b2_awakeSet)throw new Error("Assert failed: bodyB.setIndex == b2SetType.b2_awakeSet");let u=t.solverSetArray[M.b2_awakeSet],h=a.localIndex;if(!(0<=h&&h<u.sims.count))throw new Error("Assert failed: 0 <= localIndex && localIndex < awakeSet.sims.count");b.bodySimIndexB=h;let m=u.sims.data[h];b.invMassB=m.invMass,b.invIB=m.invInertia}}function kr(t,e,o,n,s){let r=t.constraintGraph;if(n!==Mt)throw new Error("Assert failed: colorIndex == b2_overflowIndex");let i=r.colors[n];n!=Mt&&(xo(i.bodySet,e),xo(i.bodySet,o));let c=no(i.contacts,s);if(c!==x){let l=i.contacts.data[s].contactId,d=t.contactArray[l];if(d.setIndex!==M.b2_awakeSet)throw new Error("Assert failed: movedContact.setIndex == b2SetType.b2_awakeSet");if(d.colorIndex!==n)throw new Error("Assert failed: movedContact.colorIndex == colorIndex");if(d.localIndex!==c)throw new Error("Assert failed: movedContact.localIndex == movedIndex");d.localIndex=s}}function Cm(t,e,o,n,s){return Mt}function $i(t,e){let o=t.constraintGraph,n=e.edges[0].bodyId,s=e.edges[1].bodyId,r=t.bodyArray[n],i=t.bodyArray[s],c=r.setIndex===M.b2_staticSet,a=i.setIndex===M.b2_staticSet;if(c&&a)throw new Error("Assert failed: staticA == false || staticB == false");let l=Cm(o,n,s,c,a),d=oo(o.colors[l].joints);return e.colorIndex=l,e.localIndex=o.colors[l].joints.count-1,d}function Qi(t,e,o){let n=$i(t,o);Object.assign(n,e)}function Tr(t,e,o,n,s){let i=t.constraintGraph.colors[n];n!=Mt&&(xo(i.bodySet,e),xo(i.bodySet,o));let c=bn(i.joints,s);if(c!==x){let l=i.joints.data[s].jointId;if(l!=t.jointArray[l].jointId)throw new Error("Assert failed: movedId != jointId");let d=t.jointArray[l];if(d.setIndex!==M.b2_awakeSet)throw new Error("Assert failed: movedJoint.setIndex == b2SetType.b2_awakeSet");if(d.colorIndex!==n)throw new Error("Assert failed: movedJoint.colorIndex == colorIndex");if(d.localIndex!==c)throw new Error("Assert failed: movedJoint.localIndex == movedIndex");d.localIndex=s}}var Gr=class{constructor(){this.indexA=0,this.indexB=0,this.normalX=0,this.normalY=0,this.friction=0,this.restitution=0,this.pointCount=0,this.softness=new re,this.invMassA=0,this.invIA=0,this.invMassB=0,this.invIB=0,this.points=[]}},Zi=class{constructor(){this.normalImpulse=0,this.tangentImpulse=0,this.maxNormalImpulse=0,this.anchorAX=0,this.anchorAY=0,this.anchorBX=0,this.anchorBY=0,this.baseSeparation=0,this.normalMass=0,this.tangentMass=0,this.relativeVelocity=0}};function Nc(t){let e=t.world,n=t.graph.colors[Mt],s=n.overflowConstraints,r=n.contacts.count,i=n.contacts.data,c=t.states,a=t.contactSoftness,l=t.staticSoftness,d=e.enableWarmStarting?1:0;for(let p=0;p<r;++p){let b=i[p],u=b.manifold,h=u.pointCount,m=b.bodySimIndexA,f=b.bodySimIndexB,y=s[p];y.indexA=m,y.indexB=f,y.normalX=u.normalX,y.normalY=u.normalY,y.friction=b.friction,y.restitution=b.restitution,y.pointCount=h;let I=0,C=0,_=0,S=b.invMassA,A=b.invIA;if(m!==x){let E=c[m];I=E.linearVelocity.x,C=E.linearVelocity.y,_=E.angularVelocity}let B=0,w=0,D=0,v=b.invMassB,P=b.invIB;if(f!==x){let E=c[f];B=E.linearVelocity.x,w=E.linearVelocity.y,D=E.angularVelocity}y.softness=m===x||f===x?l:a,y.invMassA=S,y.invIA=A,y.invMassB=v,y.invIB=P;let T=y.normalX,R=y.normalY,X=y.normalY,F=-y.normalX;for(let E=0;E<h;++E){let W=u.points[E],et=y.points[E]=new Zi;et.normalImpulse=d*W.normalImpulse,et.tangentImpulse=d*W.tangentImpulse,et.maxNormalImpulse=0;let st=W.anchorAX,ot=W.anchorAY,L=W.anchorBX,nt=W.anchorBY;et.anchorAX=st,et.anchorAY=ot,et.anchorBX=L,et.anchorBY=nt;let Ct=L-st,N=nt-ot;et.baseSeparation=W.separation-(Ct*T+N*R);let Q=st*R-ot*T,wt=L*R-nt*T,ct=S+v+A*Q*Q+P*wt*wt;et.normalMass=ct>0?1/ct:0;let At=st*F-ot*X,Tt=L*F-nt*X,lt=S+v+A*At*At+P*Tt*Tt;et.tangentMass=lt>0?1/lt:0;let Et=I+-_*ot,Ft=C+_*st,Jt=B+-D*nt,Te=w+D*L;et.relativeVelocity=T*(Jt-Et)+R*(Te-Ft)}}}function Wc(t){let o=t.graph.colors[Mt],n=o.overflowConstraints,s=o.contacts.count,i=t.world.solverSetArray[M.b2_awakeSet].states.data,c=new Pt;for(let a=0;a<s;++a){let l=n[a],d=l.indexA,p=l.indexB,b=d===x?c:i[d],u=p===x?c:i[p],h=b.linearVelocity,m=b.angularVelocity,f=u.linearVelocity,y=u.angularVelocity,I=l.invMassA,C=l.invIA,_=l.invMassB,S=l.invIB,A=l.normalX,B=l.normalY,w=l.normalY,D=-l.normalX,v=l.pointCount;for(let P=0;P<v;++P){let T=l.points[P],R=T.anchorAX,X=T.anchorAY,F=T.anchorBX,E=T.anchorBY,W=T.normalImpulse*A+T.tangentImpulse*w,et=T.normalImpulse*B+T.tangentImpulse*D;m-=C*(R*et-X*W),h.x-=I*W,h.y-=I*et,y+=S*(F*et-E*W),f.x+=_*W,f.y+=_*et}b.linearVelocity=h,b.angularVelocity=m,u.linearVelocity=f,u.angularVelocity=y}}function ta(t,e){let n=t.graph.colors[Mt],s=n.overflowConstraints,r=n.contacts.count,c=t.world.solverSetArray[M.b2_awakeSet].states,a=t.inv_h,l=t.world.contactPushoutVelocity,d=new Pt;for(let p=0;p<r;++p){let b=s[p],u=b.invMassA,h=b.invIA,m=b.invMassB,f=b.invIB,y=b.indexA===x?d:c.data[b.indexA],I=y.linearVelocity.x,C=y.linearVelocity.y,_=y.angularVelocity,S=y.deltaRotation,A=b.indexB===x?d:c.data[b.indexB],B=A.linearVelocity.x,w=A.linearVelocity.y,D=A.angularVelocity,v=A.deltaRotation,P=A.deltaPosition.x-y.deltaPosition.x,T=A.deltaPosition.y-y.deltaPosition.y,R=b.normalX,X=b.normalY,F=X,E=-R,W=b.friction,et=b.softness,st=b.pointCount;for(let ot=0;ot<st;++ot){let L=b.points[ot],nt=v.c*L.anchorBX-v.s*L.anchorBY-(S.c*L.anchorAX-S.s*L.anchorAY),Ct=v.s*L.anchorBX+v.c*L.anchorBY-(S.s*L.anchorAX+S.c*L.anchorAY),N=(P+nt)*R+(T+Ct)*X+L.baseSeparation,Q=0,wt=1,ct=0;N>0?Q=N*a:e&&(Q=Math.max(et.biasRate*N,-l),wt=et.massScale,ct=et.impulseScale);let At=L.anchorAX,Tt=L.anchorAY,lt=L.anchorBX,Et=L.anchorBY,Ft=(B-I+D*-Et-_*-Tt)*R+(w-C+D*lt-_*At)*X,Jt=-L.normalMass*wt*(Ft+Q)-ct*L.normalImpulse,Te=Math.max(L.normalImpulse+Jt,0);Jt=Te-L.normalImpulse,L.normalImpulse=Te,L.maxNormalImpulse=Math.max(L.maxNormalImpulse,Jt);let Ge=Jt*R,ut=Jt*X;I-=u*Ge,C-=u*ut,_-=h*(At*ut-Tt*Ge),B+=m*Ge,w+=m*ut,D+=f*(lt*ut-Et*Ge)}for(let ot=0;ot<st;++ot){let L=b.points[ot],nt=L.anchorAX,Ct=L.anchorAY,N=L.anchorBX,Q=L.anchorBY,wt=B-D*Q-(I-_*Ct),ct=w+D*N-(C+_*nt),At=wt*F+ct*E,Tt=L.tangentMass*-At,lt=W*L.normalImpulse,Et=L.tangentImpulse;L.tangentImpulse=Et+Tt,L.tangentImpulse=L.tangentImpulse<-lt?-lt:L.tangentImpulse>lt?lt:L.tangentImpulse,Tt=L.tangentImpulse-Et;let Ft=Tt*F,Jt=Tt*E;I-=u*Ft,C-=u*Jt,_-=h*(nt*Jt-Ct*Ft),B+=m*Ft,w+=m*Jt,D+=f*(N*Jt-Q*Ft)}y.linearVelocity.x=I,y.linearVelocity.y=C,y.angularVelocity=_,A.linearVelocity.x=B,A.linearVelocity.y=w,A.angularVelocity=D}}function Oc(t){let o=t.graph.colors[Mt],n=o.overflowConstraints,s=o.contacts.count,i=t.world.solverSetArray[M.b2_awakeSet].states,c=t.world.restitutionThreshold,a=new Pt;for(let l=0;l<s;++l){let d=n[l],p=d.restitution;if(p===0)continue;let b=d.invMassA,u=d.invIA,h=d.invMassB,m=d.invIB,f=d.indexA===x?a:i.data[d.indexA],y=f.linearVelocity,I=f.angularVelocity,C=d.indexB===x?a:i.data[d.indexB],_=C.linearVelocity,S=C.angularVelocity,A=d.normalX,B=d.normalY,w=d.pointCount;for(let D=0;D<w;++D){let v=d.points[D];if(v.relativeVelocity>-c||v.maxNormalImpulse===0)continue;let P=v.anchorAX,T=v.anchorAY,R=v.anchorBX,X=v.anchorBY,F=_.x+-S*X,E=_.y+S*R,W=y.x+-I*T,et=y.y+I*P,st=F-W,ot=E-et,L=st*A+ot*B,nt=-v.normalMass*(L+p*v.relativeVelocity),Ct=Math.max(v.normalImpulse+nt,0);nt=Ct-v.normalImpulse,v.normalImpulse=Ct,v.maxNormalImpulse=Math.max(v.maxNormalImpulse,nt);let N=nt*A,Q=nt*B;y.x-=b*N,y.y-=b*Q,I-=u*(P*Q-T*N),_.x+=h*N,_.y+=h*Q,S+=m*(R*Q-X*N)}f.angularVelocity=I,C.angularVelocity=S}}function Uc(t){let o=t.graph.colors[Mt],n=o.overflowConstraints,s=o.contacts,r=o.contacts.count;for(let i=0;i<r;++i){let c=n[i],l=s.data[i].manifold,d=l.pointCount;for(let p=0;p<d;++p)l.points[p].normalImpulse=c.points[p].normalImpulse,l.points[p].tangentImpulse=c.points[p].tangentImpulse,l.points[p].maxNormalImpulse=c.points[p].maxNormalImpulse,l.points[p].normalVelocity=c.points[p].relativeVelocity}}function Wt(t){let e=t.upperBoundX-t.lowerBoundX,o=t.upperBoundY-t.lowerBoundY;return 2*(e+o)}function zc(t,e){let o=!1;return e.lowerBoundX<t.lowerBoundX&&(t.lowerBoundX=e.lowerBoundX,o=!0),e.lowerBoundY<t.lowerBoundY&&(t.lowerBoundY=e.lowerBoundY,o=!0),t.upperBoundX<e.upperBoundX&&(t.upperBoundX=e.upperBoundX,o=!0),t.upperBoundY<e.upperBoundY&&(t.upperBoundY=e.upperBoundY,o=!0),o}function pn(t,e){return!(t.lowerBoundX>=e.upperBoundX||t.upperBoundX<=e.lowerBoundX||t.lowerBoundY>=e.upperBoundY||t.upperBoundY<=e.lowerBoundY)}var Jm=1024;function Ah(t){return t.height===0}function Er(){let t=new hn;t.root=x,t.nodeCapacity=16,t.nodeCount=0,t.nodes=Array.from({length:t.nodeCapacity},()=>new Dn);for(let e=0;e<t.nodeCapacity-1;++e)t.nodes[e].parent_next=e+1,t.nodes[e].height=-1;return t.nodes[t.nodeCapacity-1].parent_next=x,t.nodes[t.nodeCapacity-1].height=-1,t.freeList=0,t.proxyCount=0,t.leafIndices=null,t.leafCenters=null,t.rebuildCapacity=0,t}function jr(t){t.nodes=null,t.leafIndices=null,t.leafCenters=null}function Rr(t){if(t.freeList===x){let n=t.nodes;t.nodeCapacity+=t.nodeCapacity>>1,t.nodes=Array.from({length:t.nodeCapacity},()=>new Dn),t.nodes=Array.from({length:t.nodeCapacity},(s,r)=>r<n.length?n[r]:new Dn);for(let s=t.nodeCount;s<t.nodeCapacity-1;++s)t.nodes[s].parent_next=s+1,t.nodes[s].height=-1;t.nodes[t.nodeCapacity-1].parent_next=x,t.nodes[t.nodeCapacity-1].height=-1,t.freeList=t.nodeCount}let e=t.freeList,o=t.nodes[e];return t.freeList=o.parent_next,t.nodes[e]=new Dn,++t.nodeCount,e}function Lr(t,e){t.nodes[e].parent_next=t.freeList,t.nodes[e].height=-1,t.freeList=e,--t.nodeCount}function Mm(t,e){let o=Le(e),n=Wt(e),s=t.nodes,r=t.root,i=s[r].aabb,c=Wt(i),a=Wt(qt(i,e)),l=0,d=r,p=a,b=r;for(;s[b].height>0;){let u=s[b].child1,h=s[b].child2,m=a+l;m<p&&(d=b,p=m),l+=a-c;let f=s[u].height===0,y=s[h].height===0,I=Number.MAX_VALUE,C=s[u].aabb,_=Wt(qt(C,e)),S=0;if(f){let v=_+l;v<p&&(d=u,p=v)}else S=Wt(C),I=l+_+Math.min(n-S,0);let A=Number.MAX_VALUE,B=s[h].aabb,w=Wt(qt(B,e)),D=0;if(y){let v=w+l;v<p&&(d=h,p=v)}else D=Wt(B),A=l+w+Math.min(n-D,0);if(f&&y||p<=I&&p<=A)break;if(I===A&&!f){let v=J(Le(C),o),P=J(Le(B),o);I=be(v),A=be(P)}I<A&&!f?(b=u,c=S,a=_):(b=h,c=D,a=w)}return d}var Io={b2_rotateNone:0,b2_rotateBF:1,b2_rotateBG:2,b2_rotateCD:3,b2_rotateCE:4};function Ch(t,e){let o=t.nodes,n=o[e];if(n.height<2)return;let s=n.child1,r=n.child2,i=o[s],c=o[r];if(i.height===0){let a=c.child1,l=c.child2,d=o[a],p=o[l],b=Wt(c.aabb),u=qt(i.aabb,p.aabb),h=Wt(u),m=qt(i.aabb,d.aabb),f=Wt(m);if(b<h&&b<f)return;h<f?(n.child1=a,c.child1=s,i.parent_next=r,d.parent_next=e,c.aabb=u,c.height=1+Math.max(i.height,p.height),n.height=1+Math.max(c.height,d.height),c.categoryBits=i.categoryBits|p.categoryBits,n.categoryBits=c.categoryBits|d.categoryBits,c.enlarged=i.enlarged||p.enlarged,n.enlarged=c.enlarged||d.enlarged):(n.child1=l,c.child2=s,i.parent_next=r,p.parent_next=e,c.aabb=m,c.height=1+Math.max(i.height,d.height),n.height=1+Math.max(c.height,p.height),c.categoryBits=i.categoryBits|d.categoryBits,n.categoryBits=c.categoryBits|p.categoryBits,c.enlarged=i.enlarged||d.enlarged,n.enlarged=c.enlarged||p.enlarged)}else if(c.height===0){let a=i.child1,l=i.child2,d=o[a],p=o[l],b=Wt(i.aabb),u=qt(c.aabb,p.aabb),h=Wt(u),m=qt(c.aabb,d.aabb),f=Wt(m);if(b<h&&b<f)return;h<f?(n.child2=a,i.child1=r,c.parent_next=s,d.parent_next=e,i.aabb=u,i.height=1+Math.max(c.height,p.height),n.height=1+Math.max(i.height,d.height),i.categoryBits=c.categoryBits|p.categoryBits,n.categoryBits=i.categoryBits|d.categoryBits,i.enlarged=c.enlarged||p.enlarged,n.enlarged=i.enlarged||d.enlarged):(n.child2=l,i.child2=r,c.parent_next=s,p.parent_next=e,i.aabb=m,i.height=1+Math.max(c.height,d.height),n.height=1+Math.max(i.height,p.height),i.categoryBits=c.categoryBits|d.categoryBits,n.categoryBits=i.categoryBits|p.categoryBits,i.enlarged=c.enlarged||d.enlarged,n.enlarged=i.enlarged||p.enlarged)}else{let a=i.child1,l=i.child2,d=c.child1,p=c.child2,b=o[a],u=o[l],h=o[d],m=o[p],f=Wt(i.aabb),y=Wt(c.aabb),I=f+y,C=Io.b2_rotateNone,_=I,S=qt(i.aabb,m.aabb),A=f+Wt(S);A<_&&(C=Io.b2_rotateBF,_=A);let B=qt(i.aabb,h.aabb),w=f+Wt(B);w<_&&(C=Io.b2_rotateBG,_=w);let D=qt(c.aabb,u.aabb),v=y+Wt(D);v<_&&(C=Io.b2_rotateCD,_=v);let P=qt(c.aabb,b.aabb);switch(y+Wt(P)<_&&(C=Io.b2_rotateCE),C){case Io.b2_rotateNone:break;case Io.b2_rotateBF:n.child1=d,c.child1=s,i.parent_next=r,h.parent_next=e,c.aabb=S,c.height=1+Math.max(i.height,m.height),n.height=1+Math.max(c.height,h.height),c.categoryBits=i.categoryBits|m.categoryBits,n.categoryBits=c.categoryBits|h.categoryBits,c.enlarged=i.enlarged||m.enlarged,n.enlarged=c.enlarged||h.enlarged;break;case Io.b2_rotateBG:n.child1=p,c.child2=s,i.parent_next=r,m.parent_next=e,c.aabb=B,c.height=1+Math.max(i.height,h.height),n.height=1+Math.max(c.height,m.height),c.categoryBits=i.categoryBits|h.categoryBits,n.categoryBits=c.categoryBits|m.categoryBits,c.enlarged=i.enlarged||h.enlarged,n.enlarged=c.enlarged||m.enlarged;break;case Io.b2_rotateCD:n.child2=a,i.child1=r,c.parent_next=s,b.parent_next=e,i.aabb=D,i.height=1+Math.max(c.height,u.height),n.height=1+Math.max(i.height,b.height),i.categoryBits=c.categoryBits|u.categoryBits,n.categoryBits=i.categoryBits|b.categoryBits,i.enlarged=c.enlarged||u.enlarged,n.enlarged=i.enlarged||b.enlarged;break;case Io.b2_rotateCE:n.child2=l,i.child2=r,c.parent_next=s,u.parent_next=e,i.aabb=P,i.height=1+Math.max(c.height,b.height),n.height=1+Math.max(i.height,u.height),i.categoryBits=c.categoryBits|b.categoryBits,n.categoryBits=i.categoryBits|u.categoryBits,i.enlarged=c.enlarged||b.enlarged,n.enlarged=i.enlarged||u.enlarged;break;default:break}}}function Kc(t,e,o){if(t.root===x){t.root=e,t.nodes[t.root].parent_next=x;return}let n=t.nodes[e].aabb,s=Mm(t,n),r=t.nodes[s].parent_next,i=Rr(t),c=t.nodes;c[i].parent_next=r,c[i].userData=-1,c[i].aabb=qt(n,c[s].aabb),c[i].categoryBits=c[e].categoryBits|c[s].categoryBits,c[i].height=c[s].height+1,r!==x?(c[r].child1===s?c[r].child1=i:c[r].child2=i,c[i].child1=s,c[i].child2=e,c[s].parent_next=i,c[e].parent_next=i):(c[i].child1=s,c[i].child2=e,c[s].parent_next=i,c[e].parent_next=i,t.root=i);let a=c[e].parent_next;for(;a!==x;){let l=c[a].child1,d=c[a].child2;c[a].aabb=qt(c[l].aabb,c[d].aabb),c[a].categoryBits=c[l].categoryBits|c[d].categoryBits,c[a].height=1+Math.max(c[l].height,c[d].height),c[a].enlarged=c[l].enlarged||c[d].enlarged,o&&Ch(t,a),a=c[a].parent_next}}function Hc(t,e){if(e===t.root){t.root=x;return}let o=t.nodes,n=o[e].parent_next,s=o[n].parent_next,r;if(o[n].child1===e?r=o[n].child2:r=o[n].child1,s!==x){o[s].child1===n?o[s].child1=r:o[s].child2=r,o[r].parent_next=s,Lr(t,n);let i=s;for(;i!==x;){let c=o[i],a=o[c.child1],l=o[c.child2];c.aabb=qt(a.aabb,l.aabb),c.categoryBits=a.categoryBits|l.categoryBits,c.height=1+Math.max(a.height,l.height),i=c.parent_next}}else t.root=r,t.nodes[r].parent_next=x,Lr(t,n)}function Fr(t,e,o,n){let s=Rr(t),r=t.nodes[s];return r.aabb=e,r.userData=n,r.categoryBits=o,r.height=0,Kc(t,s,!0),t.proxyCount+=1,s}function Xr(t,e){Hc(t,e),Lr(t,e),t.proxyCount-=1}function $c(t){return t.proxyCount}function qr(t,e,o){Hc(t,e),t.nodes[e].aabb=o,Kc(t,e,!1)}function un(t,e,o){let n=t.nodes;n[e].aabb=o;let s=n[e].parent_next;for(;s!==x;){let r=zc(n[s].aabb,o);if(n[s].enlarged=!0,s=n[s].parent_next,!r)break}for(;s!==x&&n[s].enlarged!==!0;)n[s].enlarged=!0,s=n[s].parent_next}function Qc(t){return t.root===x?0:t.nodes[t.root].height}function Zc(t){if(t.root===x)return 0;let e=t.nodes[t.root],o=Wt(e.aabb),n=0;for(let s=0;s<t.nodeCapacity;++s){let r=t.nodes[s];r.height<0||Ah(r)||s===t.root||(n+=Wt(r.aabb))}return n/o}function tl(t){}function el(t){let e=0;for(let o=0;o<t.nodeCapacity;++o){let n=t.nodes[o];if(n.height<=1)continue;let s=n.child1,r=n.child2,i=Math.abs(t.nodes[r].height-t.nodes[s].height);e=Math.max(e,i)}return e}function ol(t){let e=new Array(t.nodeCount),o=0;for(let n=0;n<t.nodeCapacity;++n)t.nodes[n].height<0||(Ah(t.nodes[n])?(t.nodes[n].parent_next=x,e[o]=n,++o):Lr(t,n));for(;o>1;){let n=Number.MAX_VALUE,s=-1,r=-1;for(let b=0;b<o;++b){let u=t.nodes[e[b]].aabb;for(let h=b+1;h<o;++h){let m=t.nodes[e[h]].aabb,f=qt(u,m),y=Wt(f);y<n&&(s=b,r=h,n=y)}}let i=e[s],c=e[r],a=t.nodes[i],l=t.nodes[c],d=Rr(t),p=t.nodes[d];p.child1=i,p.child2=c,p.aabb=qt(a.aabb,l.aabb),p.categoryBits=a.categoryBits|l.categoryBits,p.height=1+Math.max(a.height,l.height),p.parent_next=x,a.parent_next=d,l.parent_next=d,e[r]=e[o-1],e[s]=d,--o}t.root=e[0]}function nl(t,e){for(let o=0;o<t.nodeCapacity;++o){let n=t.nodes[o];n.aabb.lowerBoundX-=e.x,n.aabb.lowerBoundY-=e.y,n.aabb.upperBoundX-=e.x,n.aabb.upperBoundY-=e.y}}function sl(t){return Object.keys(t).length*8+t.nodeCapacity*Object.keys(t.nodes[0]).length*8+t.rebuildCapacity*32}function ve(t,e,o,n,s){if(t.root==x)return;let r=[];for(r.push(t.root);r.length>0;){let i=r.pop();if(i==x)continue;let c=t.nodes[i];if(c.categoryBits&o&&pn(c.aabb,e))if(c.height==0){if(n(i,c.userData,s)===!1)return}else r.push(c.child1),r.push(c.child2)}}var ea=Array(64);function oa(t,e,o){if(t.root==x)return;let n=e.lowerBoundX,s=e.upperBoundX,r=e.lowerBoundY,i=e.upperBoundY,c=t.nodes,a=0;ea[a++]=t.root;let l,d,p;for(;a>0;)l=ea[--a],d=c[l],d.height==0?(p=d.aabb,p.lowerBoundX<s&&p.upperBoundX>n&&p.lowerBoundY<i&&p.upperBoundY>r&&rl(l,d.userData,o)):(p=d.aabb,p.lowerBoundX<s&&p.upperBoundX>n&&p.lowerBoundY<i&&p.upperBoundY>r&&(ea[a++]=d.child1,ea[a++]=d.child2))}function Gs(t,e,o,n,s){let r=e.origin,i=e.translation,c=dt(i),a=Gt(1,c),l=nr(a),d=e.maxFraction,p=$(r,d,i),b=new xt(Math.min(r.x,p.x),Math.min(r.y,p.y),Math.max(r.x,p.x),Math.max(r.y,p.y)),u=[];u.push(t.root);let h=e;for(;u.length>0;){let m=u.pop();if(m==x)continue;let f=t.nodes[m];if(pn(f.aabb,b)==!1||!(f.categoryBits&o))continue;let y=Le(f.aabb),I=rs(f.aabb),C=Math.abs(j(a,J(r,y)));if(!(j(l,I)<C))if(f.height==0){h.maxFraction=d;let S=n(h,m,f.userData,s);if(S==0)return;0<S&&S<=d&&(d=S,p=$(r,d,i),b.lowerBoundX=Math.min(r.x,p.x),b.lowerBoundY=Math.min(r.y,p.y),b.upperBoundX=Math.max(r.x,p.x),b.upperBoundY=Math.max(r.y,p.y))}else u.push(f.child1),u.push(f.child2)}}function Nn(t,e,o,n,s){if(e.count==0)return;let r=new xt(e.points[0],e.points[0]);for(let f=1;f<e.count;++f)r.lowerBoundX=Math.min(r.lowerBoundX,e.points[f].x),r.lowerBoundY=Math.min(r.lowerBoundY,e.points[f].y),r.upperBoundX=Math.max(r.upperBoundX,e.points[f].x),r.upperBoundY=Math.max(r.upperBoundY,e.points[f].y);r.lowerBoundX=r.lowerBoundX-e.radius,r.lowerBoundY=r.lowerBoundY-e.radius,r.upperBoundX=r.upperBoundX+e.radius,r.upperBoundY=r.upperBoundY+e.radius;let i=Le(r),c=rs(r),a=e.translation,l=Gt(1,a),d=nr(l),p=e.maxFraction,b=it(p,e.translation),u=new xt(Math.min(r.lowerBoundX,r.lowerBoundX+b.x),Math.min(r.lowerBoundY,r.lowerBoundY+b.y),Math.max(r.upperBoundX,r.upperBoundX+b.x),Math.max(r.upperBoundY,r.upperBoundY+b.y)),h=e,m=[];for(m.push(t.root);m.length>0;){let f=m.pop();if(f==x)continue;let y=t.nodes[f];if(pn(y.aabb,u)==!1||!(y.categoryBits&o))continue;let I=Le(y.aabb),C=U(rs(y.aabb),c),_=Math.abs(j(l,J(i,I)));if(!(j(d,C)<_))if(y.height==0){h.maxFraction=p;let A=n(h,f,y.userData,s);if(A==0)return;0<A&&A<p&&(p=A,b=it(p,e.translation),u.lowerBoundX=Math.min(r.lowerBoundX,r.lowerBoundX+b.x),u.lowerBoundY=Math.min(r.lowerBoundY,r.lowerBoundY+b.y),u.upperBoundX=Math.max(r.upperBoundX,r.upperBoundX+b.x),u.upperBoundY=Math.max(r.upperBoundY,r.upperBoundY+b.y))}else m.push(y.child1),m.push(y.child2)}}function Bh(t,e,o,n,s){if(s<=2)return o+(s>>1);let r=e[o].x,i=e[o].x,c=e[o].y,a=e[o].y;for(let h=o+1;h<n;++h){let m=e[h].x,f=e[h].y;m<r?r=m:m>i&&(i=m),f<c?c=f:f>a&&(a=f)}let l=i-r,d=a-c,p=l>d,b=o,u=n-1;if(p){let h=.5*(r+i);for(;;){for(;b<=u&&e[b].x<h;)b++;for(;b<=u&&e[u].x>h;)u--;if(b>=u)break;let m=t[b];t[b]=t[u],t[u]=m,m=e[b],e[b]=e[u],e[u]=m,b++,u--}}else{let h=.5*(c+a);for(;;){for(;b<=u&&e[b].y<h;)b++;for(;b<=u&&e[u].y>h;)u--;if(b>=u)break;let m=t[b];t[b]=t[u],t[u]=m,m=e[b],e[b]=e[u],e[u]=m,b++,u--}}return b>o&&b<n?b:o+(s>>1)}function Dm(t,e){let{nodes:o,leafIndices:n,leafCenters:s}=t;if(e===1)return o[n[0]].parent_next=x,n[0];let r=new Array(Jm),i=0;for(r[0]={nodeIndex:Rr(t),childCount:-1,startIndex:0,endIndex:e,splitIndex:Bh(n,s,0,e,e)};;){let d=r[i];if(d.childCount++,d.childCount===2){if(i===0)break;let p=r[i-1],b=o[p.nodeIndex],u=d.nodeIndex;p.childCount===0?b.child1=u:b.child2=u;let h=o[u];h.parent_next=p.nodeIndex;let m=o[h.child1],f=o[h.child2];h.aabb=qt(m.aabb,f.aabb),h.height=1+Math.max(m.height,f.height),h.categoryBits=m.categoryBits|f.categoryBits,i--}else{let[p,b]=d.childCount===0?[d.startIndex,d.splitIndex]:[d.splitIndex,d.endIndex],u=b-p;if(u===1){let h=n[p],m=o[d.nodeIndex];m[d.childCount===0?"child1":"child2"]=h,o[h].parent_next=d.nodeIndex}else r[++i]={nodeIndex:Rr(t),childCount:-1,startIndex:p,endIndex:b,splitIndex:Bh(n,s,p,b,u)}}}let c=o[r[0].nodeIndex],a=o[c.child1],l=o[c.child2];return c.aabb=qt(a.aabb,l.aabb),c.height=1+Math.max(a.height,l.height),c.categoryBits=a.categoryBits|l.categoryBits,r[0].nodeIndex}function Rs(t){let e=t.proxyCount;if(e===0)return 0;if(e>t.rebuildCapacity){let l=e+Math.floor(e/2);t.leafIndices=Array(l),t.leafCenters=Array(l),t.rebuildCapacity=l}let o=0,n=[],s=t.root,r=t.nodes,i=r[s],c=t.leafIndices,a=t.leafCenters;for(;;){if(i.height===0||i.enlarged===!1)c[o]=s,a[o]=Le(i.aabb),o++,i.parent_next=x;else{let l=s;n.push(i.child2),s=i.child1,i=r[s],Lr(t,l);continue}if(n.length===0)break;s=n.pop(),i=r[s]}return t.root=Dm(t,o),o}function wh(t,e){let o=t.nodes[e];return o?o.userData:0}var hn=class{constructor(){this.nodes=[],this.root=0,this.nodeCount=0,this.nodeCapacity=0,this.freeList=x,this.proxyCount=0,this.leafIndices=[],this.leafCenters=[],this.rebuildCapacity=0}};function Vr(t){if(t===0n)return 0;let e=Number(t&0xFFFFFFFFn);if(e!==0)return Math.clz32(e&-e)^31;{let o=Number(t>>32n);return Math.clz32(o&-o)^31|32}}var so=class{constructor(){this.sims=new Es,this.states=new Nr,this.joints=new dn,this.contacts=new ln,this.islands=new Wr,this.setIndex=0}};function Wn(t,e){let o=t.solverSetArray[e];o.sims=null,o.states=null,o.contacts=null,o.joints=null,o.islands=null,xe(t.solverSetIdPool,e),o=new so,o.setIndex=x,t.solverSetArray[e]=o}function qe(t,e){let o=t.solverSetArray[e],n=t.solverSetArray[M.b2_awakeSet],s=t.solverSetArray[M.b2_disabledSet],r=t.bodyArray,i=t.contactArray,c=o.sims.count;for(let u=0;u<c;++u){let h=o.sims.data[u],m=r[h.bodyId];m.setIndex=M.b2_awakeSet,m.localIndex=n.sims.count,m.sleepTime=0;let f=mn(n.sims);Object.assign(f,h);let y=js(n.states);Object.assign(y,new Pt);let I=m.headContactKey;for(;I!==x;){let C=I&1,_=I>>1,S=i[_];if(I=S.edges[C].nextKey,S.setIndex!==M.b2_disabledSet)continue;let A=S.localIndex,B=s.contacts.data[A];if(S.setIndex=M.b2_awakeSet,S.localIndex=n.contacts.count,Xe(n.contacts).set(B),no(s.contacts,A)!==x){let P=s.contacts.data[A].contactId;i[P].localIndex=A}}}let a=o.contacts.count;for(let u=0;u<a;++u){let h=o.contacts.data[u],m=i[h.contactId];Pr(t,h,m),m.setIndex=M.b2_awakeSet}let l=t.jointArray,d=o.joints.count;for(let u=0;u<d;++u){let h=o.joints.data[u],m=l[h.jointId];Qi(t,h,m),m.setIndex=M.b2_awakeSet}let p=t.islandArray,b=o.islands.count;for(let u=0;u<b;++u){let h=o.islands.data[u],m=p[h.islandId];m.setIndex=M.b2_awakeSet,m.localIndex=n.islands.count;let f=On(n.islands);Object.assign(f,h)}Wn(t,e),Lt(t)}function Yr(t,e){let o=t.islandArray[e];if(o.constraintRemoveCount>0)return;let n=t.bodyMoveEventArray,s=ne(t.solverSetIdPool);if(s===t.solverSetArray.length){let y=new so;y.setIndex=x,t.solverSetArray.push(y)}let r=t.solverSetArray[M.b2_awakeSet],i=t.solverSetArray[s];i.setIndex=s,i.sims=al(o.bodyCount),i.contacts=cl(o.contactCount),i.joints=ll(o.jointCount);let c=t.solverSetArray[M.b2_disabledSet],a=t.bodyArray,l=t.contactArray,d=o.headBody;for(;d!==x;){let y=a[d];y.bodyMoveIndex!==x&&(n[y.bodyMoveIndex].fellAsleep=!0,y.bodyMoveIndex=x);let I=y.localIndex,C=r.sims.data[I],_=i.sims.count,S=mn(i.sims);if(C.copyTo(S),Fs(r.sims,I)!==x){let D=r.sims.data[I].bodyId,v=a[D];v.localIndex=I}Xs(r.states,I),y.setIndex=s,y.localIndex=_;let B=y.headContactKey;for(;B!==x;){let w=B>>1,D=B&1,v=l[w];if(B=v.edges[D].nextKey,v.setIndex===M.b2_disabledSet||v.colorIndex!==x)continue;let P=D^1,T=v.edges[P].bodyId;if(a[T].setIndex===M.b2_awakeSet)continue;let X=v.localIndex,F=r.contacts.data[X];if(v.setIndex=M.b2_disabledSet,v.localIndex=c.contacts.count,Xe(c.contacts).set(F),no(r.contacts,X)!==x){let st=r.contacts.data[X].contactId;l[st].localIndex=X}}d=y.islandNext}let p=o.headContact;for(;p!==x;){let y=l[p],I=y.colorIndex,C=t.constraintGraph.colors[I];I!==Mt&&(xo(C.bodySet,y.edges[0].bodyId),xo(C.bodySet,y.edges[1].bodyId));let _=y.localIndex,S=C.contacts.data[_],A=i.contacts.count;if(Xe(i.contacts).set(S),no(C.contacts,_)!==x){let v=C.contacts.data[_].contactId,P=l[v];P.localIndex=_}y.setIndex=s,y.colorIndex=x,y.localIndex=A,p=y.islandNext}let b=t.jointArray,u=o.headJoint;for(;u!==x;){let y=b[u],I=y.colorIndex,C=y.localIndex,_=t.constraintGraph.colors[I],S=_.joints.data[C];I!==Mt&&(xo(_.bodySet,y.edges[0].bodyId),xo(_.bodySet,y.edges[1].bodyId));let A=i.joints.count,B=oo(i.joints);if(S.copyTo(B),bn(_.joints,C)!==x){let v=_.joints.data[C].jointId,P=b[v];P.localIndex=C}y.setIndex=s,y.colorIndex=x,y.localIndex=A,u=y.islandNext}let h=o.localIndex,m=On(i.islands);if(m.islandId=e,Or(r.islands,h)!==x){let I=r.islands.data[h].islandId,C=t.islandArray[I];C.localIndex=h}o.setIndex=s,o.localIndex=0,Lt(t)}function il(t,e,o){let n=t.solverSetArray[e],s=t.solverSetArray[o];n.sims.count<s.sims.count&&([n,s]=[s,n],[e,o]=[o,e]);let r=t.bodyArray,i=s.sims.count;for(let u=0;u<i;++u){let h=s.sims.data[u],m=r[h.bodyId];m.setIndex=e,m.localIndex=n.sims.count;let f=mn(n.sims);Object.assign(f,h)}let c=t.contactArray,a=s.contacts.count;for(let u=0;u<a;++u){let h=s.contacts.data[u],m=c[h.contactId];m.setIndex=e,m.localIndex=n.contacts.count,Xe(n.contacts).set(h)}let l=t.jointArray,d=s.joints.count;for(let u=0;u<d;++u){let h=s.joints.data[u],m=l[h.jointId];m.setIndex=e,m.localIndex=n.joints.count;let f=oo(n.joints);Object.assign(f,h)}let p=t.islandArray,b=s.islands.count;for(let u=0;u<b;++u){let h=s.islands.data[u],m=h.islandId,f=p[m];f.setIndex=e,f.localIndex=n.islands.count;let y=On(n.islands);Object.assign(y,h)}Wn(t,o),Lt(t)}function Ls(t,e,o,n){let s=n.localIndex,r=o.sims.data[s],i=e.sims.count,c=mn(e.sims);if(Object.assign(c,r),Fs(o.sims,s)!==x){let d=o.sims.data[s].bodyId,p=t.bodyArray[d];p.localIndex=s}if(o.setIndex===M.b2_awakeSet)Xs(o.states,s);else if(e.setIndex===M.b2_awakeSet){let l=js(e.states);Object.assign(l,new Pt)}n.setIndex=e.setIndex,n.localIndex=i}function So(t,e,o,n){let s=n.localIndex,r=n.colorIndex,i;if(o.setIndex===M.b2_awakeSet?i=t.constraintGraph.colors[r].joints.data[s]:i=o.joints.data[s],e.setIndex===M.b2_awakeSet)Qi(t,i,n),n.setIndex=M.b2_awakeSet;else{n.setIndex=e.setIndex,n.localIndex=e.joints.count,n.colorIndex=x;let c=oo(e.joints);Object.assign(c,i)}if(o.setIndex===M.b2_awakeSet)Tr(t,n.edges[0].bodyId,n.edges[1].bodyId,r,s);else if(bn(o.joints,s)!==x){let l=o.joints.data[s].jointId,d=t.jointArray[l];d.localIndex=s}}var yn={b2_stagePrepareJoints:0,b2_stagePrepareContacts:1,b2_stageIntegrateVelocities:2,b2_stageWarmStart:3,b2_stageSolve:4,b2_stageIntegratePositions:5,b2_stageRelax:6,b2_stageRestitution:7,b2_stageStoreImpulses:8},qs={b2_bodyBlock:0,b2_jointBlock:1,b2_contactBlock:2,b2_graphJointBlock:3,b2_graphContactBlock:4},fn=class{constructor(){this.startIndex=0,this.count=0,this.blockType=0,this.syncIndex=0}},na=class{constructor(){this.type=0,this.blocks=null,this.blockCount=0,this.colorIndex=0,this.completionCount=0}},pl=class{constructor(){this.context=new Vs,this.workerIndex=0,this.userTask=null}},re=class t{constructor(e=0,o=0,n=0){this.biasRate=e,this.massScale=o,this.impulseScale=n}clone(){return new t(this.biasRate,this.massScale,this.impulseScale)}},Vs=class{constructor(){this.dt=0,this.inv_dt=0,this.h=0,this.inv_h=0,this.subStepCount=0,this.jointSoftness=new re(0,0,0),this.contactSoftness=new re(0,0,0),this.staticSoftness=new re(0,0,0),this.restitutionThreshold=0,this.maxLinearVelocity=0,this.world=null,this.graph=null,this.states=null,this.sims=null,this.enlargedShapes=null,this.enlargedShapeCount=0,this.fastBodies=null,this.fastBodyCount=0,this.bulletBodies=null,this.bulletBodyCount=0,this.joints=null,this.contacts=null,this.simdContactConstraints=null,this.activeColorCount=0,this.workerCount=0,this.stages=null,this.stageCount=0,this.enableWarmStarting=!1,this.atomicSyncBits=0}};function ie(t,e,o){if(t===0)return new re(0,1,0);let n=2*Co*t,s=2*e+o*n,r=o*n*s,i=1/(1+r);return new re(n/s,r*i,i)}function Pm(t,e,o){let n=o.states,s=o.sims,r=o.world.gravity,i=o.h,c=o.maxLinearVelocity,a=th*o.inv_dt,l=c*c,d=a*a;for(let p=t;p<e;++p){let b=s[p],u=n[p],h=u.linearVelocity,m=u.angularVelocity,f=1/(1+i*b.linearDamping),y=1/(1+i*b.angularDamping),I=b.mass*b.gravityScale,C=i*b.invMass,_=C*(b.force.x+I*r.x),S=C*(b.force.y+I*r.y),A=i*b.invInertia*b.torque;h.x=_+f*h.x,h.y=S+f*h.y,m=A+y*m;let B=h.x*h.x+h.y*h.y;if(B>l){let w=c/Math.sqrt(B);h.x*=w,h.y*=w,b.isSpeedCapped=!0}if(m*m>d&&b.allowFastRotation===!1){let w=a/Math.abs(m);m*=w,b.isSpeedCapped=!0}u.linearVelocity=h,u.angularVelocity=m}}function km(t,e,o){let n=o.states,s=o.h;for(let r=t;r<e;++r){let i=n[r];q2(i.deltaRotation,s*i.angularVelocity,i.deltaRotation),i.deltaPosition.x=i.deltaPosition.x+s*i.linearVelocity.x,i.deltaPosition.y=i.deltaPosition.y+s*i.linearVelocity.y}}function Tm(t,e,o,n){let s=n,r=s.world,i=r.enableSleep,c=s.states,a=s.sims,l=r.bodyArray,d=s.dt,p=s.inv_dt,b=r.worldId,u=r.bodyMoveEventArray,h=r.islandArray,m=r.taskContextArray[o].enlargedSimBitSet,f=r.taskContextArray[o].awakeIslandBitSet,y=r.taskContextArray[o],I=r.enableContinuous,C=Qt,_=vn;for(let S=t;S<e;++S){let A=c[S],B=a[S],w=A.linearVelocity,D=A.angularVelocity;B.center.x+=A.deltaPosition.x,B.center.y+=A.deltaPosition.y;let v=O2(A.deltaRotation,B.transform.q),P=U2(A.deltaRotation,B.transform.q),T=F2(v,P);B.transform.q=new rt(T*v,T*P);let R=Yt(w)+Math.abs(D)*B.maxExtent,X=Yt(A.deltaPosition)+Math.abs(A.deltaRotation.s)*B.maxExtent,E=Math.max(R,.5*p*X);A.deltaPosition.x=0,A.deltaPosition.y=0,A.deltaRotation.c=1,A.deltaRotation.s=0,B.transform.p.x=B.center.x-(B.transform.q.c*B.localCenter.x-B.transform.q.s*B.localCenter.y),B.transform.p.y=B.center.y-(B.transform.q.s*B.localCenter.x+B.transform.q.c*B.localCenter.y);let W=l[B.bodyId];W.bodyMoveIndex=S,u[S].transform=B.transform,u[S].bodyId=new Ee(B.bodyId+1,b,W.revision),u[S].userData=W.userData,u[S].fellAsleep=!1,B.force.x=0,B.force.y=0,B.torque=0,W.isSpeedCapped=B.isSpeedCapped,B.isSpeedCapped=!1,B.isFast=!1,i===!1||W.enableSleep===!1||E>W.sleepThreshold?(W.sleepTime=0,W.type===tt.b2_dynamicBody&&I&&R*d>.5*B.minExtent?(B.isBullet?(s.bulletBodyCount++,s.bulletBodies[s.bulletBodyCount-1]=S):(s.fastBodyCount++,s.fastBodies[s.fastBodyCount-1]=S),B.isFast=!0):(B.center0X=B.center.x,B.center0Y=B.center.y,B.rotation0.x=B.transform.q.x,B.rotation0.y=B.transform.q.y)):(B.center0X=B.center.x,B.center0Y=B.center.y,B.rotation0.x=B.transform.q.x,B.rotation0.y=B.transform.q.y,W.sleepTime+=d);let et=h[W.islandId];if(W.sleepTime<eh){let nt=et.localIndex;eo(f,nt)}else et.constraintRemoveCount>0&&W.sleepTime>y.splitSleepTime&&(y.splitIslandId=W.islandId,y.splitSleepTime=W.sleepTime);let st=B.transform,ot=B.isFast,L=W.headShapeId;for(;L!==x;){let nt=r.shapeArray[L];if(ot)nt.isFast=!0,eo(m,S);else{let Ct=Xo(nt,st);if(Ct.lowerBoundX-=C,Ct.lowerBoundY-=C,Ct.upperBoundX+=C,Ct.upperBoundY+=C,nt.aabb=Ct,vo(nt.fatAABB,Ct)===!1){let N=new xt(Ct.lowerBoundX-_,Ct.lowerBoundY-_,Ct.upperBoundX+_,Ct.upperBoundY+_);nt.fatAABB=N,nt.enlargedAABB=!0,eo(m,S)}}L=nt.nextShapeId}}}function Gm(t,e,o){let n=t.type,s=o.startIndex,r=s+o.count;n===yn.b2_stageIntegrateVelocities?Pm(s,r,e):n===yn.b2_stageIntegratePositions&&km(s,r,e)}function Vo(t,e){let o=t.blockCount;for(let n=0;n<o;n++)Gm(t,e,t.blocks[n])}function Rm(t){let e=t.workerIndex,o=t.context,n=o.activeColorCount,s=o.stages;if(e===0){let r=0;Vo(s[r],o),r+=1,Vo(s[r],o),r+=1,ml(o),Nc(o);let i=o.subStepCount;for(let c=0;c<i;++c){let a=r;Vo(s[a],o),a+=1,yl(o),Wc(o);for(let d=0;d<n;++d)Vo(s[a],o),a+=1;let l=!0;sa(o,l),ta(o,l);for(let d=0;d<n;++d)Vo(s[a],o),a+=1;Vo(s[a],o),a+=1,l=!1,sa(o,l),ta(o,l);for(let d=0;d<n;++d)Vo(s[a],o),a+=1}r+=1+n+n+1+n;{Oc(o);let c=r;for(let a=0;a<n;++a)Vo(s[c],o),c+=1;r+=n}Uc(o),Vo(s[r],o),o.atomicSyncBits=Number.MAX_SAFE_INTEGER;return}}var Lm=new lo(new g,new g,new g,new rt,new rt);function dl(t,e,o){let n=o,s=n.fastShape,r=n.fastBodySim;if(e===s.id)return!0;let i=n.world,c=i.shapeArray[e];if(c.bodyId===s.bodyId||c.isSensor===!0)return!0;let a=Kr(s.filter,c.filter);if(a===!1)return!0;let l=i.bodyArray[c.bodyId],d=jt(i,l);if(d.isBullet)return!0;let p=i.bodyArray[r.bodyId];if(a=zr(i,p,l),a===!1)return!0;let b=i.customFilterFcn;if(b!=null){let y=new St(c.id+1,i.worldId,c.revision),I=new St(s.id+1,i.worldId,s.revision);if(a=b(y,I,i.customFilterContext),a===!1)return!0}if(c.type===Y.b2_chainSegmentShape){let y=d.transform,I=H(y,c.chainSegment.segment.point1),C=H(y,c.chainSegment.segment.point2),_=C.x-I.x,S=C.y-I.y,A=n.centroid1X,B=n.centroid1Y,w=n.centroid2X,D=n.centroid2Y,v=A-I.x,P=B-I.y,T=v*S-P*_;v=w-I.x,P=D-I.y;let R=v*S-P*_;if(T<0||R>0)return!0}let u=new cs;u.proxyA=$e(c),u.proxyB=$e(s),u.sweepA=ra(d,Lm),u.sweepB=n.sweep,u.tMax=n.fraction;let h=n.fraction,m=!1,f=_s(u);if(0<f.t&&f.t<n.fraction)h=f.t,m=!0;else if(f.t===0){let y=Ds(s);u.proxyB=vt([y],1,Qt),f=_s(u),0<f.t&&f.t<n.fraction&&(h=f.t,m=!0)}if(m&&(c.enablePreSolveEvents||s.enablePreSolveEvents)){let y=we(u.sweepA,h),I=we(u.sweepB,h),C=new To;Jh(c,y,s,I,C);let _=new St(c.id+1,i.worldId,c.revision),S=new St(s.id+1,i.worldId,s.revision);m=i.preSolveFcn(_,S,C,i.preSolveContext)}return m&&(n.fraction=h),!0}var ul=class{constructor(){this.world=null,this.fastBodySim=null,this.fastShape=null,this.centroid1X=0,this.centroid1Y=0,this.centroid2X=0,this.centroid2Y=0,this.sweep=null,this.fraction=0}},Yo=new g,bl=new g,Em=new lo(new g,new g,new g,new rt,new rt);function vh(t,e){let n=t.solverSetArray[M.b2_awakeSet].sims.data[e],s=t.shapeArray,r=ra(n,Em);Yo.x=r.c1.x-(r.q1.c*r.localCenter.x-r.q1.s*r.localCenter.y),Yo.y=r.c1.y-(r.q1.s*r.localCenter.x+r.q1.c*r.localCenter.y);let i=new at(Yo,r.q1);bl.x=r.c2.x-(r.q2.c*r.localCenter.x-r.q2.s*r.localCenter.y),bl.y=r.c2.y-(r.q2.s*r.localCenter.x+r.q2.c*r.localCenter.y);let c=new at(bl,r.q2),a=t.broadPhase.trees[tt.b2_staticBody],l=t.broadPhase.trees[tt.b2_kinematicBody],d=t.broadPhase.trees[tt.b2_dynamicBody],p=t.bodyArray[n.bodyId],b=new ul;b.world=t,b.sweep=r,b.fastBodySim=n,b.fraction=1;let u=n.isBullet,h=p.headShapeId;for(;h!=x;){let y=s[h];h=y.nextShapeId,y.isFast=!1,b.fastShape=y,Se(i,y.localCentroid,Yo),b.centroid1X=Yo.x,b.centroid1Y=Yo.y,Se(c,y.localCentroid,Yo),b.centroid2X=Yo.x,b.centroid2Y=Yo.y;let I=y.aabb,C=Xo(y,c),_=qt(I,C);y.aabb=C,!y.isSensor&&(ve(a,_,Pn,dl,b),u&&(ve(l,_,Pn,dl,b),ve(d,_,Pn,dl,b)))}let m=Qt,f=vn;if(b.fraction<1){let y=Di(r.q1,r.q2,b.fraction),I=$t(r.c1,r.c2,b.fraction),C=J(I,K(y,r.localCenter)),_=new at(C,y);for(n.transform=_,n.center=I,n.rotation0=y,n.center0X=I.x,n.center0Y=I.y,h=p.headShapeId;h!=x;){let S=s[h],A=Xo(S,_);if(A.lowerBoundX-=m,A.lowerBoundY-=m,A.upperBoundX+=m,A.upperBoundY+=m,S.aabb=A,!vo(S.fatAABB,A)){let B=new xt(A.lowerBoundX-f,A.lowerBoundY-f,A.upperBoundX+f,A.upperBoundY+f);S.fatAABB=B,S.enlargedAABB=!0,n.enlargeAABB=!0}h=S.nextShapeId}}else for(n.rotation0=n.transform.q,n.center0X=n.center.x,n.center0Y=n.center.y,h=p.headShapeId;h!=x;){let y=s[h];if(!vo(y.fatAABB,y.aabb)){let I=new xt(y.aabb.lowerBoundX-f,y.aabb.lowerBoundY-f,y.aabb.upperBoundX+f,y.aabb.upperBoundY+f);y.fatAABB=I,y.enlargedAABB=!0,n.enlargeAABB=!0}h=y.nextShapeId}}function jm(t,e,o){let n=o;for(let s=t;s<e;++s){let r=n.fastBodies[s];vh(n.world,r)}}function Fm(t,e,o){let n=o;for(let s=t;s<e;++s){let r=n.bulletBodies[s];vh(n.world,r)}}function hl(t,e){t.stepIndex+=1,fl(t);let o=t.solverSetArray[M.b2_awakeSet],n=o.sims.count;if(n===0)return;e.fastBodyCount=0,e.fastBodies=ze(t.stackAllocator,n,"fast bodies"),e.bulletBodyCount=0,e.bulletBodies=ze(t.stackAllocator,n,"bullet bodies");{let r=t.constraintGraph,i=r.colors;e.sims=o.sims.data,e.states=o.states.data;let c=0,a=0;for(let N=0;N<te-1;++N){let Q=i[N].contacts.count,wt=i[N].joints.count,ct=Q+wt;a+=ct>0?1:0,c+=wt}{let N=t.bodyMoveEventArray;for(;N.length<n;)N.push(new Fi)}let l=t.workerCount,d=4,p=d*l,b=32,u;n>b*p?(b=Math.floor(n/p),u=p):u=Math.floor(n-1>>5)+1;let h=new Array(te),m=new Array(te),f=new Array(te),y=new Array(te),I=new Array(te),C=new Array(te),_=0,S=0,A=i[Mt].contacts.count,B=ze(t.stackAllocator,A,"overflow contact constraint",()=>new Gr);r.colors[Mt].overflowConstraints=B;let w=d,D=S>0?Math.floor(S-1>>2)+1:0;S>w*p&&(w=Math.floor(S/p),D=p);let v=d,P=c>0?Math.floor(c-1>>2)+1:0;c>v*p&&(v=Math.floor(c/p),P=p);let T=0;T+=1,T+=1,T+=1,T+=a,T+=a,T+=1,T+=a,T+=a,T+=1;let R=Array.from({length:T},()=>new na),X=ze(t.stackAllocator,u,"body blocks"),F=ze(t.stackAllocator,D,"contact blocks"),E=ze(t.stackAllocator,P,"joint blocks"),W=ze(t.stackAllocator,_,"graph blocks");t.splitIslandId!=x&&Ur(t,t.splitIslandId);for(let N=0;N<u;++N){let Q=new fn;Q.startIndex=N*b,Q.count=b,Q.blockType=qs.b2_bodyBlock,Q.syncIndex=0,X[N]=Q}X[u-1].count=n-(u-1)*b;for(let N=0;N<P;++N){let Q=new fn;Q.startIndex=N*v,Q.count=v,Q.blockType=qs.b2_jointBlock,Q.syncIndex=0,E[N]=Q}P>0&&(E[P-1].count=c-(P-1)*v);for(let N=0;N<D;++N){let Q=new fn;Q.startIndex=N*w,Q.count=w,Q.blockType=qs.b2_contactBlock,Q.syncIndex=0,F[N]=Q}D>0&&(F[D-1].count=S-(D-1)*w);let et=new Array(te),st=0;for(let N=0;N<a;++N){et[N]=st;let Q=C[N],wt=I[N];for(let Tt=0;Tt<Q;++Tt){let lt=new fn;lt.startIndex=Tt*wt,lt.count=wt,lt.blockType=qs.b2_graphJointBlock,lt.syncIndex=0,W[st+Tt]=lt}Q>0&&(W[st+Q-1].count=y[N]-(Q-1)*wt,st+=Q);let ct=f[N],At=m[N];for(let Tt=0;Tt<ct;++Tt){let lt=new fn;lt.startIndex=Tt*At,lt.count=At,lt.blockType=qs.b2_graphContactBlock,lt.syncIndex=0,W[st+Tt]=lt}ct>0&&(W[st+ct-1].count=h[N]-(ct-1)*At,st+=ct)}let ot=st,L=0,nt=(N,Q,wt,ct,At=-1)=>{N.type=Q,N.blocks=wt,N.blockCount=ct,N.colorIndex=At,N.completionCount=0};nt(R[L++],yn.b2_stagePrepareJoints,E,P),nt(R[L++],yn.b2_stagePrepareContacts,F,D),nt(R[L++],yn.b2_stageIntegrateVelocities,X,u),nt(R[L++],yn.b2_stageIntegratePositions,X,u),nt(R[L++],yn.b2_stageStoreImpulses,F,D),e.graph=r,e.joints=null,e.contacts=null,e.simdContactConstraints=null,e.activeColorCount=a,e.workerCount=l,e.stageCount=T,e.stages=R;{let N=new pl;N.context=e,N.workerIndex=0,Rm(N)}t.splitIslandId=x;let Ct=o.islands.count;for(let N=0;N<t.workerCount;++N){let Q=t.taskContextArray[N];Q.enlargedSimBitSet=to(Q.enlargedSimBitSet,n),Q.awakeIslandBitSet=to(Q.awakeIslandBitSet,Ct),Q.splitIslandId=x,Q.splitSleepTime=0}Tm(0,n,0,e),Ke(t.stackAllocator,W),Ke(t.stackAllocator,E),Ke(t.stackAllocator,F),Ke(t.stackAllocator,X),Ke(t.stackAllocator,B)}{let r=t.hitEventThreshold,i=t.constraintGraph.colors;for(let c=0;c<te;++c){let a=i[c],l=a.contacts.count,d=a.contacts.data;for(let p=0;p<l;++p){let b=d[p];if(!(b.simFlags&Nt.b2_simEnableHitEvent))continue;let u=new ji;u.approachSpeed=r,u.shapeIdA=new St(0,0,0),u.shapeIdB=new St(0,0,0);let h=!1,m=b.manifold.pointCount;for(let f=0;f<m;++f){let y=b.manifold.points[f],I=-y.normalVelocity;I>u.approachSpeed&&y.maxNormalImpulse>0&&(u.approachSpeed=I,u.pointX=y.pointX,u.pointY=y.pointY,h=!0)}if(h===!0){u.normalX=b.manifold.normalX,u.normalY=b.manifold.normalY;let f=t.shapeArray[b.shapeIdA],y=t.shapeArray[b.shapeIdB];u.shapeIdA=new St(f.id+1,t.worldId,f.revision),u.shapeIdB=new St(y.id+1,t.worldId,y.revision),t.contactHitArray.push(u)}}}}let s=t.taskContextArray[0].enlargedSimBitSet;for(let r=1;r<t.workerCount;++r)ks(s,t.taskContextArray[r].enlargedSimBitSet);{let r=t.broadPhase,i=t.shapeArray,c=s.blockCount,a=s.bits;for(let l=0;l<c;++l){let d=a[l];for(;d!==0n;){let p=Vr(d),b=64*l+p,u=o.sims.data[b],m=t.bodyArray[u.bodyId].headShapeId;for(;m!==x;){let f=i[m];f.enlargedAABB?(xl(r,f.proxyKey,f.fatAABB),f.enlargedAABB=!1):f.isFast&&In(r,f.proxyKey),m=f.nextShapeId}d=d&d-1n}}}e.fastBodyCount>0&&jm(0,e.fastBodyCount,e);{let i=t.broadPhase.trees[tt.b2_dynamicBody],c=t.bodyArray,a=t.shapeArray,l=e.fastBodies,d=e.fastBodyCount;for(let p=0;p<d;++p){let b=o.sims.data[l[p]];if(b.enlargeAABB===!1)continue;b.enlargeAABB=!1;let h=c[b.bodyId].headShapeId;for(;h!==x;){let m=a[h];if(m.enlargedAABB===!1){h=m.nextShapeId;continue}m.enlargedAABB=!1;let f=m.proxyKey,y=xn(f);un(i,y,m.fatAABB),h=m.nextShapeId}}}e.bulletBodyCount>0&&Fm(0,e.bulletBodyCount,e);{let i=t.broadPhase.trees[tt.b2_dynamicBody],c=t.bodyArray,a=t.shapeArray,l=e.bulletBodies,d=e.bulletBodyCount;for(let p=0;p<d;++p){let b=o.sims.data[l[p]];if(b.enlargeAABB===!1)continue;b.enlargeAABB=!1;let h=c[b.bodyId].headShapeId;for(;h!==x;){let m=a[h];if(m.enlargedAABB===!1){h=m.nextShapeId;continue}m.enlargedAABB=!1;let f=m.proxyKey,y=xn(f);un(i,y,m.fatAABB),h=m.nextShapeId}}}if(Ke(t.stackAllocator,e.bulletBodies),e.bulletBodies=null,e.bulletBodyCount=0,Ke(t.stackAllocator,e.fastBodies),e.fastBodies=null,e.fastBodyCount=0,t.enableSleep===!0){let r=0;for(let l=0;l<t.workerCount;++l){let d=t.taskContextArray[l];d.splitIslandId!==x&&d.splitSleepTime>r&&(t.splitIslandId=d.splitIslandId,r=d.splitSleepTime)}let i=t.taskContextArray[0].awakeIslandBitSet;for(let l=1;l<t.workerCount;++l)ks(i,t.taskContextArray[l].awakeIslandBitSet);let c=o.islands.data,a=o.islands.count;for(let l=a-1;l>=0;l-=1){if(gh(i,l)===!0)continue;let p=c[l].islandId;Yr(t,p)}Lt(t)}}function Il(t,e){let n=q(t,k.b2_distanceJoint).distanceJoint;n.length=ht(e,It,De),n.impulse=0,n.lowerImpulse=0,n.upperImpulse=0}function Sl(t){return q(t,k.b2_distanceJoint).distanceJoint.length}function _l(t,e){let n=q(t,k.b2_distanceJoint).distanceJoint;n.enableLimit=e}function gl(t){return q(t,k.b2_distanceJoint).distanceJoint.enableLimit}function Bl(t,e,o){let s=q(t,k.b2_distanceJoint).distanceJoint;e=ht(e,It,De),o=ht(o,It,De),s.minLength=Math.min(e,o),s.maxLength=Math.max(e,o),s.impulse=0,s.lowerImpulse=0,s.upperImpulse=0}function Al(t){return q(t,k.b2_distanceJoint).distanceJoint.minLength}function Cl(t){return q(t,k.b2_distanceJoint).distanceJoint.maxLength}function wl(t){let e=q(t,k.b2_distanceJoint),o=O(t.world0);if(o.locked)return 0;let n=he(o,e.bodyIdA),s=he(o,e.bodyIdB),r=H(n,e.localOriginAnchorA),i=H(s,e.localOriginAnchorB),c=J(i,r);return Yt(c)}function vl(t,e){let o=q(t,k.b2_distanceJoint);o.distanceJoint.enableSpring=e}function Jl(t){return q(t,k.b2_distanceJoint).distanceJoint.enableSpring}function Ml(t,e){let o=q(t,k.b2_distanceJoint);o.distanceJoint.hertz=e}function Dl(t,e){let o=q(t,k.b2_distanceJoint);o.distanceJoint.dampingRatio=e}function Pl(t){return q(t,k.b2_distanceJoint).distanceJoint.hertz}function kl(t){return q(t,k.b2_distanceJoint).distanceJoint.dampingRatio}function Tl(t,e){let o=q(t,k.b2_distanceJoint);e!==o.distanceJoint.enableMotor&&(o.distanceJoint.enableMotor=e,o.distanceJoint.motorImpulse=0)}function Gl(t){return q(t,k.b2_distanceJoint).distanceJoint.enableMotor}function Rl(t,e){let o=q(t,k.b2_distanceJoint);o.distanceJoint.motorSpeed=e}function Ll(t){return q(t,k.b2_distanceJoint).distanceJoint.motorSpeed}function El(t){let e=O(t.world0),o=q(t,k.b2_distanceJoint);return e.inv_h*o.distanceJoint.motorImpulse}function jl(t,e){let o=q(t,k.b2_distanceJoint);o.distanceJoint.maxMotorForce=e}function Fl(t){return q(t,k.b2_distanceJoint).distanceJoint.maxMotorForce}function Xl(t,e){let o=e.distanceJoint,n=he(t,e.bodyIdA),s=he(t,e.bodyIdB),r=H(n,e.localOriginAnchorA),i=H(s,e.localOriginAnchorB),c=J(i,r),a=dt(c),l=(o.impulse+o.lowerImpulse-o.upperImpulse+o.motorImpulse)*t.inv_h;return it(l,a)}function ql(t,e){let o=e.world,n=o.bodyArray,s=t.bodyIdA,r=t.bodyIdB,i=n[s],c=n[r],a=o.solverSetArray[i.setIndex],l=o.solverSetArray[c.setIndex],d=a.sims.data[i.localIndex],p=l.sims.data[c.localIndex],b=d.invMass,u=d.invInertia,h=p.invMass,m=p.invInertia;t.invMassA=b,t.invMassB=h,t.invIA=u,t.invIB=m;let f=t.distanceJoint;f.indexA=i.setIndex===M.b2_awakeSet?i.localIndex:x,f.indexB=c.setIndex===M.b2_awakeSet?c.localIndex:x,f.anchorA=K(d.transform.q,J(t.localOriginAnchorA,d.localCenter)),f.anchorB=K(p.transform.q,J(t.localOriginAnchorB,p.localCenter)),f.deltaCenter=J(p.center,d.center);let y=f.anchorA,I=f.anchorB,C=U(J(I,y),f.deltaCenter),_=dt(C),S=z(y,_),A=z(I,_),B=b+h+u*S*S+m*A*A;f.axialMass=B>0?1/B:0,f.distanceSoftness=ie(f.hertz,f.dampingRatio,e.h),e.enableWarmStarting===!1&&(f.impulse=0,f.lowerImpulse=0,f.upperImpulse=0,f.motorImpulse=0)}function Vl(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new Pt,c=t.distanceJoint,a=c.indexA===x?i:e.states[c.indexA],l=c.indexB===x?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB),b=U(J(l.deltaPosition,a.deltaPosition),J(p,d)),u=U(c.deltaCenter,b),h=dt(u),m=c.impulse+c.lowerImpulse-c.upperImpulse+c.motorImpulse,f=it(m,h);a.linearVelocity=yt(a.linearVelocity,o,f),a.angularVelocity-=s*z(d,f),l.linearVelocity=$(l.linearVelocity,n,f),l.angularVelocity+=r*z(p,f)}function Yl(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new Pt,a=t.distanceJoint,l=a.indexA===x?c:e.states[a.indexA],d=a.indexB===x?c:e.states[a.indexB],p=l.linearVelocity,b=l.angularVelocity,u=d.linearVelocity,h=d.angularVelocity,m=K(l.deltaRotation,a.anchorA),f=K(d.deltaRotation,a.anchorB),y=U(J(d.deltaPosition,l.deltaPosition),J(f,m)),I=U(a.deltaCenter,y),C=Yt(I),_=dt(I);if(a.enableSpring&&(a.minLength<a.maxLength||a.enableLimit===!1)){if(a.hertz>0){let S=U(J(u,p),J(Gt(h,f),Gt(b,m))),A=j(_,S),B=C-a.length,w=a.distanceSoftness.biasRate*B,v=-(a.distanceSoftness.massScale*a.axialMass)*(A+w)-a.distanceSoftness.impulseScale*a.impulse;a.impulse+=v;let P=it(v,_);p=yt(p,n,P),b-=r*z(m,P),u=$(u,s,P),h+=i*z(f,P)}if(a.enableLimit){{let S=U(J(u,p),J(Gt(h,f),Gt(b,m))),A=j(_,S),B=C-a.minLength,w=0,D=1,v=0;B>0?w=B*e.inv_h:o&&(w=e.jointSoftness.biasRate*B,D=e.jointSoftness.massScale,v=e.jointSoftness.impulseScale);let P=-D*a.axialMass*(A+w)-v*a.lowerImpulse,T=Math.max(0,a.lowerImpulse+P),R=T-a.lowerImpulse;a.lowerImpulse=T;let X=it(R,_);p=yt(p,n,X),b-=r*z(m,X),u=$(u,s,X),h+=i*z(f,X)}{let S=U(J(p,u),J(Gt(b,m),Gt(h,f))),A=j(_,S),B=a.maxLength-C,w=0,D=1,v=0;B>0?w=B*e.inv_h:o&&(w=e.jointSoftness.biasRate*B,D=e.jointSoftness.massScale,v=e.jointSoftness.impulseScale);let P=-D*a.axialMass*(A+w)-v*a.upperImpulse,T=Math.max(0,a.upperImpulse+P),R=T-a.upperImpulse;a.upperImpulse=T;let X=it(-R,_);p=yt(p,n,X),b-=r*z(m,X),u=$(u,s,X),h+=i*z(f,X)}}if(a.enableMotor){let S=U(J(u,p),J(Gt(h,f),Gt(b,m))),A=j(_,S),B=a.axialMass*(a.motorSpeed-A),w=a.motorImpulse,D=e.h*a.maxMotorForce;a.motorImpulse=ht(a.motorImpulse+B,-D,D);let v=a.motorImpulse-w,P=it(v,_);p=yt(p,n,P),b-=r*z(m,P),u=$(u,s,P),h+=i*z(f,P)}}else{let S=U(J(u,p),J(Gt(h,f),Gt(b,m))),A=j(_,S),B=C-a.length,w=0,D=1,v=0;o&&(w=e.jointSoftness.biasRate*B,D=e.jointSoftness.massScale,v=e.jointSoftness.impulseScale);let P=-D*a.axialMass*(A+w)-v*a.impulse;a.impulse+=P;let T=it(P,_);p=yt(p,n,T),b-=r*z(m,T),u=$(u,s,T),h+=i*z(f,T)}l.linearVelocity=p,l.angularVelocity=b,d.linearVelocity=u,d.angularVelocity=h}function Nl(t,e,o,n){let s=e.distanceJoint,r=H(o,e.localOriginAnchorA),i=H(n,e.localOriginAnchorB),c=dt(J(i,r));if(s.minLength<s.maxLength&&s.enableLimit){let a=$(r,s.minLength,c),l=$(r,s.maxLength,c),d=it(.05*We,de(c));s.minLength>It&&t.DrawSegment(J(a,d),U(a,d),V.b2_colorLightGreen,t.context),s.maxLength<De&&t.DrawSegment(J(l,d),U(l,d),V.b2_colorRed,t.context),s.minLength>It&&s.maxLength<De&&t.DrawSegment(a,l,V.b2_colorGray,t.context)}if(t.DrawSegment(r,i,V.b2_colorWhite,t.context),t.DrawPoint(r.x,r.y,4,V.b2_colorWhite,t.context),t.DrawPoint(i.x,i.y,4,V.b2_colorWhite,t.context),s.hertz>0&&s.enableSpring){let a=$(r,s.length,c);t.DrawPoint(a.x,a.y,4,V.b2_colorBlue,t.context)}}function Wl(t,e){let o=q(t,k.b2_prismaticJoint);e!==o.prismaticJoint.enableSpring&&(o.prismaticJoint.enableSpring=e,o.prismaticJoint.springImpulse=0)}function Ol(t){return q(t,k.b2_prismaticJoint).prismaticJoint.enableSpring}function Ul(t,e){let o=q(t,k.b2_prismaticJoint);o.prismaticJoint.hertz=e}function zl(t){return q(t,k.b2_prismaticJoint).prismaticJoint.hertz}function Kl(t,e){let o=q(t,k.b2_prismaticJoint);o.prismaticJoint.dampingRatio=e}function Hl(t){return q(t,k.b2_prismaticJoint).prismaticJoint.dampingRatio}function $l(t,e){let o=q(t,k.b2_prismaticJoint);e!==o.prismaticJoint.enableLimit&&(o.prismaticJoint.enableLimit=e,o.prismaticJoint.lowerImpulse=0,o.prismaticJoint.upperImpulse=0)}function Ql(t){return q(t,k.b2_prismaticJoint).prismaticJoint.enableLimit}function Zl(t){return q(t,k.b2_prismaticJoint).prismaticJoint.lowerTranslation}function td(t){return q(t,k.b2_prismaticJoint).prismaticJoint.upperTranslation}function ed(t,e,o){let n=q(t,k.b2_prismaticJoint);(e!==n.prismaticJoint.lowerTranslation||o!==n.prismaticJoint.upperTranslation)&&(n.prismaticJoint.lowerTranslation=Math.min(e,o),n.prismaticJoint.upperTranslation=Math.max(e,o),n.prismaticJoint.lowerImpulse=0,n.prismaticJoint.upperImpulse=0)}function od(t,e){let o=q(t,k.b2_prismaticJoint);e!==o.prismaticJoint.enableMotor&&(o.prismaticJoint.enableMotor=e,o.prismaticJoint.motorImpulse=0)}function nd(t){return q(t,k.b2_prismaticJoint).prismaticJoint.enableMotor}function sd(t,e){let o=q(t,k.b2_prismaticJoint);o.prismaticJoint.motorSpeed=e}function rd(t){return q(t,k.b2_prismaticJoint).prismaticJoint.motorSpeed}function id(t){let e=O(t.world0),o=q(t,k.b2_prismaticJoint);return e.inv_h*o.prismaticJoint.motorImpulse}function ad(t,e){let o=q(t,k.b2_prismaticJoint);o.prismaticJoint.maxMotorForce=e}function cd(t){return q(t,k.b2_prismaticJoint).prismaticJoint.maxMotorForce}function ld(t,e){let o=e.bodyIdA,n=he(t,o),s=e.prismaticJoint,r=K(n.q,s.localAxisA),i=le(r),c=t.inv_h,a=c*s.impulse.x,l=c*(s.motorImpulse+s.lowerImpulse-s.upperImpulse);return U(it(a,i),it(l,r))}function dd(t,e){return t.inv_h*e.prismaticJoint.impulse.y}function bd(t,e){let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n],a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex,b=a.sims.data[i.localIndex],u=l.sims.data[c.localIndex],h=b.invMass,m=b.invInertia,f=u.invMass,y=u.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let I=t.prismaticJoint;I.indexA=i.setIndex==M.b2_awakeSet?d:x,I.indexB=c.setIndex==M.b2_awakeSet?p:x;let C=b.transform.q,_=u.transform.q;I.anchorA=K(C,J(t.localOriginAnchorA,b.localCenter)),I.anchorB=K(_,J(t.localOriginAnchorB,u.localCenter)),I.axisA=K(C,I.localAxisA),I.deltaCenter=J(u.center,b.center),I.deltaAngle=oe(_,C)-I.referenceAngle;let S=I.anchorA,A=I.anchorB,B=U(I.deltaCenter,J(A,S)),w=z(U(B,S),I.axisA),D=z(A,I.axisA),v=h+f+m*w*w+y*D*D;I.axialMass=v>0?1/v:0,I.springSoftness=ie(I.hertz,I.dampingRatio,e.h),e.enableWarmStarting==!1&&(I.impulse=new g(0,0),I.springImpulse=0,I.motorImpulse=0,I.lowerImpulse=0,I.upperImpulse=0)}function pd(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new Pt,c=t.prismaticJoint,a=c.indexA==x?i:e.states[c.indexA],l=c.indexB==x?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB),b=U(U(J(l.deltaPosition,a.deltaPosition),c.deltaCenter),J(p,d)),u=K(a.deltaRotation,c.axisA),h=z(U(b,d),u),m=z(p,u),f=c.springImpulse+c.motorImpulse+c.lowerImpulse-c.upperImpulse,y=le(u),I=z(U(b,d),y),C=z(p,y),_=c.impulse.x,S=c.impulse.y,A=U(it(f,u),it(_,y)),B=f*h+_*I+S,w=f*m+_*C+S;a.linearVelocity=yt(a.linearVelocity,o,A),a.angularVelocity-=s*B,l.linearVelocity=$(l.linearVelocity,n,A),l.angularVelocity+=r*w}function ud(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new Pt,a=t.prismaticJoint,l=a.indexA===x?c:e.states[a.indexA],d=a.indexB===x?c:e.states[a.indexB],p=l.linearVelocity,b=l.angularVelocity,u=d.linearVelocity,h=d.angularVelocity,m=K(l.deltaRotation,a.anchorA),f=K(d.deltaRotation,a.anchorB),y=U(U(J(d.deltaPosition,l.deltaPosition),a.deltaCenter),J(f,m)),I=K(l.deltaRotation,a.axisA),C=j(I,y),_=z(U(y,m),I),S=z(f,I);if(a.enableSpring){let A=C,B=a.springSoftness.biasRate*A,w=a.springSoftness.massScale,D=a.springSoftness.impulseScale,v=j(I,J(u,p))+S*h-_*b,P=-w*a.axialMass*(v+B)-D*a.springImpulse;a.springImpulse+=P;let T=it(P,I),R=P*_,X=P*S;p=yt(p,n,T),b-=r*R,u=$(u,s,T),h+=i*X}if(a.enableMotor){let A=j(I,J(u,p))+S*h-_*b,B=a.axialMass*(a.motorSpeed-A),w=a.motorImpulse,D=e.h*a.maxMotorForce;a.motorImpulse=ht(a.motorImpulse+B,-D,D),B=a.motorImpulse-w;let v=it(B,I),P=B*_,T=B*S;p=yt(p,n,v),b-=r*P,u=$(u,s,v),h+=i*T}if(a.enableLimit){{let A=C-a.lowerTranslation,B=0,w=1,D=0;A>0?B=A*e.inv_h:o&&(B=e.jointSoftness.biasRate*A,w=e.jointSoftness.massScale,D=e.jointSoftness.impulseScale);let v=a.lowerImpulse,P=j(I,J(u,p))+S*h-_*b,T=-a.axialMass*w*(P+B)-D*v;a.lowerImpulse=Math.max(v+T,0),T=a.lowerImpulse-v;let R=it(T,I),X=T*_,F=T*S;p=yt(p,n,R),b-=r*X,u=$(u,s,R),h+=i*F}{let A=a.upperTranslation-C,B=0,w=1,D=0;A>0?B=A*e.inv_h:o&&(B=e.jointSoftness.biasRate*A,w=e.jointSoftness.massScale,D=e.jointSoftness.impulseScale);let v=a.upperImpulse,P=j(I,J(p,u))+_*b-S*h,T=-a.axialMass*w*(P+B)-D*v;a.upperImpulse=Math.max(v+T,0),T=a.upperImpulse-v;let R=it(T,I),X=T*_,F=T*S;p=$(p,n,R),b+=r*X,u=yt(u,s,R),h-=i*F}}{let A=le(I),B=z(U(y,m),A),w=z(f,A),D=new g(j(A,J(u,p))+w*h-B*b,h-b),v=new g,P=1,T=0;if(o){let nt=new g(j(A,y),oe(d.deltaRotation,l.deltaRotation)+a.deltaAngle);v=it(e.jointSoftness.biasRate,nt),P=e.jointSoftness.massScale,T=e.jointSoftness.impulseScale}let R=n+s+r*B*B+i*w*w,X=r*B+i*w,F=r+i;F===0&&(F=1);let E=new ao(new g(R,X),new g(X,F)),W=zo(E,U(D,v)),et=new g(-P*W.x-T*a.impulse.x,-P*W.y-T*a.impulse.y);a.impulse.x+=et.x,a.impulse.y+=et.y;let st=it(et.x,A),ot=et.x*B+et.y,L=et.x*w+et.y;p=yt(p,n,st),b-=r*ot,u=$(u,s,st),h+=i*L}l.linearVelocity=p,l.angularVelocity=b,d.linearVelocity=u,d.angularVelocity=h}function hd(t,e,o,n){let s=e.prismaticJoint,r=H(o,e.localOriginAnchorA),i=H(n,e.localOriginAnchorB),c=K(o.q,s.localAxisA),a=V.b2_colorGray7,l=V.b2_colorGreen,d=V.b2_colorRed,p=V.b2_colorBlue,b=V.b2_colorGray4;if(t.DrawSegment(r,i,b,t.context),s.enableLimit){let u=$(r,s.lowerTranslation,c),h=$(r,s.upperTranslation,c),m=le(c);t.DrawSegment(u,h,a,t.context),t.DrawSegment(yt(u,.1,m),$(u,.1,m),l,t.context),t.DrawSegment(yt(h,.1,m),$(h,.1,m),d,t.context)}else t.DrawSegment(yt(r,1,c),$(r,1,c),a,t.context);t.DrawPoint(r.x,r.y,5,a,t.context),t.DrawPoint(i.x,i.y,5,p,t.context)}function md(t,e){let o=q(t,k.b2_revoluteJoint);e!==o.revoluteJoint.enableSpring&&(o.revoluteJoint.enableSpring=e,o.revoluteJoint.springImpulse=0)}function yd(t){return q(t,k.b2_revoluteJoint).revoluteJoint.enableSpring}function fd(t,e){let o=q(t,k.b2_revoluteJoint);o.revoluteJoint.hertz=e}function xd(t){return q(t,k.b2_revoluteJoint).revoluteJoint.hertz}function Id(t,e){let o=q(t,k.b2_revoluteJoint);o.revoluteJoint.dampingRatio=e}function Sd(t){return q(t,k.b2_revoluteJoint).revoluteJoint.dampingRatio}function _d(t){let e=O(t.world0),o=q(t,k.b2_revoluteJoint),n=he(e,o.bodyIdA),s=he(e,o.bodyIdB),r=oe(s.q,n.q)-o.revoluteJoint.referenceAngle;return r=wo(r),r}function gd(t,e){let o=q(t,k.b2_revoluteJoint);e!==o.revoluteJoint.enableLimit&&(o.revoluteJoint.enableLimit=e,o.revoluteJoint.lowerImpulse=0,o.revoluteJoint.upperImpulse=0)}function Bd(t){return q(t,k.b2_revoluteJoint).revoluteJoint.enableLimit}function Ad(t){return q(t,k.b2_revoluteJoint).revoluteJoint.lowerAngle}function Cd(t){return q(t,k.b2_revoluteJoint).revoluteJoint.upperAngle}function wd(t,e,o){let n=q(t,k.b2_revoluteJoint);(e!==n.revoluteJoint.lowerAngle||o!==n.revoluteJoint.upperAngle)&&(n.revoluteJoint.lowerAngle=Math.min(e,o),n.revoluteJoint.upperAngle=Math.max(e,o),n.revoluteJoint.lowerImpulse=0,n.revoluteJoint.upperImpulse=0)}function vd(t,e){let o=q(t,k.b2_revoluteJoint);e!==o.revoluteJoint.enableMotor&&(o.revoluteJoint.enableMotor=e,o.revoluteJoint.motorImpulse=0)}function Jd(t){return q(t,k.b2_revoluteJoint).revoluteJoint.enableMotor}function Md(t,e){let o=q(t,k.b2_revoluteJoint);o.revoluteJoint.motorSpeed=e}function Dd(t){return q(t,k.b2_revoluteJoint).revoluteJoint.motorSpeed}function Pd(t){let e=O(t.world0),o=q(t,k.b2_revoluteJoint);return e.inv_h*o.revoluteJoint.motorImpulse}function kd(t,e){let o=q(t,k.b2_revoluteJoint);o.revoluteJoint.maxMotorTorque=e}function Td(t){return q(t,k.b2_revoluteJoint).revoluteJoint.maxMotorTorque}function Gd(t,e){return it(t.inv_h,e.revoluteJoint.linearImpulse)}function Rd(t,e){let o=e.revoluteJoint;return t.inv_h*(o.motorImpulse+o.lowerImpulse-o.upperImpulse)}function Ld(t,e){let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n],a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex,b=a.sims.data[i.localIndex],u=l.sims.data[c.localIndex],h=b.invMass,m=b.invInertia,f=u.invMass,y=u.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let I=t.revoluteJoint;I.indexA=i.setIndex===M.b2_awakeSet?d:x,I.indexB=c.setIndex===M.b2_awakeSet?p:x,I.anchorA=K(b.transform.q,J(t.localOriginAnchorA,b.localCenter)),I.anchorB=K(u.transform.q,J(t.localOriginAnchorB,u.localCenter)),I.deltaCenter=J(u.center,b.center),I.deltaAngle=oe(u.transform.q,b.transform.q)-I.referenceAngle,I.deltaAngle=wo(I.deltaAngle);let C=m+y;I.axialMass=C>0?1/C:0,I.springSoftness=ie(I.hertz,I.dampingRatio,e.h),e.enableWarmStarting===!1&&(I.linearImpulse=new g(0,0),I.springImpulse=0,I.motorImpulse=0,I.lowerImpulse=0,I.upperImpulse=0)}function Ed(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new Pt,c=t.revoluteJoint,a=c.indexA===x?i:e.states[c.indexA],l=c.indexB===x?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB),b=c.springImpulse+c.motorImpulse+c.lowerImpulse-c.upperImpulse;a.linearVelocity=yt(a.linearVelocity,o,c.linearImpulse),a.angularVelocity-=s*(z(d,c.linearImpulse)+b),l.linearVelocity=$(l.linearVelocity,n,c.linearImpulse),l.angularVelocity+=r*(z(p,c.linearImpulse)+b)}function jd(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new Pt,a=t.revoluteJoint,l=a.indexA===x?c:e.states[a.indexA],d=a.indexB===x?c:e.states[a.indexB],p=l.linearVelocity.clone(),b=l.angularVelocity,u=d.linearVelocity.clone(),h=d.angularVelocity,m=r+i===0;if(a.enableSpring&&m===!1){let f=oe(d.deltaRotation,l.deltaRotation)+a.deltaAngle,y=a.springSoftness.biasRate*f,I=a.springSoftness.massScale,C=a.springSoftness.impulseScale,_=h-b,S=-I*a.axialMass*(_+y)-C*a.springImpulse;a.springImpulse+=S,b-=r*S,h+=i*S}if(a.enableMotor&&m===!1){let f=h-b-a.motorSpeed,y=-a.axialMass*f,I=a.motorImpulse,C=e.h*a.maxMotorTorque;a.motorImpulse=ht(a.motorImpulse+y,-C,C),y=a.motorImpulse-I,b-=r*y,h+=i*y}if(a.enableLimit&&m===!1){let f=oe(d.deltaRotation,l.deltaRotation)+a.deltaAngle;f=wo(f);{let y=f-a.lowerAngle,I=0,C=1,_=0;y>0?I=y*e.inv_h:o&&(I=e.jointSoftness.biasRate*y,C=e.jointSoftness.massScale,_=e.jointSoftness.impulseScale);let S=h-b,A=-C*a.axialMass*(S+I)-_*a.lowerImpulse,B=a.lowerImpulse;a.lowerImpulse=Math.max(a.lowerImpulse+A,0),A=a.lowerImpulse-B,b-=r*A,h+=i*A}{let y=a.upperAngle-f,I=0,C=1,_=0;y>0?I=y*e.inv_h:o&&(I=e.jointSoftness.biasRate*y,C=e.jointSoftness.massScale,_=e.jointSoftness.impulseScale);let S=b-h,A=-C*a.axialMass*(S+I)-_*a.lowerImpulse,B=a.upperImpulse;a.upperImpulse=Math.max(a.upperImpulse+A,0),A=a.upperImpulse-B,b+=r*A,h-=i*A}}{let f=K(l.deltaRotation,a.anchorA),y=K(d.deltaRotation,a.anchorB),I=J(U(u,Gt(h,y)),U(p,Gt(b,f))),C=new g(0,0),_=1,S=0;if(o){let D=l.deltaPosition,v=d.deltaPosition,P=U(U(J(v,D),J(y,f)),a.deltaCenter);C=it(e.jointSoftness.biasRate,P),_=e.jointSoftness.massScale,S=e.jointSoftness.impulseScale}let A={cx:new g(0,0),cy:new g(0,0)};A.cx.x=n+s+f.y*f.y*r+y.y*y.y*i,A.cy.x=-f.y*f.x*r-y.y*y.x*i,A.cx.y=A.cy.x,A.cy.y=n+s+f.x*f.x*r+y.x*y.x*i;let B=zo(A,U(I,C)),w=new g(-_*B.x-S*a.linearImpulse.x,-_*B.y-S*a.linearImpulse.y);a.linearImpulse.x+=w.x,a.linearImpulse.y+=w.y,p=yt(p,n,w),b-=r*z(f,w),u=$(u,s,w),h+=i*z(y,w)}l.linearVelocity=p,l.angularVelocity=b,d.linearVelocity=u,d.angularVelocity=h}function Fd(t,e,o,n,s){let r=H(o,e.localOriginAnchorA),i=H(n,e.localOriginAnchorB),c=V.b2_colorRed,a=s;t.DrawCircle(i,a,c,t.context);let l=oe(n.q,o.q),d=new g(a*Math.cos(l),a*Math.sin(l)),p=U(i,d);t.DrawSegment(i,p,c,t.context);let b=V.b2_colorGold;t.DrawSegment(o.p,r,b,t.context),t.DrawSegment(r,i,b,t.context),t.DrawSegment(n.p,i,b,t.context)}function Xd(t,e){let o=q(t,k.b2_wheelJoint);e!==o.wheelJoint.enableSpring&&(o.wheelJoint.enableSpring=e,o.wheelJoint.springImpulse=0)}function qd(t){return q(t,k.b2_wheelJoint).wheelJoint.enableSpring}function Vd(t,e){let o=q(t,k.b2_wheelJoint);o.wheelJoint.hertz=e}function Yd(t){return q(t,k.b2_wheelJoint).wheelJoint.hertz}function Nd(t,e){let o=q(t,k.b2_wheelJoint);o.wheelJoint.dampingRatio=e}function Wd(t){return q(t,k.b2_wheelJoint).wheelJoint.dampingRatio}function Od(t,e){let o=q(t,k.b2_wheelJoint);o.wheelJoint.enableLimit!==e&&(o.wheelJoint.lowerImpulse=0,o.wheelJoint.upperImpulse=0,o.wheelJoint.enableLimit=e)}function Ud(t){return q(t,k.b2_wheelJoint).wheelJoint.enableLimit}function zd(t){return q(t,k.b2_wheelJoint).wheelJoint.lowerTranslation}function Kd(t){return q(t,k.b2_wheelJoint).wheelJoint.upperTranslation}function Hd(t,e,o){let n=q(t,k.b2_wheelJoint);(e!==n.wheelJoint.lowerTranslation||o!==n.wheelJoint.upperTranslation)&&(n.wheelJoint.lowerTranslation=Math.min(e,o),n.wheelJoint.upperTranslation=Math.max(e,o),n.wheelJoint.lowerImpulse=0,n.wheelJoint.upperImpulse=0)}function $d(t,e){let o=q(t,k.b2_wheelJoint);o.wheelJoint.enableMotor!==e&&(o.wheelJoint.motorImpulse=0,o.wheelJoint.enableMotor=e)}function Qd(t){return q(t,k.b2_wheelJoint).wheelJoint.enableMotor}function Zd(t,e){let o=q(t,k.b2_wheelJoint);o.wheelJoint.motorSpeed=e}function tb(t){return q(t,k.b2_wheelJoint).wheelJoint.motorSpeed}function eb(t){let e=O(t.world0),o=q(t,k.b2_wheelJoint);return e.inv_h*o.wheelJoint.motorImpulse}function ob(t,e){let o=q(t,k.b2_wheelJoint);o.wheelJoint.maxMotorTorque=e}function nb(t){return q(t,k.b2_wheelJoint).wheelJoint.maxMotorTorque}function sb(t,e){let o=e.wheelJoint,n=o.axisA,s=le(n),r=t.inv_h*o.perpImpulse,i=t.inv_h*(o.springImpulse+o.lowerImpulse-o.upperImpulse);return U(it(r,s),it(i,n))}function rb(t,e){return t.inv_h*e.wheelJoint.motorImpulse}function ib(t,e){let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n],a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex,b=a.sims.data[i.localIndex],u=l.sims.data[c.localIndex],h=b.invMass,m=b.invInertia,f=u.invMass,y=u.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let I=t.wheelJoint;I.indexA=i.setIndex==M.b2_awakeSet?d:x,I.indexB=c.setIndex==M.b2_awakeSet?p:x;let C=b.transform.q,_=u.transform.q;I.anchorA=K(C,J(t.localOriginAnchorA,b.localCenter)),I.anchorB=K(_,J(t.localOriginAnchorB,u.localCenter)),I.axisA=K(C,I.localAxisA),I.deltaCenter=J(u.center,b.center);let S=I.anchorA,A=I.anchorB,B=U(I.deltaCenter,J(A,S)),w=I.axisA,D=le(w),v=z(U(B,S),D),P=z(A,D),T=h+f+m*v*v+y*P*P;I.perpMass=T>0?1/T:0;let R=z(U(B,S),w),X=z(A,w),F=h+f+m*R*R+y*X*X;I.axialMass=F>0?1/F:0,I.springSoftness=ie(I.hertz,I.dampingRatio,e.h);let E=m+y;I.motorMass=E>0?1/E:0,e.enableWarmStarting==!1&&(I.perpImpulse=0,I.springImpulse=0,I.motorImpulse=0,I.lowerImpulse=0,I.upperImpulse=0)}function ab(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new Pt,c=t.wheelJoint,a=c.indexA==x?i:e.states[c.indexA],l=c.indexB==x?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB),b=U(U(J(l.deltaPosition,a.deltaPosition),c.deltaCenter),J(p,d)),u=K(a.deltaRotation,c.axisA),h=le(u),m=z(U(b,d),u),f=z(p,u),y=z(U(b,d),h),I=z(p,h),C=c.springImpulse+c.lowerImpulse-c.upperImpulse,_=U(it(C,u),it(c.perpImpulse,h)),S=C*m+c.perpImpulse*y+c.motorImpulse,A=C*f+c.perpImpulse*I+c.motorImpulse;a.linearVelocity=yt(a.linearVelocity,o,_),a.angularVelocity-=s*S,l.linearVelocity=$(l.linearVelocity,n,_),l.angularVelocity+=r*A}function cb(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new Pt,a=t.wheelJoint,l=a.indexA===x?c:e.states[a.indexA],d=a.indexB===x?c:e.states[a.indexB],p=l.linearVelocity,b=l.angularVelocity,u=d.linearVelocity,h=d.angularVelocity,m=r+i===0,f=K(l.deltaRotation,a.anchorA),y=K(d.deltaRotation,a.anchorB),I=U(U(J(d.deltaPosition,l.deltaPosition),a.deltaCenter),J(y,f)),C=K(l.deltaRotation,a.axisA),_=j(C,I),S=z(U(I,f),C),A=z(y,C);if(a.enableMotor&&m===!1){let B=h-b-a.motorSpeed,w=-a.motorMass*B,D=a.motorImpulse,v=e.h*a.maxMotorTorque;a.motorImpulse=ht(a.motorImpulse+w,-v,v),w=a.motorImpulse-D,b-=r*w,h+=i*w}if(a.enableSpring){let B=_,w=a.springSoftness.biasRate*B,D=a.springSoftness.massScale,v=a.springSoftness.impulseScale,P=j(C,J(u,p))+A*h-S*b,T=-D*a.axialMass*(P+w)-v*a.springImpulse;a.springImpulse+=T;let R=it(T,C),X=T*S,F=T*A;p=yt(p,n,R),b-=r*X,u=$(u,s,R),h+=i*F}if(a.enableLimit){let B=j(C,I);{let w=B-a.lowerTranslation,D=0,v=1,P=0;w>0?D=w*e.inv_h:o&&(D=e.jointSoftness.biasRate*w,v=e.jointSoftness.massScale,P=e.jointSoftness.impulseScale);let T=j(C,J(u,p))+A*h-S*b,R=-v*a.axialMass*(T+D)-P*a.lowerImpulse,X=a.lowerImpulse;a.lowerImpulse=Math.max(X+R,0),R=a.lowerImpulse-X;let F=it(R,C),E=R*S,W=R*A;p=yt(p,n,F),b-=r*E,u=$(u,s,F),h+=i*W}{let w=a.upperTranslation-B,D=0,v=1,P=0;w>0?D=w*e.inv_h:o&&(D=e.jointSoftness.biasRate*w,v=e.jointSoftness.massScale,P=e.jointSoftness.impulseScale);let T=j(C,J(p,u))+S*b-A*h,R=-v*a.axialMass*(T+D)-P*a.upperImpulse,X=a.upperImpulse;a.upperImpulse=Math.max(X+R,0),R=a.upperImpulse-X;let F=it(R,C),E=R*S,W=R*A;p=$(p,n,F),b+=r*E,u=yt(u,s,F),h-=i*W}}{let B=le(C),w=0,D=1,v=0;if(o){let et=j(B,I);w=e.jointSoftness.biasRate*et,D=e.jointSoftness.massScale,v=e.jointSoftness.impulseScale}let P=z(U(I,f),B),T=z(y,B),R=j(B,J(u,p))+T*h-P*b,X=-D*a.perpMass*(R+w)-v*a.perpImpulse;a.perpImpulse+=X;let F=it(X,B),E=X*P,W=X*T;p=yt(p,n,F),b-=r*E,u=$(u,s,F),h+=i*W}l.linearVelocity=p,l.angularVelocity=b,d.linearVelocity=u,d.angularVelocity=h}function lb(t,e,o,n){let s=e.wheelJoint,r=H(o,e.localOriginAnchorA),i=H(n,e.localOriginAnchorB),c=K(o.q,s.localAxisA),a=V.b2_colorGray7,l=V.b2_colorGreen,d=V.b2_colorRed,p=V.b2_colorGray4,b=V.b2_colorBlue;if(t.DrawSegment(r,i,b,t.context),s.enableLimit){let u=$(r,s.lowerTranslation,c),h=$(r,s.upperTranslation,c),m=le(c);t.DrawSegment(u,h,a,t.context),t.DrawSegment(yt(u,.1,m),$(u,.1,m),l,t.context),t.DrawSegment(yt(h,.1,m),$(h,.1,m),d,t.context)}else t.DrawSegment(yt(r,1,c),$(r,1,c),a,t.context);t.DrawPoint(r.x,r.y,5,a,t.context),t.DrawPoint(i.x,i.y,5,p,t.context)}function db(t,e){let o=q(t,k.b2_motorJoint);o.motorJoint.linearOffset=e}function bb(t){return q(t,k.b2_motorJoint).motorJoint.linearOffset}function pb(t,e){let o=q(t,k.b2_motorJoint);o.motorJoint.angularOffset=ht(e,-Co,Co)}function ub(t){return q(t,k.b2_motorJoint).motorJoint.angularOffset}function hb(t,e){let o=q(t,k.b2_motorJoint);o.motorJoint.maxForce=Math.max(0,e)}function mb(t){return q(t,k.b2_motorJoint).motorJoint.maxForce}function yb(t,e){let o=q(t,k.b2_motorJoint);o.motorJoint.maxTorque=Math.max(0,e)}function fb(t){return q(t,k.b2_motorJoint).motorJoint.maxTorque}function xb(t,e){let o=q(t,k.b2_motorJoint);o.motorJoint.correctionFactor=ht(e,0,1)}function Ib(t){return q(t,k.b2_motorJoint).motorJoint.correctionFactor}function Sb(t,e){return it(t.inv_h,e.motorJoint.linearImpulse)}function _b(t,e){return t.inv_h*e.motorJoint.angularImpulse}function gb(t,e){let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n],a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex,b=a.sims.data[i.localIndex],u=l.sims.data[c.localIndex],h=b.invMass,m=b.invInertia,f=u.invMass,y=u.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let I=t.motorJoint;I.indexA=i.setIndex==M.b2_awakeSet?d:x,I.indexB=c.setIndex==M.b2_awakeSet?p:x,I.anchorA=K(b.transform.q,J(t.localOriginAnchorA,b.localCenter)),I.anchorB=K(u.transform.q,J(t.localOriginAnchorB,u.localCenter)),I.deltaCenter=J(J(u.center,b.center),I.linearOffset),I.deltaAngle=oe(u.transform.q,b.transform.q)-I.angularOffset,I.deltaAngle=wo(I.deltaAngle);let C=I.anchorA,_=I.anchorB,S={cx:new g(0,0),cy:new g(0,0)};S.cx.x=h+f+C.y*C.y*m+_.y*_.y*y,S.cx.y=-C.y*C.x*m-_.y*_.x*y,S.cy.x=S.cx.y,S.cy.y=h+f+C.x*C.x*m+_.x*_.x*y,I.linearMass=ss(S);let A=m+y;I.angularMass=A>0?1/A:0,e.enableWarmStarting==!1&&(I.linearImpulse=new g(0,0),I.angularImpulse=0)}function Bb(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=t.motorJoint,c=new Pt,a=i.indexA==x?c:e.states[i.indexA],l=i.indexB==x?c:e.states[i.indexB],d=K(a.deltaRotation,i.anchorA),p=K(l.deltaRotation,i.anchorB);a.linearVelocity=yt(a.linearVelocity,o,i.linearImpulse),a.angularVelocity-=s*(z(d,i.linearImpulse)+i.angularImpulse),l.linearVelocity=$(l.linearVelocity,n,i.linearImpulse),l.angularVelocity+=r*(z(p,i.linearImpulse)+i.angularImpulse)}function Ab(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new Pt,a=t.motorJoint,l=a.indexA==x?c:e.states[a.indexA],d=a.indexB==x?c:e.states[a.indexB],p=l.linearVelocity,b=l.angularVelocity,u=d.linearVelocity,h=d.angularVelocity;{let m=oe(d.deltaRotation,l.deltaRotation)+a.deltaAngle;m=wo(m);let f=e.inv_h*a.correctionFactor*m,y=h-b,I=-a.angularMass*(y+f),C=a.angularImpulse,_=e.h*a.maxTorque;a.angularImpulse=ht(a.angularImpulse+I,-_,_),I=a.angularImpulse-C,b-=r*I,h+=i*I}{let m=K(l.deltaRotation,a.anchorA),f=K(d.deltaRotation,a.anchorB),y=U(J(d.deltaPosition,l.deltaPosition),J(f,m)),I=U(a.deltaCenter,y),C=it(e.inv_h*a.correctionFactor,I),_=J(U(u,Gt(h,f)),U(p,Gt(b,m))),S=ns(a.linearMass,U(_,C)),A=new g(-S.x,-S.y),B=a.linearImpulse,w=e.h*a.maxForce;a.linearImpulse=U(a.linearImpulse,A),be(a.linearImpulse)>w*w&&(a.linearImpulse=dt(a.linearImpulse),a.linearImpulse.x*=w,a.linearImpulse.y*=w),A=J(a.linearImpulse,B),p=yt(p,n,A),b-=r*z(m,A),u=$(u,s,A),h+=i*z(f,A)}l.linearVelocity=p,l.angularVelocity=b,d.linearVelocity=u,d.angularVelocity=h}function Cb(t,e){Hr(t);let o=q(t,k.b2_mouseJoint);o.mouseJoint.targetA=e.clone()}function wb(t){return q(t,k.b2_mouseJoint).mouseJoint.targetA}function vb(t,e){let o=q(t,k.b2_mouseJoint);o.mouseJoint.hertz=e}function Jb(t){return q(t,k.b2_mouseJoint).mouseJoint.hertz}function Mb(t,e){let o=q(t,k.b2_mouseJoint);o.mouseJoint.dampingRatio=e}function Db(t){return q(t,k.b2_mouseJoint).mouseJoint.dampingRatio}function Pb(t,e){let o=q(t,k.b2_mouseJoint);o.mouseJoint.maxForce=e}function kb(t){return q(t,k.b2_mouseJoint).mouseJoint.maxForce}function Tb(t,e){return it(t.inv_h,e.mouseJoint.linearImpulse)}function Gb(t,e){return t.inv_h*e.mouseJoint.angularImpulse}function Rb(t,e){let o=t.bodyIdB,n=e.world,r=n.bodyArray[o];r.setIndex,M.b2_awakeSet;let i=n.solverSetArray[r.setIndex],c=r.localIndex,a=i.sims.data[c];t.invMassB=a.invMass,t.invIB=a.invInertia;let l=t.mouseJoint;l.indexB=r.setIndex===M.b2_awakeSet?c:x,l.anchorB=K(a.transform.q,J(t.localOriginAnchorB,a.localCenter)),l.linearSoftness=ie(l.hertz,l.dampingRatio,e.h);let d=.5,p=.1;l.angularSoftness=ie(d,p,e.h);let b=l.anchorB,u=a.invMass,h=a.invInertia,m={cx:new g(u+h*b.y*b.y,-h*b.x*b.y),cy:new g(-h*b.x*b.y,u+h*b.x*b.x)};l.linearMass=ss(m),l.deltaCenter=J(a.center,l.targetA),e.enableWarmStarting===!1&&(l.linearImpulse=new g(0,0),l.angularImpulse=0)}function Lb(t,e){t.type,k.b2_mouseJoint;let o=t.invMassB,n=t.invIB,s=t.mouseJoint,r=e.states[s.indexB],i=r.linearVelocity.clone(),c=r.angularVelocity,a=r.deltaRotation,l=K(a,s.anchorB);i=$(i,o,s.linearImpulse),c+=n*(z(l,s.linearImpulse)+s.angularImpulse),r.linearVelocity=i,r.angularVelocity=c}function Eb(t,e){let o=t.invMassB,n=t.invIB,s=t.mouseJoint,r=e.states[s.indexB],i=r.linearVelocity.clone(),c=r.angularVelocity;{let l=s.angularSoftness.massScale,d=s.angularSoftness.impulseScale,p=n>0?-c/n:0;p=l*p-d*s.angularImpulse,s.angularImpulse+=p,c+=n*p}let a=s.maxForce*e.h;{let l=r.deltaRotation,d=K(l,s.anchorB),p=U(i,Gt(c,d)),b=U(U(r.deltaPosition,d),s.deltaCenter),u=it(s.linearSoftness.biasRate,b),h=s.linearSoftness.massScale,m=s.linearSoftness.impulseScale,f=ns(s.linearMass,U(p,u)),y=new g(-h*f.x-m*s.linearImpulse.x,-h*f.y-m*s.linearImpulse.y),I=s.linearImpulse.clone();s.linearImpulse.x+=y.x,s.linearImpulse.y+=y.y,Yt(s.linearImpulse)>a&&(s.linearImpulse=it(a,dt(s.linearImpulse))),y.x=s.linearImpulse.x-I.x,y.y=s.linearImpulse.y-I.y,i=$(i,o,y),c+=n*z(d,y)}r.linearVelocity=i,r.angularVelocity=c}function jb(t,e){if(!(ae(e)&&e>=0))throw new Error("Invalid hertz value");let o=q(t,k.b2_weldJoint);o.weldJoint.linearHertz=e}function Fb(t){return q(t,k.b2_weldJoint).weldJoint.linearHertz}function Xb(t,e){if(!(ae(e)&&e>=0))throw new Error("Invalid dampingRatio value");let o=q(t,k.b2_weldJoint);o.weldJoint.linearDampingRatio=e}function qb(t){return q(t,k.b2_weldJoint).weldJoint.linearDampingRatio}function Vb(t,e){if(!(ae(e)&&e>=0))throw new Error("Invalid hertz value");let o=q(t,k.b2_weldJoint);o.weldJoint.angularHertz=e}function Yb(t){return q(t,k.b2_weldJoint).weldJoint.angularHertz}function Nb(t,e){if(!(ae(e)&&e>=0))throw new Error("Invalid dampingRatio value");let o=q(t,k.b2_weldJoint);o.weldJoint.angularDampingRatio=e}function Wb(t){return q(t,k.b2_weldJoint).weldJoint.angularDampingRatio}function Ob(t,e){return it(t.inv_h,e.weldJoint.linearImpulse)}function Ub(t,e){return t.inv_h*e.weldJoint.angularImpulse}function zb(t,e){if(t.type!==k.b2_weldJoint)throw new Error("Invalid joint type");let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n];if(!(i.setIndex===M.b2_awakeSet||c.setIndex===M.b2_awakeSet))throw new Error("At least one body must be awake");let a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex;if(!(0<=d&&d<=a.sims.count))throw new Error("Invalid localIndexA");if(!(0<=p&&p<=l.sims.count))throw new Error("Invalid localIndexB");let b=a.sims.data[i.localIndex],u=l.sims.data[c.localIndex],h=b.invMass,m=b.invInertia,f=u.invMass,y=u.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let I=t.weldJoint;I.indexA=i.setIndex===M.b2_awakeSet?d:x,I.indexB=c.setIndex===M.b2_awakeSet?p:x;let C=b.transform.q,_=u.transform.q;I.anchorA=K(C,J(t.localOriginAnchorA,b.localCenter)),I.anchorB=K(_,J(t.localOriginAnchorB,u.localCenter)),I.deltaCenter=J(u.center,b.center),I.deltaAngle=oe(_,C)-I.referenceAngle;let S=m+y;I.axialMass=S>0?1/S:0,I.linearHertz===0?I.linearSoftness=e.jointSoftness:I.linearSoftness=ie(I.linearHertz,I.linearDampingRatio,e.h),I.angularHertz===0?I.angularSoftness=e.jointSoftness:I.angularSoftness=ie(I.angularHertz,I.angularDampingRatio,e.h),e.enableWarmStarting===!1&&(I.linearImpulse=new g(0,0),I.angularImpulse=0)}function Kb(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new Pt,c=t.weldJoint,a=c.indexA===x?i:e.states[c.indexA],l=c.indexB===x?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB);a.linearVelocity=yt(a.linearVelocity,o,c.linearImpulse),a.angularVelocity-=s*(z(d,c.linearImpulse)+c.angularImpulse),l.linearVelocity=$(l.linearVelocity,n,c.linearImpulse),l.angularVelocity+=r*(z(p,c.linearImpulse)+c.angularImpulse)}function Hb(t,e,o){if(t.type!==k.b2_weldJoint)throw new Error("Invalid joint type");let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new Pt,a=t.weldJoint,l=a.indexA===x?c:e.states[a.indexA],d=a.indexB===x?c:e.states[a.indexB],p=l.linearVelocity,b=l.angularVelocity,u=d.linearVelocity,h=d.angularVelocity;{let m=0,f=1,y=0;if(o||a.angularHertz>0){let _=oe(d.deltaRotation,l.deltaRotation)+a.deltaAngle;m=a.angularSoftness.biasRate*_,f=a.angularSoftness.massScale,y=a.angularSoftness.impulseScale}let I=h-b,C=-f*a.axialMass*(I+m)-y*a.angularImpulse;a.angularImpulse+=C,b-=r*C,h+=i*C}{let m=K(l.deltaRotation,a.anchorA),f=K(d.deltaRotation,a.anchorB),y=new g(0,0),I=1,C=0;if(o||a.linearHertz>0){let w=l.deltaPosition,D=d.deltaPosition,v=U(U(J(D,w),J(f,m)),a.deltaCenter);y=it(a.linearSoftness.biasRate,v),I=a.linearSoftness.massScale,C=a.linearSoftness.impulseScale}let _=J(U(u,Gt(h,f)),U(p,Gt(b,m))),S=new ao;S.cx.x=n+s+m.y*m.y*r+f.y*f.y*i,S.cy.x=-m.y*m.x*r-f.y*f.x*i,S.cx.y=S.cy.x,S.cy.y=n+s+m.x*m.x*r+f.x*f.x*i;let A=zo(S,U(_,y)),B=new g(-I*A.x-C*a.linearImpulse.x,-I*A.y-C*a.linearImpulse.y);a.linearImpulse=U(a.linearImpulse,B),p=yt(p,n,B),b-=r*z(m,B),u=$(u,s,B),h+=i*z(f,B)}l.linearVelocity=p,l.angularVelocity=b,d.linearVelocity=u,d.angularVelocity=h}function Qb(){let t=new Ho;return t.length=1,t.maxLength=De,t}function Zb(){let t=new $o;return t.maxForce=1,t.maxTorque=1,t.correctionFactor=.3,t}function tp(){let t=new Qo;return t.hertz=4,t.dampingRatio=1,t.maxForce=1,t}function ep(){let t=new Zo;return t.localAxisA=new g(1,0),t}function ia(){let t=new ho;return t.drawSize=.25,t}function op(){return new tn}function np(){let t=new en;return t.localAxisA=new g(0,1),t.enableSpring=!0,t.hertz=1,t.dampingRatio=.7,t}function Je(t,e){let o=e.index1-1;return t.jointArray[o]}function Me(t,e){return t.jointArray[e]}function No(t,e){if(e.setIndex===M.b2_awakeSet){let n=t.constraintGraph.colors[e.colorIndex];return e.jointId,n.joints.data[e.localIndex].jointId,n.joints.data[e.localIndex]}return t.solverSetArray[e.setIndex].joints.data[e.localIndex]}function q(t,e){let o=O(t.world0);if(o.locked)return null;let n=Je(o,t);return No(o,n)}var $b=class{constructor(e=null,o=null){this.joint=e,this.jointSim=o}};function zn(t,e,o,n,s,r,i){Lt(t);let c=e.id,a=o.id,l=Math.max(e.setIndex,o.setIndex),d=ne(t.jointIdPool);for(;d>=t.jointArray.length;)t.jointArray.push(new la);let p=t.jointArray[d];p.edges=[new Un,new Un],p.jointId=d,p.userData=n,p.setIndex=x,p.colorIndex=x,p.localIndex=x,p.islandId=x,p.islandPrev=x,p.islandNext=x,p.revision+=1,p.drawSize=s,p.type=r,p.isMarked=!1,p.collideConnected=i,p.edges[0].bodyId=c,p.edges[0].prevKey=x,p.edges[0].nextKey=e.headJointKey;let b=d<<1|0;if(e.headJointKey!==x){let f=t.jointArray[e.headJointKey>>1].edges[e.headJointKey&1];f.prevKey=b}e.headJointKey=b,e.jointCount+=1,p.edges[1].bodyId=a,p.edges[1].prevKey=x,p.edges[1].nextKey=o.headJointKey;let u=d<<1|1;if(o.headJointKey!==x){let f=t.jointArray[o.headJointKey>>1].edges[o.headJointKey&1];f.prevKey=u}o.headJointKey=u,o.jointCount+=1;let h;if(e.setIndex===M.b2_disabledSet||o.setIndex===M.b2_disabledSet){let m=t.solverSetArray[M.b2_disabledSet];p.setIndex=M.b2_disabledSet,p.localIndex=m.joints.length,h=oo(m.joints),h.jointId=d,h.bodyIdA=c,h.bodyIdB=a}else if(e.setIndex===M.b2_staticSet&&o.setIndex===M.b2_staticSet){let m=t.solverSetArray[M.b2_staticSet];p.setIndex=M.b2_staticSet,p.localIndex=m.joints.length,h=oo(m.joints),h.jointId=d,h.bodyIdA=c,h.bodyIdB=a}else if(e.setIndex===M.b2_awakeSet||o.setIndex===M.b2_awakeSet)l>=M.b2_firstSleepingSet&&qe(t,l),p.setIndex=M.b2_awakeSet,h=$i(t,p),h.jointId=d,h.bodyIdA=c,h.bodyIdB=a;else{let m=l,f=t.solverSetArray[m];p.setIndex=m,p.localIndex=f.joints.length,h=oo(f.joints),h.jointId=d,h.bodyIdA=c,h.bodyIdB=a,e.setIndex!==o.setIndex&&e.setIndex>=M.b2_firstSleepingSet&&o.setIndex>=M.b2_firstSleepingSet&&(il(t,e.setIndex,o.setIndex),m=e.setIndex,h=t.solverSetArray[m].joints[p.localIndex])}return p.setIndex>M.b2_disabledSet&&Ys(t,p),Lt(t),new $b(p,h)}function Kn(t,e,o){let n,s;e.contactCount<o.contactCount?(n=e.headContactKey,s=o.id):(n=o.headContactKey,s=e.id);let r=!1;for(;n!==x;){let i=n>>1,c=n&1,a=t.contactArray[i];n=a.edges[c].nextKey;let l=c^1;a.edges[l].bodyId===s&&fo(t,a,r)}Lt(t)}function $r(t,e){let o=gt(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=zn(o,n,s,e.userData,1,k.b2_distanceJoint,e.collideConnected),i=r.jointSim;return i.type=k.b2_distanceJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.distanceJoint=new da,i.distanceJoint.length=Math.max(e.length,It),i.distanceJoint.hertz=e.hertz,i.distanceJoint.dampingRatio=e.dampingRatio,i.distanceJoint.minLength=Math.max(e.minLength,It),i.distanceJoint.maxLength=Math.max(e.minLength,e.maxLength),i.distanceJoint.maxMotorForce=e.maxMotorForce,i.distanceJoint.motorSpeed=e.motorSpeed,i.distanceJoint.enableSpring=e.enableSpring,i.distanceJoint.enableLimit=e.enableLimit,i.distanceJoint.enableMotor=e.enableMotor,i.distanceJoint.impulse=0,i.distanceJoint.lowerImpulse=0,i.distanceJoint.upperImpulse=0,i.distanceJoint.motorImpulse=0,e.collideConnected===!1&&Kn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function Qr(t,e){let o=gt(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=zn(o,n,s,e.userData,1,k.b2_motorJoint,e.collideConnected),i=r.jointSim;return i.type=k.b2_motorJoint,i.localOriginAnchorA=new g(0,0),i.localOriginAnchorB=new g(0,0),i.motorJoint=new ba,i.motorJoint.linearOffset=e.linearOffset,i.motorJoint.angularOffset=e.angularOffset,i.motorJoint.maxForce=e.maxForce,i.motorJoint.maxTorque=e.maxTorque,i.motorJoint.correctionFactor=ht(e.correctionFactor,0,1),e.collideConnected===!1&&Kn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function Zr(t,e){let o=gt(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=Rt(o,n),i=Rt(o,s),c=zn(o,n,s,e.userData,1,k.b2_mouseJoint,e.collideConnected),a=c.jointSim;return a.type=k.b2_mouseJoint,a.localOriginAnchorA=Re(r,e.target),a.localOriginAnchorB=Re(i,e.target),a.mouseJoint=new pa,a.mouseJoint.targetA=e.target,a.mouseJoint.hertz=e.hertz,a.mouseJoint.dampingRatio=e.dampingRatio,a.mouseJoint.maxForce=e.maxForce,new zt(a.jointId+1,o.worldId,c.joint.revision)}function Sn(t,e){let o=gt(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=zn(o,n,s,e.userData,e.drawSize,k.b2_revoluteJoint,e.collideConnected),i=r.jointSim;return i.type=k.b2_revoluteJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.revoluteJoint=new ha,i.revoluteJoint.referenceAngle=ht(e.referenceAngle,-Math.PI,Math.PI),i.revoluteJoint.linearImpulse=new g(0,0),i.revoluteJoint.axialMass=0,i.revoluteJoint.springImpulse=0,i.revoluteJoint.motorImpulse=0,i.revoluteJoint.lowerImpulse=0,i.revoluteJoint.upperImpulse=0,i.revoluteJoint.hertz=e.hertz,i.revoluteJoint.dampingRatio=e.dampingRatio,i.revoluteJoint.lowerAngle=Math.min(e.lowerAngle,e.upperAngle),i.revoluteJoint.upperAngle=Math.max(e.lowerAngle,e.upperAngle),i.revoluteJoint.lowerAngle=ht(i.revoluteJoint.lowerAngle,-Math.PI,Math.PI),i.revoluteJoint.upperAngle=ht(i.revoluteJoint.upperAngle,-Math.PI,Math.PI),i.revoluteJoint.maxMotorTorque=e.maxMotorTorque,i.revoluteJoint.motorSpeed=e.motorSpeed,i.revoluteJoint.enableSpring=e.enableSpring,i.revoluteJoint.enableLimit=e.enableLimit,i.revoluteJoint.enableMotor=e.enableMotor,e.collideConnected===!1&&Kn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function ti(t,e){let o=gt(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=zn(o,n,s,e.userData,1,k.b2_prismaticJoint,e.collideConnected),i=r.jointSim;return i.type=k.b2_prismaticJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.prismaticJoint=new ua,i.prismaticJoint.localAxisA=dt(e.localAxisA),i.prismaticJoint.referenceAngle=e.referenceAngle,i.prismaticJoint.impulse=new g(0,0),i.prismaticJoint.axialMass=0,i.prismaticJoint.springImpulse=0,i.prismaticJoint.motorImpulse=0,i.prismaticJoint.lowerImpulse=0,i.prismaticJoint.upperImpulse=0,i.prismaticJoint.hertz=e.hertz,i.prismaticJoint.dampingRatio=e.dampingRatio,i.prismaticJoint.lowerTranslation=e.lowerTranslation,i.prismaticJoint.upperTranslation=e.upperTranslation,i.prismaticJoint.maxMotorForce=e.maxMotorForce,i.prismaticJoint.motorSpeed=e.motorSpeed,i.prismaticJoint.enableSpring=e.enableSpring,i.prismaticJoint.enableLimit=e.enableLimit,i.prismaticJoint.enableMotor=e.enableMotor,e.collideConnected===!1&&Kn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function ei(t,e){let o=gt(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=zn(o,n,s,e.userData,1,k.b2_weldJoint,e.collideConnected),i=r.jointSim;return i.type=k.b2_weldJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.weldJoint=new ma,i.weldJoint.referenceAngle=e.referenceAngle,i.weldJoint.linearHertz=e.linearHertz,i.weldJoint.linearDampingRatio=e.linearDampingRatio,i.weldJoint.angularHertz=e.angularHertz,i.weldJoint.angularDampingRatio=e.angularDampingRatio,i.weldJoint.linearImpulse=new g(0,0),i.weldJoint.angularImpulse=0,e.collideConnected===!1&&Kn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function oi(t,e){let o=gt(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=zn(o,n,s,e.userData,1,k.b2_wheelJoint,e.collideConnected),i=r.jointSim;return i.type=k.b2_wheelJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.wheelJoint=new ya,i.wheelJoint.localAxisA=dt(e.localAxisA),i.wheelJoint.perpMass=0,i.wheelJoint.axialMass=0,i.wheelJoint.motorImpulse=0,i.wheelJoint.lowerImpulse=0,i.wheelJoint.upperImpulse=0,i.wheelJoint.lowerTranslation=e.lowerTranslation,i.wheelJoint.upperTranslation=e.upperTranslation,i.wheelJoint.maxMotorTorque=e.maxMotorTorque,i.wheelJoint.motorSpeed=e.motorSpeed,i.wheelJoint.hertz=e.hertz,i.wheelJoint.dampingRatio=e.dampingRatio,i.wheelJoint.enableSpring=e.enableSpring,i.wheelJoint.enableLimit=e.enableLimit,i.wheelJoint.enableMotor=e.enableMotor,e.collideConnected===!1&&Kn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function aa(t,e,o){let n=e.jointId,s=e.edges[0],r=e.edges[1],i=s.bodyId,c=r.bodyId,a=_t(t,i),l=_t(t,c);if(s.prevKey!==x){let m=t.jointArray[s.prevKey>>1].edges[s.prevKey&1];m.nextKey=s.nextKey}if(s.nextKey!==x){let m=t.jointArray[s.nextKey>>1].edges[s.nextKey&1];m.prevKey=s.prevKey}let d=n<<1|0;if(a.headJointKey===d&&(a.headJointKey=s.nextKey),a.jointCount-=1,r.prevKey!==x){let m=t.jointArray[r.prevKey>>1].edges[r.prevKey&1];m.nextKey=r.nextKey}if(r.nextKey!==x){let m=t.jointArray[r.nextKey>>1].edges[r.nextKey&1];m.prevKey=r.prevKey}let p=n<<1|1;l.headJointKey===p&&(l.headJointKey=r.nextKey),l.jointCount-=1,Ns(t,e);let b=e.setIndex,u=e.localIndex;if(b===M.b2_awakeSet)Tr(t,e.edges[0].bodyId,e.edges[1].bodyId,e.colorIndex,u);else{let h=t.solverSetArray[b];if(bn(h.joints,u)!==x){let y=h.joints.data[u].jointId,I=t.jointArray[y];I.localIndex=u}}e.setIndex=x,e.colorIndex=x,e.localIndex=x,e.jointId=x,e.type=k.b2_unknown,xe(t.jointIdPool,n),o&&(Ot(t,a),Ot(t,l)),Lt(t)}function ni(t){let e=O(t.world0);if(e.locked)return;let o=Je(e,t);aa(e,o,!0)}function sp(t){let e=O(t.world0);return Je(e,t).type}function rp(t){let e=O(t.world0),o=Je(e,t);return Ps(e,o.edges[0].bodyId)}function ip(t){let e=O(t.world0),o=Je(e,t);return Ps(e,o.edges[1].bodyId)}function ap(t){let e=O(t.world0),o=Je(e,t);return No(e,o).localOriginAnchorA}function cp(t){let e=O(t.world0),o=Je(e,t);return No(e,o).localOriginAnchorB}function lp(t,e){let o=ft(t.world0);if(o===null)return;let n=Je(o,t);if(n.collideConnected===e)return;n.collideConnected=e;let s=_t(o,n.edges[0].bodyId),r=_t(o,n.edges[1].bodyId);if(e){let i=s.shapeCount,c=r.shapeCount,a=i<c?s.headShapeId:r.headShapeId;for(;a!==x;){let l=o.shapeArray[a];l.proxyKey!==x&&In(o.broadPhase,l.proxyKey),a=l.nextShapeId}}else Kn(o,s,r)}function dp(t){let e=O(t.world0);return Je(e,t).collideConnected}function bp(t,e){let o=O(t.world0),n=Je(o,t);n.userData=e}function pp(t){let e=O(t.world0);return Je(e,t).userData}function Hr(t){let e=ft(t.world0);if(e===null)return;let o=Je(e,t),n=e.bodyArray[o.edges[0].bodyId],s=e.bodyArray[o.edges[1].bodyId];Ot(e,n),Ot(e,s)}function up(t){let e=O(t.world0),o=Je(e,t),n=No(e,o);switch(o.type){case k.b2_distanceJoint:return Xl(e,n);case k.b2_motorJoint:return Sb(e,n);case k.b2_mouseJoint:return Tb(e,n);case k.b2_prismaticJoint:return ld(e,n);case k.b2_revoluteJoint:return Gd(e,n);case k.b2_weldJoint:return Ob(e,n);case k.b2_wheelJoint:return sb(e,n);default:return new g(0,0)}}function hp(t){let e=O(t.world0),o=Je(e,t),n=No(e,o);switch(o.type){case k.b2_distanceJoint:return 0;case k.b2_motorJoint:return _b(e,n);case k.b2_mouseJoint:return Gb(e,n);case k.b2_prismaticJoint:return dd(e,n);case k.b2_revoluteJoint:return Rd(e,n);case k.b2_weldJoint:return Ub(e,n);case k.b2_wheelJoint:return rb(e,n);default:return 0}}function Mh(t,e){switch(t.type){case k.b2_distanceJoint:ql(t,e);break;case k.b2_motorJoint:gb(t,e);break;case k.b2_mouseJoint:Rb(t,e);break;case k.b2_prismaticJoint:bd(t,e);break;case k.b2_revoluteJoint:Ld(t,e);break;case k.b2_weldJoint:zb(t,e);break;case k.b2_wheelJoint:ib(t,e);break;default:}}function Dh(t,e){switch(t.type){case k.b2_distanceJoint:Vl(t,e);break;case k.b2_motorJoint:Bb(t,e);break;case k.b2_mouseJoint:Lb(t,e);break;case k.b2_prismaticJoint:pd(t,e);break;case k.b2_revoluteJoint:Ed(t,e);break;case k.b2_weldJoint:Kb(t,e);break;case k.b2_wheelJoint:ab(t,e);break;default:}}function Ph(t,e,o){switch(t.type){case k.b2_distanceJoint:Yl(t,e,o);break;case k.b2_motorJoint:Ab(t,e,o);break;case k.b2_mouseJoint:Eb(t,e);break;case k.b2_prismaticJoint:ud(t,e,o);break;case k.b2_revoluteJoint:jd(t,e,o);break;case k.b2_weldJoint:Hb(t,e,o);break;case k.b2_wheelJoint:cb(t,e,o);break;default:}}function ml(t){let e=t.graph,o=e.colors[Mt].joints.data,n=e.colors[Mt].joints.count;for(let s=0;s<n;++s){let r=o[s];Mh(r,t)}}function yl(t){let e=t.graph,o=e.colors[Mt].joints.data,n=e.colors[Mt].joints.count;for(let s=0;s<n;++s){let r=o[s];Dh(r,t)}}function sa(t,e){let o=t.graph,n=o.colors[Mt].joints.data,s=o.colors[Mt].joints.count;for(let r=0;r<s;++r){let i=n[r];Ph(i,t,e)}}function ca(t,e,o){let n=_t(e,o.edges[0].bodyId),s=_t(e,o.edges[1].bodyId);if(n.setIndex===M.b2_disabledSet||s.setIndex===M.b2_disabledSet)return;let r=No(e,o),i=Rt(e,n),c=Rt(e,s),a=H(i,r.localOriginAnchorA),l=H(c,r.localOriginAnchorB),d=V.b2_colorDarkSeaGreen;switch(o.type){case k.b2_distanceJoint:Nl(t,r,i,c);break;case k.b2_mouseJoint:{let p=r.mouseJoint.targetA,b=V.b2_colorGreen;t.DrawPoint(p.x,p.y,4,b,t.context),t.DrawPoint(l.x,l.y,4,b,t.context);let u=V.b2_colorGray8;t.DrawSegment(p,l,u,t.context)}break;case k.b2_prismaticJoint:hd(t,r,i,c);break;case k.b2_revoluteJoint:Fd(t,r,i,c,o.drawSize);break;case k.b2_wheelJoint:lb(t,r,i,c);break;default:t.DrawSegment(i.p,a,d,t.context),t.DrawSegment(a,l,d,t.context),t.DrawSegment(c.p,l,d,t.context)}if(t.drawGraphColors){let p=[V.b2_colorRed,V.b2_colorOrange,V.b2_colorYellow,V.b2_colorGreen,V.b2_colorCyan,V.b2_colorBlue,V.b2_colorViolet,V.b2_colorPink,V.b2_colorChocolate,V.b2_colorGoldenrod,V.b2_colorCoral,V.b2_colorBlack],b=o.colorIndex;if(b!==x){let u=$t(a,l,.5);t.DrawPoint(u.x,u.y,5,p[b],t.context)}}}var Un=class{constructor(){this.bodyId=x,this.prevKey=x,this.nextKey=x}},la=class{constructor(){this.userData=null,this.setIndex=x,this.colorIndex=x,this.localIndex=x,this.edges=[new Un,new Un],this.jointId=x,this.islandId=x,this.islandPrev=x,this.islandNext=x,this.revision=0,this.drawSize=0,this.type=k.b2_unknown,this.isMarked=!1,this.collideConnected=!1}},da=class t{constructor(){this.length=0,this.hertz=0,this.dampingRatio=0,this.minLength=0,this.maxLength=0,this.maxMotorForce=0,this.motorSpeed=0,this.impulse=0,this.lowerImpulse=0,this.upperImpulse=0,this.motorImpulse=0,this.indexA=x,this.indexB=x,this.anchorA=new g,this.anchorB=new g,this.deltaCenter=new g,this.distanceSoftness=new re,this.axialMass=0,this.enableSpring=!1,this.enableLimit=!1,this.enableMotor=!1}clone(){let e=new t;return e.length=this.length,e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.minLength=this.minLength,e.maxLength=this.maxLength,e.maxMotorForce=this.maxMotorForce,e.motorSpeed=this.motorSpeed,e.impulse=this.impulse,e.lowerImpulse=this.lowerImpulse,e.upperImpulse=this.upperImpulse,e.motorImpulse=this.motorImpulse,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.distanceSoftness=this.distanceSoftness,e.axialMass=this.axialMass,e.enableSpring=this.enableSpring,e.enableLimit=this.enableLimit,e.enableMotor=this.enableMotor,e}},ba=class t{constructor(){this.linearOffset=new g,this.angularOffset=0,this.linearImpulse=new g,this.angularImpulse=0,this.maxForce=0,this.maxTorque=0,this.correctionFactor=0,this.indexA=x,this.indexB=x,this.anchorA=new g,this.anchorB=new g,this.deltaCenter=new g,this.deltaAngle=0,this.linearMass=new ao,this.angularMass=0}clone(){let e=new t;return e.linearOffset=this.linearOffset.clone(),e.angularOffset=this.angularOffset,e.linearImpulse=this.linearImpulse.clone(),e.angularImpulse=this.angularImpulse,e.maxForce=this.maxForce,e.maxTorque=this.maxTorque,e.correctionFactor=this.correctionFactor,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.deltaAngle=this.deltaAngle,e.linearMass=this.linearMass.clone(),e.angularMass=this.angularMass,e}},pa=class t{constructor(){this.targetA=new g,this.hertz=0,this.dampingRatio=0,this.maxForce=0,this.linearImpulse=new g,this.angularImpulse=0,this.linearSoftness=new re,this.angularSoftness=new re,this.indexB=x,this.anchorB=new g,this.deltaCenter=new g,this.linearMass=new ao}clone(){let e=new t;return e.targetA=this.targetA.clone(),e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.maxForce=this.maxForce,e.linearImpulse=this.linearImpulse.clone(),e.angularImpulse=this.angularImpulse,e.linearSoftness=this.linearSoftness,e.angularSoftness=this.angularSoftness,e.indexB=this.indexB,e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.linearMass=this.linearMass.clone(),e}},ua=class t{constructor(){this.localAxisA=new g,this.impulse=new g,this.springImpulse=0,this.motorImpulse=0,this.lowerImpulse=0,this.upperImpulse=0,this.hertz=0,this.dampingRatio=0,this.maxMotorForce=0,this.motorSpeed=0,this.referenceAngle=0,this.lowerTranslation=0,this.upperTranslation=0,this.indexA=x,this.indexB=x,this.anchorA=new g,this.anchorB=new g,this.axisA=new g,this.deltaCenter=new g,this.deltaAngle=0,this.axialMass=0,this.springSoftness=new re,this.enableSpring=!1,this.enableLimit=!1,this.enableMotor=!1}clone(){let e=new t;return e.localAxisA=this.localAxisA.clone(),e.impulse=this.impulse.clone(),e.springImpulse=this.springImpulse,e.motorImpulse=this.motorImpulse,e.lowerImpulse=this.lowerImpulse,e.upperImpulse=this.upperImpulse,e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.maxMotorForce=this.maxMotorForce,e.motorSpeed=this.motorSpeed,e.referenceAngle=this.referenceAngle,e.lowerTranslation=this.lowerTranslation,e.upperTranslation=this.upperTranslation,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.axisA=this.axisA.clone(),e.deltaCenter=this.deltaCenter.clone(),e.deltaAngle=this.deltaAngle,e.axialMass=this.axialMass,e.springSoftness=this.springSoftness.clone(),e.enableSpring=this.enableSpring,e.enableLimit=this.enableLimit,e.enableMotor=this.enableMotor,e}},ha=class t{constructor(){this.linearImpulse=new g,this.springImpulse=0,this.motorImpulse=0,this.lowerImpulse=0,this.upperImpulse=0,this.hertz=0,this.dampingRatio=0,this.maxMotorTorque=0,this.motorSpeed=0,this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.indexA=x,this.indexB=x,this.anchorA=new g,this.anchorB=new g,this.deltaCenter=new g,this.deltaAngle=0,this.axialMass=0,this.springSoftness=new re,this.enableSpring=!1,this.enableMotor=!1,this.enableLimit=!1}clone(){let e=new t;return e.linearImpulse=this.linearImpulse.clone(),e.springImpulse=this.springImpulse,e.motorImpulse=this.motorImpulse,e.lowerImpulse=this.lowerImpulse,e.upperImpulse=this.upperImpulse,e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.maxMotorTorque=this.maxMotorTorque,e.motorSpeed=this.motorSpeed,e.referenceAngle=this.referenceAngle,e.lowerAngle=this.lowerAngle,e.upperAngle=this.upperAngle,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.deltaAngle=this.deltaAngle,e.axialMass=this.axialMass,e.springSoftness=this.springSoftness,e.enableSpring=this.enableSpring,e.enableMotor=this.enableMotor,e.enableLimit=this.enableLimit,e}},ma=class t{constructor(){this.referenceAngle=0,this.linearHertz=0,this.linearDampingRatio=0,this.angularHertz=0,this.angularDampingRatio=0,this.linearSoftness=new re,this.angularSoftness=new re,this.linearImpulse=new g,this.angularImpulse=0,this.indexA=x,this.indexB=x,this.anchorA=new g,this.anchorB=new g,this.deltaCenter=new g,this.deltaAngle=0,this.axialMass=0}clone(){let e=new t;return e.referenceAngle=this.referenceAngle,e.linearHertz=this.linearHertz,e.linearDampingRatio=this.linearDampingRatio,e.angularHertz=this.angularHertz,e.angularDampingRatio=this.angularDampingRatio,e.linearSoftness=this.linearSoftness,e.angularSoftness=this.angularSoftness,e.linearImpulse=this.linearImpulse.clone(),e.angularImpulse=this.angularImpulse,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.deltaAngle=this.deltaAngle,e.axialMass=this.axialMass,e}},ya=class t{constructor(){this.localAxisA=new g,this.perpImpulse=0,this.motorImpulse=0,this.springImpulse=0,this.lowerImpulse=0,this.upperImpulse=0,this.maxMotorTorque=0,this.motorSpeed=0,this.lowerTranslation=0,this.upperTranslation=0,this.hertz=0,this.dampingRatio=0,this.indexA=x,this.indexB=x,this.anchorA=new g,this.anchorB=new g,this.axisA=new g,this.deltaCenter=new g,this.perpMass=0,this.motorMass=0,this.axialMass=0,this.springSoftness=new re,this.enableSpring=!1,this.enableMotor=!1,this.enableLimit=!1}clone(){let e=new t;return e.localAxisA=this.localAxisA.clone(),e.perpImpulse=this.perpImpulse,e.motorImpulse=this.motorImpulse,e.springImpulse=this.springImpulse,e.lowerImpulse=this.lowerImpulse,e.upperImpulse=this.upperImpulse,e.maxMotorTorque=this.maxMotorTorque,e.motorSpeed=this.motorSpeed,e.lowerTranslation=this.lowerTranslation,e.upperTranslation=this.upperTranslation,e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.axisA=this.axisA.clone(),e.deltaCenter=this.deltaCenter.clone(),e.perpMass=this.perpMass,e.motorMass=this.motorMass,e.axialMass=this.axialMass,e.springSoftness=this.springSoftness,e.enableSpring=this.enableSpring,e.enableMotor=this.enableMotor,e.enableLimit=this.enableLimit,e}},Ws=class{constructor(){this.jointId=x,this.bodyIdA=x,this.bodyIdB=x,this.type=k.b2_unknown,this.localOriginAnchorA=new g,this.localOriginAnchorB=new g,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.joint=null,this.distanceJoint=null,this.motorJoint=null,this.mouseJoint=null,this.revoluteJoint=null,this.prismaticJoint=null,this.weldJoint=null,this.wheelJoint=null}copyTo(e){e.jointId=this.jointId,e.bodyIdA=this.bodyIdA,e.bodyIdB=this.bodyIdB,e.type=this.type,e.localOriginAnchorA=this.localOriginAnchorA.clone(),e.localOriginAnchorB=this.localOriginAnchorB.clone(),e.invMassA=this.invMassA,e.invMassB=this.invMassB,e.invIA=this.invIA,e.invIB=this.invIB,e.joint=this.joint,e.distanceJoint=this.distanceJoint?this.distanceJoint.clone():null,e.motorJoint=this.motorJoint?this.motorJoint.clone():null,e.mouseJoint=this.mouseJoint?this.mouseJoint.clone():null,e.revoluteJoint=this.revoluteJoint?this.revoluteJoint.clone():null,e.prismaticJoint=this.prismaticJoint?this.prismaticJoint.clone():null,e.weldJoint=this.weldJoint?this.weldJoint.clone():null,e.wheelJoint=this.wheelJoint?this.wheelJoint.clone():null}};var fa=class{setIndex=0;localIndex=0;islandId=0;headBody=0;tailBody=0;bodyCount=0;headContact=0;tailContact=0;contactCount=0;headJoint=0;tailJoint=0;jointCount=0;parentIsland=0;constraintRemoveCount=0},Os=class{islandId=0};function xa(t,e){let o=ne(t.islandIdPool);if(o===t.islandArray.length){let i=new fa;i.setIndex=x,t.islandArray.push(i)}let n=t.solverSetArray[e],s=t.islandArray[o];s.setIndex=e,s.localIndex=n.islands.count,s.islandId=o,s.headBody=x,s.tailBody=x,s.bodyCount=0,s.headContact=x,s.tailContact=x,s.contactCount=0,s.headJoint=x,s.tailJoint=x,s.jointCount=0,s.parentIsland=x,s.constraintRemoveCount=0;let r=On(n.islands);return r.islandId=o,s}function si(t,e){let o=t.islandArray[e],n=t.solverSetArray[o.setIndex];if(Or(n.islands,o.localIndex)!==x){let i=n.islands.data[o.localIndex].islandId,c=t.islandArray[i];c.localIndex=o.localIndex}o.islandId=x,o.setIndex=x,o.localIndex=x,xe(t.islandIdPool,e)}function _o(t,e){return t.islandArray[e]}function mp(t,e,o){let n=t.islandArray[e];if(n.headContact!==x){o.islandNext=n.headContact;let s=t.contactArray[n.headContact];s.islandPrev=o.contactId}n.headContact=o.contactId,n.tailContact===x&&(n.tailContact=n.headContact),n.contactCount+=1,o.islandId=e,go(t,e)}function fp(t,e){let o=e.edges[0].bodyId,n=e.edges[1].bodyId,s=_t(t,o),r=_t(t,n);s.setIndex===M.b2_awakeSet&&r.setIndex>=M.b2_firstSleepingSet&&qe(t,r.setIndex),r.setIndex===M.b2_awakeSet&&s.setIndex>=M.b2_firstSleepingSet&&qe(t,s.setIndex);let i=s.islandId,c=r.islandId;if(i===c){mp(t,i,e);return}let a=null;if(i!==x){a=_o(t,i);let d=a.parentIsland;for(;d!==x;){let p=_o(t,d);p.parentIsland!==x&&(a.parentIsland=p.parentIsland),a=p,i=d,d=a.parentIsland}}let l=null;if(c!==x){l=_o(t,c);let d=l.parentIsland;for(;l.parentIsland!==x;){let p=_o(t,d);p.parentIsland!==x&&(l.parentIsland=p.parentIsland),l=p,c=d,d=l.parentIsland}}a!==l&&a!==null&&l!==null&&(l.parentIsland=i),a!==null?mp(t,i,e):mp(t,c,e)}function ri(t,e){let o=e.islandId,n=_o(t,o);if(e.islandPrev!==x){let s=t.contactArray[e.islandPrev];s.islandNext=e.islandNext}if(e.islandNext!==x){let s=t.contactArray[e.islandNext];s.islandPrev=e.islandPrev}n.headContact===e.contactId&&(n.headContact=e.islandNext),n.tailContact===e.contactId&&(n.tailContact=e.islandPrev),n.contactCount-=1,n.constraintRemoveCount+=1,e.islandId=x,e.islandPrev=x,e.islandNext=x,go(t,o)}function yp(t,e,o){let n=t.islandArray[e];if(n.headJoint!==x){o.islandNext=n.headJoint;let s=Me(t,n.headJoint);s.islandPrev=o.jointId}n.headJoint=o.jointId,n.tailJoint===x&&(n.tailJoint=n.headJoint),n.jointCount+=1,o.islandId=e,go(t,e)}function Ys(t,e){let o=_t(t,e.edges[0].bodyId),n=_t(t,e.edges[1].bodyId);o.setIndex===M.b2_awakeSet&&n.setIndex>=M.b2_firstSleepingSet?qe(t,n.setIndex):n.setIndex===M.b2_awakeSet&&o.setIndex>=M.b2_firstSleepingSet&&qe(t,o.setIndex);let s=o.islandId,r=n.islandId;if(s===r){yp(t,s,e);return}let i=null;if(s!==x)for(i=_o(t,s);i.parentIsland!==x;){let a=_o(t,i.parentIsland);a.parentIsland!==x&&(i.parentIsland=a.parentIsland),s=i.parentIsland,i=a}let c=null;if(r!==x)for(c=_o(t,r);c.parentIsland!==x;){let a=_o(t,c.parentIsland);a.parentIsland!==x&&(c.parentIsland=a.parentIsland),r=c.parentIsland,c=a}i!==c&&i!==null&&c!==null&&(c.parentIsland=s),i!==null?yp(t,s,e):yp(t,r,e)}function Ns(t,e){let o=e.islandId,n=t.islandArray[o];if(e.islandPrev!==x){let s=Me(t,e.islandPrev);s.islandNext=e.islandNext}if(e.islandNext!==x){let s=Me(t,e.islandNext);s.islandPrev=e.islandPrev}n.headJoint===e.jointId&&(n.headJoint=e.islandNext),n.tailJoint===e.jointId&&(n.tailJoint=e.islandPrev),n.jointCount-=1,n.constraintRemoveCount+=1,e.islandId=x,e.islandPrev=x,e.islandNext=x,go(t,o)}function Vm(t,e){let o=e.parentIsland,n=t.islandArray[o],s=e.headBody;for(;s!==x;){let l=_t(t,s);l.islandId=o,s=l.islandNext}let r=e.headContact;for(;r!==x;){let l=t.contactArray[r];l.islandId=o,r=l.islandNext}let i=e.headJoint;for(;i!==x;){let l=Me(t,i);l.islandId=o,i=l.islandNext}let c=_t(t,n.tailBody);c.islandNext=e.headBody;let a=_t(t,e.headBody);if(a.islandPrev=n.tailBody,n.tailBody=e.tailBody,n.bodyCount+=e.bodyCount,n.headContact===x)n.headContact=e.headContact,n.tailContact=e.tailContact,n.contactCount=e.contactCount;else if(e.headContact!==x){let l=t.contactArray[n.tailContact];l.islandNext=e.headContact;let d=t.contactArray[e.headContact];d.islandPrev=n.tailContact,n.tailContact=e.tailContact,n.contactCount+=e.contactCount}if(n.headJoint===x)n.headJoint=e.headJoint,n.tailJoint=e.tailJoint,n.jointCount=e.jointCount;else if(e.headJoint!==x){let l=Me(t,n.tailJoint);l.islandNext=e.headJoint;let d=Me(t,e.headJoint);d.islandPrev=n.tailJoint,n.tailJoint=e.tailJoint,n.jointCount+=e.jointCount}n.constraintRemoveCount+=e.constraintRemoveCount,go(t,o)}function fl(t){let e=t.solverSetArray[M.b2_awakeSet],o=e.islands.data,n=e.islands.count,s=t.islandArray;for(let r=0;r<n;++r){let i=o[r].islandId,c=s[i],a=i,l=c;for(;l.parentIsland!==x;){let d=s[l.parentIsland];d.parentIsland!==x&&(l.parentIsland=d.parentIsland),a=l.parentIsland,l=d}l!==c&&(c.parentIsland=a)}for(let r=n-1;r>=0;--r){let i=o[r].islandId,c=s[i];c.parentIsland!==x&&(Vm(t,c),si(t,i))}Hn(t)}function Ur(t,e){let o=t.islandArray[e],n=o.setIndex;if(n!==M.b2_awakeSet||o.constraintRemoveCount===0)return;go(t,e);let s=o.bodyCount,r=t.bodyArray,i=t.contactArray,c=[],a=[],l=o.headBody;for(;l!==x;){a.push(l);let b=r[l];b.isMarked=!1,l=b.islandNext}let d=o.headContact;for(;d!==x;){let b=i[d];b.isMarked=!1,d=b.islandNext}let p=o.headJoint;for(;p!==x;){let b=Me(t,p);b.isMarked=!1,p=b.islandNext}si(t,e);for(let b=0;b<s;++b){let u=a[b],h=r[u];if(h.isMarked===!0)continue;c.push(u),h.isMarked=!0;let m=xa(t,n),f=m.islandId;for(;c.length>0;){let y=c.pop(),I=r[y];I.islandId=f,m.tailBody!==x&&(r[m.tailBody].islandNext=y),I.islandPrev=m.tailBody,I.islandNext=x,m.tailBody=y,m.headBody===x&&(m.headBody=y),m.bodyCount+=1;let C=I.headContactKey;for(;C!==x;){let S=C>>1,A=C&1,B=t.contactArray[S];if(C=B.edges[A].nextKey,B.isMarked||B.flags&mt.b2_contactSensorFlag||!(B.flags&mt.b2_contactTouchingFlag))continue;B.isMarked=!0;let w=A^1,D=B.edges[w].bodyId,v=r[D];if(v.isMarked===!1&&v.setIndex!==M.b2_staticSet&&(c.push(D),v.isMarked=!0),B.islandId=f,m.tailContact!==x){let P=t.contactArray[m.tailContact];P.islandNext=S}B.islandPrev=m.tailContact,B.islandNext=x,m.tailContact=S,m.headContact===x&&(m.headContact=S),m.contactCount+=1}let _=I.headJointKey;for(;_!==x;){let S=_>>1,A=_&1,B=Me(t,S);if(_=B.edges[A].nextKey,B.isMarked)continue;B.isMarked=!0;let w=A^1,D=B.edges[w].bodyId,v=r[D];if(v.setIndex!==M.b2_disabledSet){if(v.isMarked===!1&&v.setIndex===M.b2_awakeSet&&(c.push(D),v.isMarked=!0),B.islandId=f,m.tailJoint!==x){let P=Me(t,m.tailJoint);P.islandNext=S}B.islandPrev=m.tailJoint,B.islandNext=x,m.tailJoint=S,m.headJoint===x&&(m.headJoint=S),m.jointCount+=1}}}go(t,f)}}function go(t,e){if(!po)return;se(t.islandArray,e);let o=t.islandArray[e];{let n=t.bodyArray;o.bodyCount>1;let s=0,r=o.headBody;for(;r!=x;){se(n,r);let i=n[r];s+=1,s==o.bodyCount,r=i.islandNext}}if(o.headContact!=x){o.contactCount>1;let n=0,s=o.headContact;for(;s!=x;){se(t.contactArray,s);let r=t.contactArray[s];n+=1,n==o.contactCount,s=r.islandNext}}if(o.headJoint!=x){o.jointCount>1;let n=0,s=o.headJoint;for(;s!=x;){se(t.jointArray,s);let r=t.jointArray[s];n+=1,n==o.jointCount,s=r.islandNext}}}function ra(t,e){return e.c1.x=t.center0X,e.c1.y=t.center0Y,e.c2.copy(t.center),e.q1.copy(t.rotation0),e.q2.copy(t.transform.q),e.localCenter.copy(t.localCenter),e}function _t(t,e){return t.bodyArray[e]}function Z(t,e){return _t(t,e.index1-1)}function Rt(t,e){return t.solverSetArray[e.setIndex].sims.data[e.localIndex].transform}function he(t,e){let o=t.bodyArray[e];return Rt(t,o)}function Ps(t,e){let o=t.bodyArray[e];return new Ee(e+1,t.worldId,o.revision)}function jt(t,e){return t.solverSetArray[e.setIndex].sims.data[e.localIndex]}function $n(t,e){return e.setIndex===M.b2_awakeSet?t.solverSetArray[M.b2_awakeSet].states.data[e.localIndex]:null}function xp(t,e,o){let n=xa(t,e);o.islandId=n.islandId,n.headBody=o.id,n.tailBody=o.id,n.bodyCount=1}function Ip(t,e){if(e.islandId===x)return;let o=e.islandId,n=t.islandArray[o];if(e.islandPrev!==x){let r=_t(t,e.islandPrev);r.islandNext=e.islandNext}if(e.islandNext!==x){let r=_t(t,e.islandNext);r.islandPrev=e.islandPrev}n.bodyCount-=1;let s=!1;n.headBody===e.id?(n.headBody=e.islandNext,n.headBody===x&&(si(t,n.islandId),s=!0)):n.tailBody===e.id&&(n.tailBody=e.islandPrev),s===!1&&go(t,o),e.islandId=x,e.islandPrev=x,e.islandNext=x}function Sp(t,e,o){let n=e.headContactKey;for(;n!==x;){let s=n>>1,r=n&1,i=t.contactArray[s];n=i.edges[r].nextKey,fo(t,i,o)}Lt(t)}function Bo(t,e){let o=gt(t);if(o.locked)return new Ee(0,0,0);let n=(e.isAwake||e.enableSleep===!1)&&e.isEnabled,s;if(e.isEnabled===!1)s=M.b2_disabledSet;else if(e.type===tt.b2_staticBody)s=M.b2_staticSet;else if(n===!0)s=M.b2_awakeSet;else{if(s=ne(o.solverSetIdPool),s===o.solverSetArray.length){let l=new so;l.setIndex=s,o.solverSetArray.push(l)}o.solverSetArray[s].setIndex=s}let r=ne(o.bodyIdPool),i=o.solverSetArray[s],c=mn(i.sims);if(Object.assign(c,{transform:new at(e.position,e.rotation),center:e.position.clone(),rotation0:e.rotation,center0X:e.position.x,center0Y:e.position.y,localCenter:new g,force:new g,torque:0,mass:0,invMass:0,inertia:0,invInertia:0,minExtent:De,maxExtent:0,linearDamping:e.linearDamping,angularDamping:e.angularDamping,gravityScale:e.gravityScale,bodyId:r,isBullet:e.isBullet,allowFastRotation:e.allowFastRotation,enlargeAABB:!1,isFast:!1,isSpeedCapped:!1}),s===M.b2_awakeSet){let l=js(i.states);Object.assign(l,{linearVelocity:e.linearVelocity,angularVelocity:e.angularVelocity,deltaRotation:new rt})}for(;r>=o.bodyArray.length;)o.bodyArray.push(new _a);let a=o.bodyArray[r];return Object.assign(a,{userData:e.userData,setIndex:s,localIndex:i.sims.count-1,revision:a.revision+1,headShapeId:x,shapeCount:0,headChainId:x,headContactKey:x,contactCount:0,headJointKey:x,jointCount:0,islandId:x,islandPrev:x,islandNext:x,bodyMoveIndex:x,id:r,sleepThreshold:e.sleepThreshold,sleepTime:0,type:e.type,enableSleep:e.enableSleep,fixedRotation:e.fixedRotation,isSpeedCapped:!1,isMarked:!1,updateBodyMass:e.updateBodyMass}),s>=M.b2_awakeSet&&xp(o,s,a),Lt(o),new Ee(r+1,o.worldId,a.revision)}function Ot(t,e){return e.setIndex>=M.b2_firstSleepingSet?(qe(t,e.setIndex),!0):!1}function _n(t){let e=ft(t.world0);if(e===null)return;let o=Z(e,t),n=!0,s=o.headJointKey;for(;s!==x;){let l=s>>1,d=s&1,p=e.jointArray[l];s=p.edges[d].nextKey,aa(e,p,n)}Sp(e,o,n);let r=o.headShapeId;for(;r!==x;){let l=e.shapeArray[r];an(l,e.broadPhase),xe(e.shapeIdPool,r),l.id=x,r=l.nextShapeId}let i=o.headChainId;for(;i!==x;){let l=e.chainArray[i];l.shapeIndices=null,xe(e.chainIdPool,i),l.id=x,i=l.nextChainId}Ip(e,o);let c=e.solverSetArray[o.setIndex];if(Fs(c.sims,o.localIndex)!==x){let d=c.sims.data[o.localIndex].bodyId,p=e.bodyArray[d];p.localIndex=o.localIndex}if(o.setIndex===M.b2_awakeSet){let l=Xs(c.states,o.localIndex)}else c.setIndex>=M.b2_firstSleepingSet&&c.sims.count==0&&Wn(e,c.setIndex);xe(e.bodyIdPool,o.id),o.setIndex=x,o.localIndex=x,o.id=x,Lt(e)}function _p(t){let e=ft(t.world0);return e===null?0:Z(e,t).contactCount}function gp(t,e,o){let n=ft(t.world0);if(n===null)return 0;let r=Z(n,t).headContactKey,i=0;for(;r!==x&&i<o;){let c=r>>1,a=r&1,l=n.contactArray[c];if(l.flags&mt.b2_contactTouchingFlag){let d=n.shapeArray[l.shapeIdA],p=n.shapeArray[l.shapeIdB];e[i].shapeIdA=new St(d.id+1,t.world0,d.revision),e[i].shapeIdB=new St(p.id+1,t.world0,p.revision);let b=Yn(n,l);e[i].manifold=b.manifold,i+=1}r=l.edges[a].nextKey}return i}function Bp(t){let e=ft(t.world0);if(e===null)return new xt;let o=Z(e,t);if(o.headShapeId===x){let r=he(e,o.id);return new xt(r.p.x,r.p.y,r.p.x,r.p.y)}let n=e.shapeArray[o.headShapeId],s=n.aabb;for(;n.nextShapeId!==x;)n=e.shapeArray[n.nextShapeId],s=qt(s,n.aabb);return s}function cn(t,e){let o=jt(t,e);if(o.mass=0,o.invMass=0,o.inertia=0,o.invInertia=0,o.minExtent=De,o.maxExtent=0,e.type!==tt.b2_dynamicBody){if(o.center=o.transform.p.clone(),e.type===tt.b2_kinematicBody){let c=e.headShapeId;for(;c!==x;){let a=t.shapeArray[c];c=a.nextShapeId;let l=Yi(a,new g);o.minExtent=Math.min(o.minExtent,l.minExtent),o.maxExtent=Math.max(o.maxExtent,l.maxExtent)}}return}let n=new g,s=e.headShapeId;for(;s!==x;){let c=t.shapeArray[s];if(s=c.nextShapeId,c.density===0)continue;let a=tc(c);o.mass+=a.mass,n=$(n,a.mass,a.center),o.inertia+=a.rotationalInertia}o.mass>0&&(o.invMass=1/o.mass,n=it(o.invMass,n)),o.inertia>0&&e.fixedRotation===!1?(o.inertia-=o.mass*j(n,n),o.invInertia=1/o.inertia):(o.inertia=0,o.invInertia=0);let r=o.center.clone();o.localCenter=n,o.center=H(o.transform,o.localCenter);let i=$n(t,e);if(i!==null){let c=Gt(i.angularVelocity,J(o.center,r));i.linearVelocity=U(i.linearVelocity,c)}for(s=e.headShapeId;s!==x;){let c=t.shapeArray[s];s=c.nextShapeId;let a=Yi(c,n);o.minExtent=Math.min(o.minExtent,a.minExtent),o.maxExtent=Math.max(o.maxExtent,a.maxExtent)}}function Ap(t){let e=O(t.world0),o=Z(e,t);return Rt(e,o).p}function Us(t){let e=O(t.world0),o=Z(e,t);return Rt(e,o).q}function ii(t){let e=O(t.world0),o=Z(e,t);return Rt(e,o)}function zs(t,e){let o=O(t.world0),n=Z(o,t),s=Rt(o,n);return Re(s,e)}function Cp(t,e){let o=O(t.world0),n=Z(o,t),s=Rt(o,n);return H(s,e)}function wp(t,e){let o=O(t.world0),n=Z(o,t),s=Rt(o,n);return Ie(s.q,e)}function vp(t,e){let o=O(t.world0),n=Z(o,t),s=Rt(o,n);return K(s.q,e)}function Ks(t,e,o){let n=O(t.world0),s=Z(n,t),r=jt(n,s);r.transform.p=e,o!==void 0&&(r.transform.q=o),r.center=H(r.transform,r.localCenter),r.rotation0=r.transform.q,r.center0X=r.center.x,r.center0Y=r.center.y;let i=n.broadPhase,c=r.transform,a=vn,l=Qt,d=s.headShapeId;for(;d!==x;){let p=n.shapeArray[d],b=Xo(p,c);if(b.lowerBoundX-=l,b.lowerBoundY-=l,b.upperBoundX+=l,b.upperBoundY+=l,p.aabb=b,vo(p.fatAABB,b)===!1){let u=new xt(b.lowerBoundX-a,b.lowerBoundY-a,b.upperBoundX+a,b.upperBoundY+a);p.fatAABB=u,p.proxyKey!==x&&Dr(i,p.proxyKey,u)}d=p.nextShapeId}}function Jp(t){let e=O(t.world0),o=Z(e,t),n=$n(e,o);return n!==null?n.linearVelocity.clone():new g}function Mp(t){let e=O(t.world0),o=Z(e,t),n=$n(e,o);return n!==null?n.angularVelocity:0}function Dp(t,e){let o=O(t.world0),n=Z(o,t);if(n.type==tt.b2_staticBody)return;be(e)>0&&Ot(o,n);let s=$n(o,n);s!==null&&(s.linearVelocity=e)}function Pp(t,e){let o=O(t.world0),n=Z(o,t);if(n.type==tt.b2_staticBody||n.fixedRotation)return;e!==0&&Ot(o,n);let s=$n(o,n);s!==null&&(s.angularVelocity=e)}function kp(t,e,o,n){let s=O(t.world0),r=Z(s,t);if(n&&r.setIndex>=M.b2_firstSleepingSet&&Ot(s,r),r.setIndex===M.b2_awakeSet){let i=jt(s,r);i.force=U(i.force,e),i.torque+=z(J(o,i.center),e)}}function Ia(t,e,o){let n=O(t.world0),s=Z(n,t);if(o&&s.setIndex>=M.b2_firstSleepingSet&&Ot(n,s),s.setIndex===M.b2_awakeSet){let r=jt(n,s);r.force=U(r.force,e)}}function Tp(t,e,o){let n=O(t.world0),s=Z(n,t);if(o&&s.setIndex>=M.b2_firstSleepingSet&&Ot(n,s),s.setIndex===M.b2_awakeSet){let r=jt(n,s);r.torque+=e}}function Gp(t,e,o,n){let s=O(t.world0),r=Z(s,t);if(n&&r.setIndex>=M.b2_firstSleepingSet&&Ot(s,r),r.setIndex===M.b2_awakeSet){let i=r.localIndex,c=s.solverSetArray[M.b2_awakeSet],a=c.states.data[i],l=c.sims.data[i];a.linearVelocity=$(a.linearVelocity,l.invMass,e),a.angularVelocity+=l.invInertia*z(J(o,l.center),e)}}function Rp(t,e,o){let n=O(t.world0),s=Z(n,t);if(o&&s.setIndex>=M.b2_firstSleepingSet&&Ot(n,s),s.setIndex===M.b2_awakeSet){let r=s.localIndex,i=n.solverSetArray[M.b2_awakeSet],c=i.states.data[r],a=i.sims.data[r];c.linearVelocity=$(c.linearVelocity,a.invMass,e)}}function Lp(t,e,o){let n=O(t.world0),s=t.index1-1,r=n.bodyArray[s];if(o&&r.setIndex>=M.b2_firstSleepingSet&&Ot(n,r),r.setIndex===M.b2_awakeSet){let i=r.localIndex,c=n.solverSetArray[M.b2_awakeSet],a=c.states.data[i],l=c.sims.data[i];a.angularVelocity+=l.invInertia*e}}function Ep(t){let e=O(t.world0);return Z(e,t).type}function jp(t,e){let o=O(t.world0),n=Z(o,t),s=n.type;if(s===e)return;if(n.setIndex===M.b2_disabledSet){n.type=e,cn(o,n);return}Sp(o,n,!1),Ot(o,n);{let i=n.headJointKey;for(;i!==x;){let c=i>>1,a=i&1,l=o.jointArray[c];l.islandId!==x&&Ns(o,l);let d=o.bodyArray[l.edges[0].bodyId],p=o.bodyArray[l.edges[1].bodyId];Ot(o,d),Ot(o,p),i=l.edges[a].nextKey}}if(n.type=e,s===tt.staticBody){let i=o.solverSetArray[M.b2_staticSet],c=o.solverSetArray[M.b2_awakeSet];Ls(o,c,i,n),xp(o,M.b2_awakeSet,n);let a=n.headJointKey;for(;a!==x;){let p=a>>1,b=a&1,u=o.jointArray[p];u.setIndex===M.b2_staticSet?So(o,c,i,u):u.setIndex===M.b2_awakeSet&&(So(o,i,c,u),So(o,c,i,u)),a=u.edges[b].nextKey}let l=Rt(o,n),d=n.headShapeId;for(;d!==x;){let p=o.shapeArray[d];d=p.nextShapeId,an(p,o.broadPhase);let b=!0,u=e;Vn(p,o.broadPhase,u,l,b)}}else if(e===tt.b2_staticBody){let i=o.solverSetArray[M.b2_staticSet],c=o.solverSetArray[M.b2_awakeSet];Ls(o,i,c,n),Ip(o,n);let a=n.headJointKey;for(;a!==x;){let p=a>>1,b=a&1,u=o.jointArray[p];a=u.edges[b].nextKey;let h=b^1,m=o.bodyArray[u.edges[h].bodyId];u.setIndex!==M.b2_disabledSet&&(m.setIndex===M.b2_staticSet?So(o,i,c,u):(So(o,i,c,u),So(o,c,i,u)))}let l=Rt(o,n),d=n.headShapeId;for(;d!==x;){let p=o.shapeArray[d];d=p.nextShapeId,an(p,o.broadPhase),Vn(p,o.broadPhase,tt.b2_staticBody,l,!0)}}else{let i=Rt(o,n),c=n.headShapeId;for(;c!==x;){let a=o.shapeArray[c];c=a.nextShapeId,an(a,o.broadPhase);let l=e;Vn(a,o.broadPhase,l,i,!0)}}{let i=n.headJointKey;for(;i!==x;){let c=i>>1,a=i&1,l=o.jointArray[c];i=l.edges[a].nextKey;let d=a^1,p=l.edges[d].bodyId,b=o.bodyArray[p];b.setIndex!==M.b2_disabledSet&&(n.type===tt.b2_staticBody&&b.type===tt.b2_staticBody||Ys(o,l))}}cn(o,n),Hn(o),Lt(o)}function gn(t,e){let o=O(t.world0),n=Z(o,t);n.userData=e}function Fp(t){let e=O(t.world0);return Z(e,t).userData}function Xp(t){let e=O(t.world0),o=Z(e,t);return jt(e,o).mass}function qp(t){let e=O(t.world0),o=Z(e,t);return jt(e,o).inertia}function Vp(t){let e=O(t.world0),o=Z(e,t);return jt(e,o).localCenter.clone()}function Yp(t){let e=O(t.world0),o=Z(e,t);return jt(e,o).center.clone()}function Np(t,e){let o=ft(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.mass=e.mass,s.inertia=e.rotationalInertia,s.localCenter=e.center;let r=H(s.transform,e.center);s.center=r,s.center0X=r.x,s.center0Y=r.y,s.invMass=s.mass>0?1/s.mass:0,s.invInertia=s.inertia>0?1/s.inertia:0}function Wp(t){let e=O(t.world0),o=Z(e,t),n=jt(e,o),s=new je;return s.mass=n.mass,s.center=n.localCenter,s.rotationalInertia=n.inertia,s}function Op(t){let e=ft(t.world0);if(e===null)return;let o=Z(e,t);cn(e,o)}function Up(t,e){let o=ft(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.linearDamping=e}function zp(t){let e=O(t.world0),o=Z(e,t);return jt(e,o).linearDamping}function Kp(t,e){let o=ft(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.angularDamping=e}function Hp(t){let e=O(t.world0),o=Z(e,t);return jt(e,o).angularDamping}function $p(t,e){let o=ft(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.gravityScale=e}function Qp(t){let e=O(t.world0),o=Z(e,t);return jt(e,o).gravityScale}function Zp(t){let e=O(t.world0);return Z(e,t).setIndex===M.b2_awakeSet}function tu(t,e){let o=ft(t.world0);if(o===null)return;let n=Z(o,t);e&&n.setIndex>=M.b2_firstSleepingSet?Ot(o,n):e===!1&&n.setIndex===M.b2_awakeSet&&(o.islandArray[n.islandId].constraintRemoveCount>0&&Ur(o,n.islandId),Yr(o,n.islandId))}function eu(t){let e=O(t.world0);return Z(e,t).setIndex!==M.b2_disabledSet}function ou(t){let e=O(t.world0);return Z(e,t).enableSleep}function nu(t,e){let o=O(t.world0),n=Z(o,t);n.sleepThreshold=e}function su(t){let e=O(t.world0);return Z(e,t).sleepThreshold}function ru(t,e){let o=ft(t.world0);if(o===null)return;let n=Z(o,t);n.enableSleep=e,e===!1&&Ot(o,n)}function iu(t){let e=ft(t.world0);if(e===null)return;let o=Z(e,t);if(o.setIndex===M.b2_disabledSet)return;Sp(e,o,!0),Ip(e,o);let s=o.headShapeId;for(;s!==x;){let a=e.shapeArray[s];s=a.nextShapeId,an(a,e.broadPhase)}let r=e.solverSetArray[o.setIndex],i=e.solverSetArray[M.b2_disabledSet];Ls(e,i,r,o);let c=o.headJointKey;for(;c!==x;){let a=c>>1,l=c&1,d=e.jointArray[a];if(c=d.edges[l].nextKey,d.setIndex===M.b2_disabledSet)continue;d.islandId!==x&&Ns(e,d);let p=e.solverSetArray[d.setIndex];So(e,i,p,d)}Hn(e),Lt(e)}function au(t){let e=ft(t.world0);if(e===null)return;let o=Z(e,t);if(o.setIndex!==M.b2_disabledSet)return;let n=e.solverSetArray[M.b2_disabledSet],s=o.type===tt.b2_staticBody?M.b2_staticSet:M.b2_awakeSet,r=e.solverSetArray[s];Ls(e,r,n,o);let i=Rt(e,o),c=o.type,a=!0,l=o.headShapeId;for(;l!==x;){let p=e.shapeArray[l];l=p.nextShapeId,Vn(p,e.broadPhase,c,i,a)}s!==M.b2_staticSet&&xp(e,s,o);let d=o.headJointKey;for(;d!==x;){let p=d>>1,b=d&1,u=e.jointArray[p];d=u.edges[b].nextKey;let h=e.bodyArray[u.edges[0].bodyId],m=e.bodyArray[u.edges[1].bodyId];if(h.setIndex===M.b2_disabledSet||m.setIndex===M.b2_disabledSet)continue;let f;h.setIndex===M.b2_staticSet&&m.setIndex===M.b2_staticSet?f=M.b2_staticSet:h.setIndex===M.b2_staticSet?f=m.setIndex:f=h.setIndex;let y=e.solverSetArray[f];So(e,y,n,u),f!==M.b2_staticSet&&Ys(e,u)}Hn(e),Lt(e)}function cu(t,e){let o=ft(t.world0);if(o===null)return;let n=Z(o,t);if(n.fixedRotation!==e){n.fixedRotation=e;let s=$n(o,n);s!==null&&(s.angularVelocity=0),cn(o,n)}}function lu(t){let e=O(t.world0);return Z(e,t).fixedRotation}function du(t,e){let o=ft(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.isBullet=e}function bu(t){let e=O(t.world0),o=Z(e,t);return jt(e,o).isBullet}function pu(t,e){let o=O(t.world0),s=Z(o,t).headShapeId;for(;s!==x;){let r=o.shapeArray[s];r.enableHitEvents=e,s=r.nextShapeId}}function uu(t){let e=O(t.world0);return Z(e,t).shapeCount}function Sa(t,e){let o=O(t.world0),s=Z(o,t).headShapeId,r=0;for(;s!==x;){let i=o.shapeArray[s],c=new St(i.id+1,t.world0,i.revision);e[r]=c,r+=1,s=i.nextShapeId}return r}function hu(t){let e=O(t.world0);return Z(e,t).jointCount}function mu(t,e,o){let n=O(t.world0),r=Z(n,t).headJointKey,i=0;for(;r!==x&&i<o;){let c=r>>1,a=r&1,l=Me(n,c),d=new zt;d.index1=c+1,d.world0=t.world0,d.revision=l.revision,e[i]=d,i+=1,r=l.edges[a].nextKey}return i}function zr(t,e,o){if(e.type!==tt.b2_dynamicBody&&o.type!==tt.b2_dynamicBody)return!1;let n,s;for(e.jointCount<o.jointCount?(n=e.headJointKey,s=o.id):(n=o.headJointKey,s=e.id);n!==x;){let r=n>>1,i=n&1,c=i^1,a=Me(t,r);if(a.collideConnected===!1&&a.edges[c].bodyId===s)return!1;n=a.edges[i].nextKey}return!0}function Wo(t){let e=o=>{typeof o=="object"&&o!==null&&Object.keys(o).forEach(n=>{switch(typeof o[n]){case"number":o[n]=0;break;case"boolean":o[n]=!1;break;case"string":o[n]="";break;case"object":Array.isArray(o[n])||(o[n]!==null?e(o[n]):o[n]=null);break}})};e(t)}var _a=class{constructor(){this.userData=null,this.setIndex=0,this.localIndex=0,this.headContactKey=0,this.contactCount=0,this.headShapeId=0,this.shapeCount=0,this.headChainId=0,this.headJointKey=x,this.jointCount=0,this.islandId=0,this.islandPrev=0,this.islandNext=0,this.sleepThreshold=0,this.sleepTime=0,this.bodyMoveIndex=0,this.id=x,this.type=tt.b2_staticBody,this.revision=0,this.enableSleep=!1,this.fixedRotation=!1,this.isSpeedCapped=!1,this.isMarked=!1,this.updateBodyMass=!1}},Pt=class{constructor(){this.linearVelocity=new g(0,0),this.angularVelocity=0,this.flags=0,this.deltaPosition=new g(0,0),this.deltaRotation=new rt(1,0)}},Hs=class{constructor(){this.transform=new at,this.center=new g(0,0),this.rotation0=new rt(1,0),this.center0X=0,this.center0Y=0,this.localCenter=new g(0,0),this.force=new g(0,0),this.torque=0,this.mass=0,this.invMass=0,this.inertia=0,this.invInertia=0,this.minExtent=0,this.maxExtent=0,this.linearDamping=0,this.angularDamping=0,this.gravityScale=0,this.bodyId=0,this.isFast=!1,this.isBullet=!1,this.isSpeedCapped=!1,this.allowFastRotation=!1,this.enlargeAABB=!1}copyTo(e){e.transform=this.transform.deepClone(),e.center=this.center.clone(),e.rotation0=this.rotation0.clone(),e.center0X=this.center0X,e.center0Y=this.center0Y,e.localCenter=this.localCenter.clone(),e.force=this.force.clone(),e.torque=this.torque,e.mass=this.mass,e.invMass=this.invMass,e.inertia=this.inertia,e.invInertia=this.invInertia,e.minExtent=this.minExtent,e.maxExtent=this.maxExtent,e.linearDamping=this.linearDamping,e.angularDamping=this.angularDamping,e.gravityScale=this.gravityScale,e.bodyId=this.bodyId,e.isFast=this.isFast,e.isBullet=this.isBullet,e.isSpeedCapped=this.isSpeedCapped,e.allowFastRotation=this.allowFastRotation,e.enlargeAABB=this.enlargeAABB}};var Ao=16,Es=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}},Nr=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}},ln=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}},Wr=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}},dn=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}};function al(t){let e=new Es(t);return t>0?(e.data=bo(t,()=>new Hs),e):(e.data=null,e)}function cl(t){let e=new ln(t);return t>0?(e.data=bo(t,()=>new Qn),e):(e.data=null,e)}function ll(t){let e=new dn(t);return t>0?(e.data=bo(t,()=>new Ws),e):(e.data=null,e)}function mn(t){if(t.capacity===0)t.data=bo(Ao,()=>new Hs),t.capacity=Ao,t.count=0;else if(t.count===t.capacity){let e=2*t.capacity;kn(t.data,e,()=>new Hs),t.capacity=e}else Wo(t.data[t.count]);return t.count+=1,t.data[t.count-1]}function js(t){if(t.capacity===0)t.data=bo(Ao,()=>new Pt),t.capacity=Ao,t.count=0;else if(t.count===t.capacity){let e=2*t.capacity;kn(t.data,e,()=>new Pt),t.capacity=e}else Wo(t.data[t.count]);return t.count+=1,t.data[t.count-1]}function Xe(t){if(t.capacity===0)t.data=bo(Ao,()=>new Qn),t.capacity=Ao,t.count=0;else if(t.count===t.capacity){let e=8*t.capacity;kn(t.data,e,()=>new Qn),t.capacity=e}else{let e=t.data[t.count];Wo(e),e._bodyIdA=e._bodyIdB=x}return t.count+=1,t.data[t.count-1]}function oo(t){if(t.capacity===0)t.data=bo(Ao,()=>new Ws),t.capacity=Ao,t.count=0;else if(t.count===t.capacity){let e=2*t.capacity;kn(t.data,e,()=>new Ws),t.capacity=e}else Wo(t.data[t.count]);return t.count+=1,t.data[t.count-1]}function On(t){if(t.capacity===0)t.data=bo(Ao,()=>new Os),t.capacity=Ao,t.count=0;else if(t.count===t.capacity){let e=2*t.capacity;kn(t.data,e,()=>new Os),t.capacity=e}else Wo(t.data[t.count]);return t.count+=1,t.data[t.count-1].islandId=x,t.data[t.count-1]}function ai(t,e){if(e<t.count-1){let o=t.data[t.count-1],n=t.data[e];return t.data[e]=o,t.data[t.count-1]=n,t.count-=1,t.count}return t.count-=1,x}function Fs(t,e){return ai(t,e)}function Xs(t,e){return ai(t,e)}function no(t,e){return ai(t,e)}function bn(t,e){return ai(t,e)}function Or(t,e){return ai(t,e)}var ee=(t,e)=>(t&255)<<8|e&255,Dt=new at(new g,new rt),yu=new at(new g,new rt),pt=new g,bt=new g,Kt=new g,Zt=new g;function gu(t,e,o){let n=ki(J(e,t)),s=de(n),r=new ge;return r.vertices=[t,e],r.centroid=$t(t,e,.5),r.normals=[s,Ht(s)],r.count=2,r.radius=o,r}function ci(t,e,o,n,s){Uo(e,n,Dt);let r=t.center,i=Dt.q.c*o.center.x-Dt.q.s*o.center.y+Dt.p.x,c=Dt.q.s*o.center.x+Dt.q.c*o.center.y+Dt.p.y,a=i-r.x,l=c-r.y,d=Math.sqrt(a*a+l*l),p=0,b=0;d>=Xt&&(p=a/d,b=l/d);let u=t.radius,h=o.radius,m=d-u-h;if(m>Qt)return s.clear();let f=r.x+u*p,y=r.y+u*b,I=i+-h*p,C=c+-h*b,_=f+.5*(I-f),S=y+.5*(C-y);s.normalX=e.q.c*p-e.q.s*b,s.normalY=e.q.s*p+e.q.c*b,s.normalX=e.q.c*p-e.q.s*b,s.normalY=e.q.s*p+e.q.c*b;let A=s.points[0];return A.anchorAX=e.q.c*_-e.q.s*S,A.anchorAY=e.q.s*_+e.q.c*S,A.anchorBX=A.anchorAX+(e.p.x-n.p.x),A.anchorBY=A.anchorAY+(e.p.y-n.p.y),A.pointX=e.p.x+A.anchorAX,A.pointY=e.p.y+A.anchorAY,A.separation=m,A.id=0,s.pointCount=1,s}function $s(t,e,o,n,s){Uo(e,n,Dt);let r=H(Dt,o.center),i=t.center1,c=t.center2,a=J(c,i),l,d=j(J(r,i),a),p=j(J(c,r),a);if(d<0)l=i;else if(p<0)l=c;else{let A=d/j(a,a);l=$(i,A,a)}let b=Ye(J(r,l)),u=b.length,h=b.normal,m=t.radius,f=o.radius,y=u-m-f;if(y>Qt)return s.clear();let I=$(l,m,h),C=$(r,-f,h),_=$t(I,C,.5);s.normalX=e.q.c*h.x-e.q.s*h.y,s.normalY=e.q.s*h.x+e.q.c*h.y;let S=s.points[0];return S.anchorAX=e.q.c*_.x-e.q.s*_.y,S.anchorAY=e.q.s*_.x+e.q.c*_.y,S.anchorBX=S.anchorAX+(e.p.x-n.p.x),S.anchorBY=S.anchorAY+(e.p.y-n.p.y),S.pointX=e.p.x+S.anchorAX,S.pointY=e.p.y+S.anchorAY,S.separation=y,S.id=0,s.pointCount=1,s}var Vt=new g;function li(t,e,o,n,s){let r=Qt;Uo(e,n,Dt),Se(Dt,o.center,Vt);let i=t.radius,c=o.radius,a=i+c,l=0,d=-Number.MAX_VALUE,p=t.count,b=t.vertices,u=t.normals;for(let _=0;_<p;++_){let S=u[_].x*(Vt.x-b[_].x)+u[_].y*(Vt.y-b[_].y);S>d&&(d=S,l=_)}if(d>a+r)return s.clear();let h=l,m=h+1<p?h+1:0,f=b[h],y=b[m],I=(Vt.x-f.x)*(y.x-f.x)+(Vt.y-f.y)*(y.y-f.y),C=(Vt.x-y.x)*(f.x-y.x)+(Vt.y-y.y)*(f.y-y.y);if(I<0&&d>Xt){let _=Vt.x-f.x,S=Vt.y-f.y,A=Math.sqrt(_*_+S*S),B=0,w=0;if(A>Xt){let E=1/A;B=_*E,w=S*E}if(d=(Vt.x-f.x)*B+(Vt.y-f.y)*w,d>a+r)return s.clear();let D=f.x+i*B,v=f.y+i*w,P=Vt.x-c*B,T=Vt.y-c*w,R=.5*(D+P),X=.5*(v+T);s.normalX=e.q.c*B-e.q.s*w,s.normalY=e.q.s*B+e.q.c*w;let F=s.points[0];F.anchorAX=e.q.c*R-e.q.s*X,F.anchorAY=e.q.s*R+e.q.c*X,F.anchorBX=F.anchorAX+(e.p.x-n.p.x),F.anchorBY=F.anchorAY+(e.p.y-n.p.y),F.pointX=e.p.x+F.anchorAX,F.pointY=e.p.y+F.anchorAY,F.separation=(P-D)*B+(T-v)*w,F.id=0,s.pointCount=1}else if(C<0&&d>Xt){let _=Vt.x-y.x,S=Vt.y-y.y,A=Math.sqrt(_*_+S*S),B=0,w=0;if(A>Xt){let E=1/A;B=_*E,w=S*E}if(d=(Vt.x-y.x)*B+(Vt.y-y.y)*w,d>a+r)return s.clear();let D=y.x+i*B,v=y.y+i*w,P=Vt.x-c*B,T=Vt.y-c*w,R=.5*(D+P),X=.5*(v+T);s.normalX=e.q.c*B-e.q.s*w,s.normalY=e.q.s*B+e.q.c*w;let F=s.points[0];F.anchorAX=e.q.c*R-e.q.s*X,F.anchorAY=e.q.s*R+e.q.c*X,F.anchorBX=F.anchorAX+(e.p.x-n.p.x),F.anchorBY=F.anchorAY+(e.p.y-n.p.y),F.pointX=e.p.x+F.anchorAX,F.pointY=e.p.y+F.anchorAY,F.separation=(P-D)*B+(T-v)*w,F.id=0,s.pointCount=1}else{let _=u[l].x,S=u[l].y;s.normalX=e.q.c*_-e.q.s*S,s.normalY=e.q.s*_+e.q.c*S;let A=i-((Vt.x-f.x)*_+(Vt.y-f.y)*S),B=Vt.x+A*_,w=Vt.y+A*S,D=Vt.x-c*_,v=Vt.y-c*S,P=(B+D)*.5,T=(w+v)*.5,R=s.points[0];R.anchorAX=e.q.c*P-e.q.s*T,R.anchorAY=e.q.s*P+e.q.c*T,R.anchorBX=R.anchorAX+(e.p.x-n.p.x),R.anchorBY=R.anchorAY+(e.p.y-n.p.y),R.pointX=e.p.x+R.anchorAX,R.pointY=e.p.y+R.anchorAY,R.separation=d-a,R.id=0,s.pointCount=1}return s}function Qs(t,e,o,n,s){let r=t.center1;wi(e.p,1,K(e.q,r),yu.p),yu.q=e.q,Uo(yu,n,Dt),pt.x=0,pt.y=0,Kt.x=t.center2.x-r.x,Kt.y=t.center2.y-r.y,Se(Dt,o.center1,bt),Se(Dt,o.center2,Zt);let i=Kt.x,c=Kt.y,a=Zt.x-bt.x,l=Zt.y-bt.y,d=i*i+c*c,p=a*a+l*l,b=pt.x-bt.x,u=pt.y-bt.y,h=b*i+u*c,m=b*a+u*l,f=i*a+c*l,y=d*p-f*f,I=0;y!==0&&(I=ht((f*m-h*p)/y,0,1));let C=(f*I+m)/p;C<0?(C=0,I=ht(-h/d,0,1)):C>1&&(C=1,I=ht((f-h)/d,0,1));let _={x:pt.x+I*i,y:pt.y+I*c},S={x:bt.x+C*a,y:bt.y+C*l},A=pe(_,S),B=t.radius,w=o.radius,D=B+w,v=D+Qt;if(A>v*v){Wo(s);return}let P=Math.sqrt(A),T=Da(i,c),R=i*1/T,X=c*1/T,F=Da(a,l),E=a*1/F,W=l*1/F,et=(bt.x-pt.x)*R+(bt.y-pt.y)*X,st=(Zt.x-pt.x)*R+(Zt.y-pt.y)*X,ot=et<=0&&st<=0||et>=T&&st>=T,L=(pt.x-bt.x)*R+(pt.y-bt.y)*W,nt=(Kt.x-bt.x)*R+(Kt.y-bt.y)*W,Ct=L<=0&&nt<=0||L>=F&&nt>=F;if(s.pointCount=0,ot===!1&&Ct===!1){let N,Q,wt;{N=-X,Q=R;let lt=(bt.x-pt.x)*N+(bt.y-pt.y)*Q,Et=(Zt.x-pt.x)*N+(Zt.y-pt.y)*Q,Ft=Math.min(lt,Et),Jt=Math.max(-lt,-Et);Ft>Jt?wt=Ft:(wt=Jt,N=-N,Q=-Q)}let ct,At,Tt;{ct=-W,At=E;let lt=(pt.x-bt.x)*ct+(pt.y-bt.y)*At,Et=(Kt.x-bt.x)*ct+(Kt.y-bt.y)*At,Ft=Math.min(lt,Et),Jt=Math.max(-lt,-Et);Ft>Jt?Tt=Ft:(Tt=Jt,ct=-ct,At=-At)}if(wt>=Tt){s.normalX=N,s.normalY=Q;let lt=bt.x,Et=bt.y,Ft=Zt.x,Jt=Zt.y;if(et<0&&st>0){let ut=(0-et)/(st-et);lt=bt.x+ut*(Zt.x-bt.x),Et=bt.y+ut*(Zt.y-bt.y)}else if(st<0&&et>0){let ut=(0-st)/(et-st);Ft=Zt.x+ut*(bt.x-Zt.x),Jt=Zt.y+ut*(bt.y-Zt.y)}if(et>T&&st<T){let ut=(et-T)/(et-st);lt=bt.x+ut*(Zt.x-bt.x),Et=bt.y+ut*(Zt.y-bt.y)}else if(st>T&&et<T){let ut=(st-T)/(st-et);Ft=Zt.x+ut*(bt.x-Zt.x),Jt=Zt.y+ut*(bt.y-Zt.y)}let Te=(lt-pt.x)*N+(Et-pt.y)*Q,Ge=(Ft-pt.x)*N+(Jt-pt.y)*Q;if(Te<=P+It||Ge<=P+It){let ut=.5*(B-w-Te);s.points[0].anchorAX=lt+ut*N,s.points[0].anchorAY=Et+ut*Q,s.points[0].separation=Te-D,s.points[0].id=ee(0,0),ut=.5*(B-w-Ge),s.points[1].anchorAX=Ft+ut*N,s.points[1].anchorAY=Jt+ut*Q,s.points[1].separation=Ge-D,s.points[1].id=ee(0,1),s.pointCount=2}}else{s.normalX=-ct,s.normalY=-At;let lt=pt.x,Et=pt.y,Ft=Kt.x,Jt=Kt.y;if(L<0&&nt>0){let ut=(0-L)/(nt-L);lt=pt.x+ut*(Kt.x-pt.x),Et=pt.y+ut*(Kt.y-pt.y)}else if(nt<0&&L>0){let ut=(0-nt)/(L-nt);Ft=Kt.x+ut*(pt.x-Kt.x),Jt=Kt.y+ut*(pt.y-Kt.y)}if(L>F&&nt<F){let ut=(L-F)/(L-nt);lt=pt.x+ut*(Kt.x-pt.x),Et=pt.y+ut*(Kt.y-pt.y)}else if(nt>F&&L<F){let ut=(nt-F)/(nt-L);Ft=Kt.x+ut*(pt.x-Kt.x),Jt=Kt.y+ut*(pt.y-Kt.y)}let Te=(lt-bt.x)*ct+(Et-bt.y)*At,Ge=(Ft-bt.x)*ct+(Jt-bt.y)*At;if(Te<=P+It||Ge<=P+It){let ut=.5*(w-B-Te);s.points[0].anchorAX=lt+ut*ct,s.points[0].anchorAY=Et+ut*At,s.points[0].separation=Te-D,s.points[0].id=ee(0,0),ut=.5*(w-B-Ge),s.points[1].anchorAX=Ft+ut*ct,s.points[1].anchorAY=Jt+ut*At,s.points[1].separation=Ge-D,s.points[1].id=ee(1,0),s.pointCount=2}}}if(s.pointCount===0){let N=S.x-_.x,Q=S.y-_.y,wt=N*N+Q*Q;if(wt>wn){let Jt=Math.sqrt(wt);N/=Jt,Q/=Jt}else N=-X,Q=R;let ct=_.x+B*N,At=_.y+B*Q,Tt=S.x-w*N,lt=S.y-w*Q,Et=I===0?0:1,Ft=C===0?0:1;s.normalX=N,s.normalY=Q,s.points[0].anchorAX=(ct+Tt)*.5,s.points[0].anchorAY=(At+lt)*.5,s.points[0].separation=Math.sqrt(A)-D,s.points[0].id=ee(Et,Ft),s.pointCount=1}if(s.pointCount>0){let N=e.q.c*s.normalX-e.q.s*s.normalY,Q=e.q.s*s.normalX+e.q.c*s.normalY;s.normalX=N,s.normalY=Q;for(let wt=0;wt<s.pointCount;++wt){let ct=s.points[wt],At=ct.anchorAX+r.x,Tt=ct.anchorAY+r.y,lt=e.q.c*At-e.q.s*Tt,Et=e.q.s*At+e.q.c*Tt;ct.anchorAX=lt,ct.anchorAY=Et,ct.anchorBX=ct.anchorAX+(e.p.x-n.p.x),ct.anchorBY=ct.anchorAY+(e.p.y-n.p.y),ct.pointX=e.p.x+ct.anchorAX,ct.pointY=e.p.y+ct.anchorAY}}}var ga=new _e;function di(t,e,o,n,s){return ga.center1=t.point1,ga.center2=t.point2,ga.radius=0,Qs(ga,e,o,n)}function bi(t,e,o,n,s){let r=gu(o.center1,o.center2,o.radius);return Zn(t,e,r,n,s)}function kh(t,e,o,n,s,r){let i,c,a,l,d,p;s?(i=e,l=t,c=n,a=n+1<e.count?n+1:0,d=o,p=o+1<t.count?o+1:0):(i=t,l=e,c=o,a=o+1<t.count?o+1:0,d=n,p=n+1<e.count?n+1:0);let b=i.normals[c],u=i.vertices[c],h=i.vertices[a],m=l.vertices[d],f=l.vertices[p],y=-1*b.y,I=1*b.x,C=0,_=h.x-u.x,S=h.y-u.y,A=_*y+S*I;_=m.x-u.x,S=m.y-u.y;let B=_*y+S*I;_=f.x-u.x,S=f.y-u.y;let w=_*y+S*I,D;w<C&&B-w>Xt?D=$t(f,m,(C-w)/(B-w)):D=f;let v;B>A&&B-w>Xt?v=$t(f,m,(A-w)/(B-w)):v=m;let P=Ma(D,u,b),T=Ma(v,u,b),R=i.radius,X=l.radius;wi(D,.5*(R-X-P),b,pt),wi(v,.5*(R-X-T),b,bt);let F=R+X;if(s===!1){r.normalX=b.x,r.normalY=b.y;let E=r.points[0];E.anchorAX=pt.x,E.anchorAY=pt.y,E.separation=P-F,E.id=ee(c,p),E=r.points[1],E.anchorAX=bt.x,E.anchorAY=bt.y,E.separation=T-F,E.id=ee(a,d),r.pointCount=2}else{r.normalX=-b.x,r.normalY=-b.y;let E=r.points[0];E.anchorAX=bt.x,E.anchorAY=bt.y,E.separation=T-F,E.id=ee(d,a),E=r.points[1],E.anchorAX=pt.x,E.anchorAY=pt.y,E.separation=P-F,E.id=ee(p,c),r.pointCount=2}return r}function Th(t,e){let o=t.count,n=e.count,s=t.normals,r=t.vertices,i=e.vertices,c=0,a=Number.NEGATIVE_INFINITY;for(let l=0;l<o;++l){let d=s[l],p=r[l].x,b=r[l].y,u=Number.POSITIVE_INFINITY;for(let h=0;h<n;++h){let m=i[h].x-p,f=i[h].y-b,y=d.x*m+d.y*f;y<u&&(u=y)}u>a&&(a=u,c=l)}return{edgeIndex:c,maxSeparation:a}}var kt=new ge(Ce),Ut=new ge(Ce),fu=new g,xu=new at;function Zn(t,e,o,n,s){let r=t.vertices[0].x,i=t.vertices[0].y;fu.x=e.p.x+(e.q.c*r-e.q.s*i),fu.y=e.p.y+(e.q.s*r+e.q.c*i),xu.p=fu,xu.q=e.q,Uo(xu,n,Dt),kt.centroid=null,kt.count=t.count,kt.radius=t.radius,kt.vertices[0].x=0,kt.vertices[0].y=0,kt.normals[0].x=t.normals[0].x,kt.normals[0].y=t.normals[0].y;for(let m=1;m<kt.count;++m){let f=kt.vertices[m];f.x=t.vertices[m].x-r,f.y=t.vertices[m].y-i;let y=kt.normals[m];y.x=t.normals[m].x,y.y=t.normals[m].y}kt.centroid=null,Ut.count=o.count,Ut.radius=o.radius;for(let m=0;m<Ut.count;++m){let f=Ut.vertices[m],y=o.vertices[m];f.x=Dt.q.c*y.x-Dt.q.s*y.y+Dt.p.x,f.y=Dt.q.s*y.x+Dt.q.c*y.y+Dt.p.y;let I=Ut.normals[m];I.x=Dt.q.c*o.normals[m].x-Dt.q.s*o.normals[m].y,I.y=Dt.q.s*o.normals[m].x+Dt.q.c*o.normals[m].y}let c=Th(kt,Ut),a=c.edgeIndex,l=c.maxSeparation,d=Th(Ut,kt),p=d.edgeIndex,b=d.maxSeparation,u=kt.radius+Ut.radius;if(l>Qt+u||b>Qt+u)return s.clear();let h;if(l>=b){h=!1;let m=kt.normals[a],f=Ut.count,y=Ut.normals;p=0;let I=Number.MAX_VALUE;for(let C=0;C<f;++C){let _=m.x*y[C].x+m.y*y[C].y;_<I&&(I=_,p=C)}}else{h=!0;let m=Ut.normals[p],f=kt.count,y=kt.normals;a=0;let I=Number.MAX_VALUE;for(let C=0;C<f;++C){let _=m.x*y[C].x+m.y*y[C].y;_<I&&(I=_,a=C)}}if(l>.1*It||b>.1*It){let m=a,f=a+1<kt.count?a+1:0,y=p,I=p+1<Ut.count?p+1:0,C=kt.vertices[m],_=kt.vertices[f],S=Ut.vertices[y],A=Ut.vertices[I],B=hr(C.x,C.y,_.x,_.y,S.x,S.y,A.x,A.y);if(B.fraction1===0&&B.fraction2===0){let w=S.x-C.x,D=S.y-C.y,v=Math.sqrt(B.distanceSquared);if(v>Qt+u)return s.clear();let P=1/v;w*=P,D*=P;let T=C.x+kt.radius*w,R=C.y+kt.radius*D,X=S.x-Ut.radius*w,F=S.y-Ut.radius*D;s.normalX=w,s.normalY=D;let E=s.points[0];E.anchorAX=(T+X)*.5,E.anchorAY=(R+F)*.5,E.separation=v-u,E.id=ee(m,y),s.pointCount=1}else if(B.fraction1===0&&B.fraction2===1){let w=A.x-C.x,D=A.y-C.y,v=Math.sqrt(B.distanceSquared);if(v>Qt+u)return s.clear();let P=1/v;w*=P,D*=P;let T=C.x+kt.radius*w,R=C.y+kt.radius*D,X=A.x-Ut.radius*w,F=A.y-Ut.radius*D;s.normalX=w,s.normalY=D;let E=new ko;E.anchorAX=(T+X)*.5,E.anchorAY=(R+F)*.5,E.separation=v-u,E.id=ee(m,I),s.points[0]=E,s.pointCount=1}else if(B.fraction1===1&&B.fraction2===0){let w=S.x-_.x,D=S.y-_.y,v=Math.sqrt(B.distanceSquared);if(v>Qt+u)return s.clear();let P=1/v;w*=P,D*=P;let T=_.x+kt.radius*w,R=_.y+kt.radius*D,X=S.x-Ut.radius*w,F=S.y-Ut.radius*D;s.normalX=w,s.normalY=D;let E=new ko;E.anchorAX=(T+X)*.5,E.anchorAY=(R+F)*.5,E.separation=v-u,E.id=ee(f,y),s.points[0]=E,s.pointCount=1}else if(B.fraction1===1&&B.fraction2===1){let w=A.x-_.x,D=A.y-_.y,v=Math.sqrt(B.distanceSquared);if(v>Qt+u)return s.clear();let P=1/v;w*=P,D*=P;let T=_.x+kt.radius*w,R=_.y+kt.radius*D,X=A.x-Ut.radius*w,F=A.y-Ut.radius*D;s.normalX=w,s.normalY=D;let E=new ko;E.anchorAX=(T+X)*.5,E.anchorAY=(R+F)*.5,E.separation=v-u,E.id=ee(f,I),s.points[0]=E,s.pointCount=1}else kh(kt,Ut,a,p,h,s)}else kh(kt,Ut,a,p,h,s);if(s.pointCount>0){let m=s.normalX;s.normalX=e.q.c*s.normalX-e.q.s*s.normalY,s.normalY=e.q.s*m+e.q.c*s.normalY;for(let f=0;f<s.pointCount;++f){let y=s.points[f],I=y.anchorAX+r,C=y.anchorAY+i;y.anchorAX=e.q.c*I-e.q.s*C,y.anchorAY=e.q.s*I+e.q.c*C,y.anchorBX=y.anchorAX+(e.p.x-n.p.x),y.anchorBY=y.anchorAY+(e.p.y-n.p.y),y.pointX=e.p.x+y.anchorAX,y.pointY=e.p.y+y.anchorAY}}return s}function pi(t,e,o,n,s){let r=new _e;return r.center1=t.point1,r.center2=t.point2,r.radius=0,$s(r,e,o,n,s)}function ui(t,e,o,n,s){let r=gu(t.point1,t.point2,0);return Zn(r,e,o,n,s)}function hi(t,e,o,n,s){Uo(e,n,Dt);let r=H(Dt,o.center),i=t.segment.point1,c=t.segment.point2,a=J(c,i);if(j(de(a),J(r,i))<0)return s.clear();let d=j(a,J(c,r)),p=j(a,J(r,i)),b;if(p<=0){let A=J(i,t.ghost1);if(j(A,J(r,i))<=0)return s.clear();b=i}else if(d<=0){let A=J(t.ghost2,c);if(j(A,J(r,c))>0)return s.clear();b=c}else{let A=j(a,a);b=new g(d*i.x+p*c.x,d*i.y+p*c.y),b=A>0?it(1/A,b):i}let u=Ye(J(r,b)),h=u.length,m=u.normal,f=o.radius,y=h-f;if(y>Qt)return s.clear();let I=b,C=$(r,-f,m),_=$t(I,C,.5);s.normalX=e.q.c*m.x-e.q.s*m.y,s.normalY=e.q.s*m.x+e.q.c*m.y;let S=s.points[0];return S.anchorAX=e.q.c*_.x-e.q.s*_.y,S.anchorAY=e.q.s*_.x+e.q.c*_.y,S.anchorBX=S.anchorAX+(e.p.x-n.p.x),S.anchorBY=S.anchorAY+(e.p.y-n.p.y),S.pointX=e.p.x+S.anchorAX,S.pointY=e.p.y+S.anchorAY,S.separation=y,S.id=0,s.pointCount=1,s}function mi(t,e,o,n,s,r){let i=gu(o.center1,o.center2,o.radius);return Zs(t,e,i,n,s,r)}function Iu(t,e,o,n,s,r,i,c,a,l){let d=le(s),p=0,b=j(J(e,t),d),u=j(J(o,t),d),h=j(J(n,t),d);if(u<p||b<h)return l.clear();let m;h<p&&u-h>Xt?m=$t(n,o,(p-h)/(u-h)):m=n;let f;u>b&&u-h>Xt?f=$t(n,o,(b-h)/(u-h)):f=o;let y=j(J(m,t),s),I=j(J(f,t),s);m=$(m,.5*(r-i-y),s),f=$(f,.5*(r-i-I),s);let C=r+i;l.normalX=s.x,l.normalY=s.y;let _=l.points[0];_.anchorAX=m.x,_.anchorAY=m.y,_.separation=y-C,_.id=c;let S=l.points[1];return S.anchorAX=f.x,S.anchorAY=f.y,S.separation=I-C,S.id=a,l.pointCount=2,l}var ro={b2_normalSkip:0,b2_normalAdmit:1,b2_normalSnap:2};function Su(t,e){return j(e,t.edge1)<=0?t.convex1?z(e,t.normal0)>.01?ro.b2_normalSkip:ro.b2_normalAdmit:ro.b2_normalSnap:t.convex2?z(t.normal2,e)>.01?ro.b2_normalSkip:ro.b2_normalAdmit:ro.b2_normalSnap}var _u=class{constructor(){this.edge1=new g,this.normal0=new g,this.normal2=new g,this.convex1=!1,this.convex2=!1}};function Zs(t,e,o,n,s,r){Uo(e,n,Dt);let i=H(Dt,o.centroid),c=o.radius,a=t.segment.point1,l=t.segment.point2,d=dt(J(l,a)),p=new _u;p.edge1=d.clone();let b=.01,u=dt(J(a,t.ghost1));p.normal0=de(u),p.convex1=z(u,d)>=b;let h=dt(J(t.ghost2,l));p.normal2=de(h),p.convex2=z(d,h)>=b;let m=de(d),f=j(m,J(i,a))<0,y=!0,I=!0;if(p.convex1&&(y=j(p.normal0,J(i,a))<0),p.convex2&&(I=j(p.normal2,J(i,l))<0),f&&y&&I)return r.clear();let C=o.count,_=[],S=[];for(let W=0;W<C;++W)_[W]=H(Dt,o.vertices[W]),S[W]=K(Dt.q,o.normals[W]);let A=new ue;A.proxyA=vt([t.segment.point1,t.segment.point2],2,0),A.proxyB=vt(_,C,0),A.transformA=new at(new g(0,0),new rt(1,0)),A.transformB=new at(new g(0,0),new rt(1,0)),A.useRadii=!1;let B=Be(s,A,null,0);if(B.distance>c+Qt)return r.clear();let w=p.convex1?p.normal0:m,D=p.convex2?p.normal2:m,v=-1,P=-1;if(f==!1&&B.distance>.1*It)if(s.count==1){let W=B.pointA,et=B.pointB,st=dt(J(et,W)),ot=Su(p,st);if(ot==ro.b2_normalSkip)return r.clear();if(ot==ro.b2_normalAdmit){r.normalX=e.q.c*st.x-e.q.s*st.y,r.normalY=e.q.s*st.x+e.q.c*st.y;let L=new ko;return L.anchorAX=e.q.c*W.x-e.q.s*W.y,L.anchorAY=e.q.s*W.x+e.q.c*W.y,L.anchorBX=L.anchorAX+(e.p.x-n.p.x),L.anchorBY=L.anchorAY+(e.p.y-n.p.y),L.pointX=e.p.x+L.anchorAX,L.pointY=e.p.y+L.anchorAY,L.separation=B.distance-c,L.id=ee(s.indexA[0],s.indexB[0]),r.points[0]=L,r.pointCount=1,r}v=s.indexB[0]}else{let W=s.indexA[0],et=s.indexA[1],st=s.indexB[0],ot=s.indexB[1];if(W==et){let L=J(B.pointA,B.pointB),nt=j(L,S[st]),Ct=j(L,S[ot]),N=nt>Ct?st:ot;L=S[N];let Q=Su(p,Ht(L));if(Q==ro.b2_normalSkip)return r.clear();if(Q==ro.b2_normalAdmit){st=N,ot=N<C-1?N+1:0;let wt=_[st],ct=_[ot];if(nt=j(L,J(a,wt)),Ct=j(L,J(l,wt)),nt<Ct){if(j(w,L)<j(m,L))return r.clear()}else if(j(D,L)<j(m,L))return r.clear();Iu(wt,ct,a,l,L,c,0,ee(st,1),ee(ot,0),r),r.normalX=e.q.c*-L.x-e.q.s*-L.y,r.normalY=e.q.s*-L.x+e.q.c*-L.y,r.points[0].anchorAX=e.q.c*r.points[0].anchorAX-e.q.s*r.points[0].anchorAY,r.points[0].anchorAY=e.q.s*r.points[0].anchorAX+e.q.c*r.points[0].anchorAY,r.points[1].anchorAX=e.q.c*r.points[1].anchorAX-e.q.s*r.points[1].anchorAY,r.points[1].anchorAY=e.q.s*r.points[1].anchorAX+e.q.c*r.points[1].anchorAY;let At=J(e.p,n.p);return r.points[0].anchorBX=r.points[0].anchorAX+At.x,r.points[0].anchorBY=r.points[0].anchorAY+At.y,r.points[1].anchorBX=r.points[1].anchorAX+At.x,r.points[1].anchorBY=r.points[1].anchorAY+At.y,r.points[0].pointX=e.p.x+r.points[0].anchorAX,r.points[0].pointY=e.p.y+r.points[0].anchorAY,r.points[1].pointX=e.p.x+r.points[1].anchorAX,r.points[1].pointY=e.p.y+r.points[1].anchorAY,r}P=N}else{let L=j(m,J(_[st],a)),nt=j(m,J(_[ot],l));v=L<nt?st:ot}}else{let W=Number.MAX_VALUE;for(let ot=0;ot<C;++ot){let L=j(m,J(_[ot],a));L<W&&(W=L,v=ot)}if(p.convex1){let ot=Number.MAX_VALUE;for(let L=0;L<C;++L){let nt=j(p.normal0,J(_[L],a));nt<ot&&(ot=nt)}ot>W&&(W=ot,v=-1)}if(p.convex2){let ot=Number.MAX_VALUE;for(let L=0;L<C;++L){let nt=j(p.normal2,J(_[L],l));nt<ot&&(ot=nt)}ot>W&&(W=ot,v=-1)}let et=-Number.MAX_VALUE,st=-1;for(let ot=0;ot<C;++ot){let L=S[ot];if(Su(p,Ht(L))!=ro.b2_normalAdmit)continue;let Ct=_[ot],N=Math.min(j(L,J(l,Ct)),j(L,J(a,Ct)));N>et&&(et=N,st=ot)}if(et>W){let ot=st,L=ot<C-1?ot+1:0,nt=_[ot],Ct=_[L],N=S[ot],Q=j(N,J(a,nt)),wt=j(N,J(l,nt));if(Q<wt){if(j(w,N)<j(m,N))return r.clear()}else if(j(D,N)<j(m,N))return r.clear(0);Iu(nt,Ct,a,l,S[ot],c,0,ee(ot,1),ee(L,0),r),r.normalX=e.q.c*-S[ot].x-e.q.s*-S[ot].y,r.normalY=e.q.s*-S[ot].x+e.q.c*-S[ot].y,r.points[0].anchorAX=e.q.c*r.points[0].anchorAX-e.q.s*r.points[0].anchorAY,r.points[0].anchorAY=e.q.s*r.points[0].anchorAX+e.q.c*r.points[0].anchorAY,r.points[1].anchorAX=e.q.c*r.points[1].anchorAX-e.q.s*r.points[1].anchorAY,r.points[1].anchorAY=e.q.s*r.points[1].anchorAX+e.q.c*r.points[1].anchorAY;let ct=J(e.p,n.p);return r.points[0].anchorBX=r.points[0].anchorAX+ct.x,r.points[0].anchorBY=r.points[0].anchorAY+ct.y,r.points[1].anchorBX=r.points[1].anchorAX+ct.x,r.points[1].anchorBY=r.points[1].anchorAY+ct.y,r.points[0].pointX=e.p.x+r.points[0].anchorAX,r.points[0].pointY=e.p.y+r.points[0].anchorAY,r.points[1].pointX=e.p.x+r.points[1].anchorAX,r.points[1].pointY=e.p.y+r.points[1].anchorAY,r}if(v==-1)return r.clear()}let T,R,X,F;if(P!=-1)X=P,F=X<C-1?X+1:0,T=_[X],R=_[F];else{let W=v,et=W>0?W-1:C-1,st=j(m,S[et]),ot=j(m,S[W]);st<ot?(X=et,F=W,T=_[X],R=_[F]):(X=W,F=W<C-1?W+1:0,T=_[X],R=_[F])}Iu(a,l,T,R,m,0,c,ee(0,F),ee(1,X),r),r.normalX=e.q.c*r.normalX-e.q.s*r.normalY,r.normalY=e.q.s*r.normalX+e.q.c*r.normalY,r.points[0].anchorAX=e.q.c*r.points[0].anchorAX-e.q.s*r.points[0].anchorAY,r.points[0].anchorAY=e.q.s*r.points[0].anchorAX+e.q.c*r.points[0].anchorAY,r.points[1].anchorAX=e.q.c*r.points[1].anchorAX-e.q.s*r.points[1].anchorAY,r.points[1].anchorAY=e.q.s*r.points[1].anchorAX+e.q.c*r.points[1].anchorAY;let E=J(e.p,n.p);return r.points[0].anchorBX=r.points[0].anchorAX+E.x,r.points[0].anchorBY=r.points[0].anchorAY+E.y,r.points[1].anchorBX=r.points[1].anchorAX+E.x,r.points[1].anchorBY=r.points[1].anchorAY+E.y,r.points[0].pointX=e.p.x+r.points[0].anchorAX,r.points[0].pointY=e.p.y+r.points[0].anchorAY,r.points[1].pointX=e.p.x+r.points[1].anchorAX,r.points[1].pointY=e.p.y+r.points[1].anchorAY,r}var mt={b2_contactTouchingFlag:1,b2_contactHitEventFlag:2,b2_contactSensorFlag:4,b2_contactSensorTouchingFlag:8,b2_contactEnableSensorEvents:16,b2_contactEnableContactEvents:32},yi=class{constructor(){this.bodyId=0,this.prevKey=0,this.nextKey=0}},tr=class{constructor(){this.setIndex=0,this.colorIndex=0,this.localIndex=0,this.edges=[new yi,new yi],this.shapeIdA=0,this.shapeIdB=0,this.islandPrev=0,this.islandNext=0,this.islandId=x,this.contactId=x,this.flags=0,this.isMarked=!1}},Qn=class{constructor(e=new To){this.contactId=0,this._bodyIdA=x,this._bodyIdB=x,this.bodySimIndexA=0,this.bodySimIndexB=0,this.shapeIdA=0,this.shapeIdB=0,this.invMassA=0,this.invIA=0,this.invMassB=0,this.invIB=0,this.manifold=e,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.simFlags=0,this.cache=new ye}set(e){this.contactId=e.contactId,this._bodyIdA=e._bodyIdA,this._bodyIdB=e._bodyIdB,this.bodySimIndexA=e.bodySimIndexA,this.bodySimIndexB=e.bodySimIndexB,this.shapeIdA=e.shapeIdA,this.shapeIdB=e.shapeIdB,this.invMassA=e.invMassA,this.invIA=e.invIA,this.invMassB=e.invMassB,this.invIB=e.invIB,e.manifold.copyTo(this.manifold),this.friction=e.friction,this.restitution=e.restitution,this.tangentSpeed=e.tangentSpeed,this.simFlags=e.simFlags,this.cache=e.cache.clone()}};function Ym(t,e){return Math.sqrt(t*e)}function Nm(t,e){return Math.max(t,e)}var Au=class{constructor(e=null,o=!1){this.fcn=e,this.primary=o}},Bn=Array(Y.b2_shapeTypeCount).fill().map(()=>Array(Y.b2_shapeTypeCount).fill().map(()=>new Au)),Gh=!1;function Wm(t,e,o,n,s,r){return ci(t.circle,e,o.circle,n,r)}function Om(t,e,o,n,s,r){return $s(t.capsule,e,o.circle,n,r)}function Um(t,e,o,n,s,r){return Qs(t.capsule,e,o.capsule,n,r)}function zm(t,e,o,n,s,r){return li(t.polygon,e,o.circle,n,r)}function Km(t,e,o,n,s,r){return bi(t.polygon,e,o.capsule,n,r)}function Hm(t,e,o,n,s,r){return Zn(t.polygon,e,o.polygon,n,r)}function $m(t,e,o,n,s,r){return pi(t.segment,e,o.circle,n,r)}function Qm(t,e,o,n,s,r){return di(t.segment,e,o.capsule,n,r)}function Zm(t,e,o,n,s,r){return ui(t.segment,e,o.polygon,n,r)}function ty(t,e,o,n,s,r){return hi(t.chainSegment,e,o.circle,n,r)}function ey(t,e,o,n,s,r){return mi(t.chainSegment,e,o.capsule,n,s,r)}function oy(t,e,o,n,s,r){return Zs(t.chainSegment,e,o.polygon,n,s,r)}function Ve(t,e,o){Bn[e][o].fcn=t,Bn[e][o].primary=!0,e!=o&&(Bn[o][e].fcn=t,Bn[o][e].primary=!1)}function Cu(){Gh===!1&&(Ve(Wm,Y.b2_circleShape,Y.b2_circleShape),Ve(Om,Y.b2_capsuleShape,Y.b2_circleShape),Ve(Um,Y.b2_capsuleShape,Y.b2_capsuleShape),Ve(zm,Y.b2_polygonShape,Y.b2_circleShape),Ve(Km,Y.b2_polygonShape,Y.b2_capsuleShape),Ve(Hm,Y.b2_polygonShape,Y.b2_polygonShape),Ve($m,Y.b2_segmentShape,Y.b2_circleShape),Ve(Qm,Y.b2_segmentShape,Y.b2_capsuleShape),Ve(Zm,Y.b2_segmentShape,Y.b2_polygonShape),Ve(ty,Y.b2_chainSegmentShape,Y.b2_circleShape),Ve(ey,Y.b2_chainSegmentShape,Y.b2_capsuleShape),Ve(oy,Y.b2_chainSegmentShape,Y.b2_polygonShape),Gh=!0)}function Ba(t,e,o){let n=e.type,s=o.type;if(Bn[n][s].fcn===null)return;if(Bn[n][s].primary===!1){Ba(t,o,e);return}let r=_t(t,e.bodyId),i=_t(t,o.bodyId),c;r.setIndex===M.b2_awakeSet||i.setIndex===M.b2_awakeSet?c=M.b2_awakeSet:c=M.b2_disabledSet;let a=t.solverSetArray[c],l=ne(t.contactIdPool);for(;t.contactArray.length<=l;)t.contactArray.push(new tr);let d=e.id,p=o.id,b=t.contactArray[l];b.contactId=l,b.setIndex=c,b.colorIndex=x,b.localIndex=a.contacts.count,b.islandId=x,b.islandPrev=x,b.islandNext=x,b.shapeIdA=d,b.shapeIdB=p,b.isMarked=!1,b.flags=0,(e.isSensor||o.isSensor)&&(b.flags|=mt.b2_contactSensorFlag),(e.enableSensorEvents||o.enableSensorEvents)&&(b.flags|=mt.b2_contactEnableSensorEvents),(e.enableContactEvents||o.enableContactEvents)&&(b.flags|=mt.b2_contactEnableContactEvents);{b.edges[0].bodyId=e.bodyId,b.edges[0].prevKey=x,b.edges[0].nextKey=r.headContactKey;let m=l<<1|0,f=r.headContactKey;if(f!==x){let y=t.contactArray[f>>1];y.edges[f&1].prevKey=m}r.headContactKey=m,r.contactCount+=1}{b.edges[1].bodyId=o.bodyId,b.edges[1].prevKey=x,b.edges[1].nextKey=i.headContactKey;let m=l<<1|1,f=i.headContactKey;if(i.headContactKey!==x){let y=t.contactArray[f>>1];y.edges[f&1].prevKey=m}i.headContactKey=m,i.contactCount+=1}let u=cr(d,p);ir(t.broadPhase.pairSet,u);let h=Xe(a.contacts);h.contactId=l,h._bodyIdA=e.bodyId,h._bodyIdB=o.bodyId,h.bodySimIndexA=x,h.bodySimIndexB=x,h.invMassA=0,h.invIA=0,h.invMassB=0,h.invIB=0,h.shapeIdA=d,h.shapeIdB=p,h.friction=Ym(e.friction,o.friction),h.restitution=Nm(e.restitution,o.restitution),h.tangentSpeed=0,h.simFlags=0,(e.enablePreSolveEvents||o.enablePreSolveEvents)&&(h.simFlags|=Nt.b2_simEnablePreSolveEvents)}function fo(t,e,o){let n=cr(e.shapeIdA,e.shapeIdB);ar(t.broadPhase.pairSet,n);let s=e.edges[0],r=e.edges[1],i=s.bodyId,c=r.bodyId,a=_t(t,i),l=_t(t,c),d=e.flags;if(d&(mt.b2_contactTouchingFlag|mt.b2_contactSensorTouchingFlag)&&d&(mt.b2_contactEnableContactEvents|mt.b2_contactEnableSensorEvents)){let h=t.worldId,m=t.shapeArray[e.shapeIdA],f=t.shapeArray[e.shapeIdB],y=new St(m.id+1,h,m.revision),I=new St(f.id+1,h,f.revision);if(d&mt.b2_contactTouchingFlag&&d&mt.b2_contactEnableContactEvents){let C=new Rn(y,I);t.contactEndArray.push(C)}if(d&mt.b2_contactSensorTouchingFlag&&d&mt.b2_contactEnableSensorEvents){let C=new Tn;m.isSensor?(C.sensorShapeId=y,C.visitorShapeId=I):(C.sensorShapeId=I,C.visitorShapeId=y),t.sensorEndEventArray.push(C)}}if(s.prevKey!==x){let m=t.contactArray[s.prevKey>>1].edges[s.prevKey&1];m.nextKey=s.nextKey}if(s.nextKey!==x){let m=t.contactArray[s.nextKey>>1].edges[s.nextKey&1];m.prevKey=s.prevKey}let p=e.contactId,b=p<<1|0;if(a.headContactKey===b&&(a.headContactKey=s.nextKey),a.contactCount-=1,r.prevKey!==x){let m=t.contactArray[r.prevKey>>1].edges[r.prevKey&1];m.nextKey=r.nextKey}if(r.nextKey!==x){let m=t.contactArray[r.nextKey>>1].edges[r.nextKey&1];m.prevKey=r.prevKey}let u=p<<1|1;if(l.headContactKey===u&&(l.headContactKey=r.nextKey),l.contactCount-=1,e.islandId!==x&&ri(t,e),e.colorIndex!==x)kr(t,i,c,e.colorIndex,e.localIndex);else{let h=t.solverSetArray[e.setIndex];if(no(h.contacts,e.localIndex)!==x){let f=h.contacts.data[e.localIndex];t.contactArray[f.contactId].localIndex=e.localIndex}}e.contactId=x,e.setIndex=x,e.colorIndex=x,e.localIndex=x,xe(t.contactIdPool,p),o&&(Ot(t,a),Ot(t,l))}function Yn(t,e){return e.setIndex===M.b2_awakeSet&&e.colorIndex!==x?t.constraintGraph.colors[e.colorIndex].contacts.data[e.localIndex]:t.solverSetArray[e.setIndex].contacts.data[e.localIndex]}function Kr(t,e){return t.groupIndex===e.groupIndex&&t.groupIndex!==0?t.groupIndex>0:(t.maskBits&e.categoryBits)!==0&&(t.categoryBits&e.maskBits)!==0}function ny(t,e,o,n,s){let r=new ue;return r.proxyA=$e(t),r.proxyB=$e(o),r.transformA=e,r.transformB=n,r.useRadii=!0,Be(s,r,null,0).distance<10*Xt}var Bu=new To;function wu(t,e,o,n,s,r,i,c){let a;if(o.isSensor||r.isSensor)a=ny(o,n,r,i,e.cache);else{e.manifold.copyTo(Bu);let l=Bn[o.type][r.type].fcn;l(o,n,r,i,e.cache,e.manifold);let d=e.manifold.pointCount;if(a=d>0,a&&t.preSolveFcn&&e.simFlags&Nt.b2_simEnablePreSolveEvents){let p=new St(o.id+1,t.worldId,o.revision),b=new St(r.id+1,t.worldId,r.revision);a=t.preSolveFcn(p,b,e.manifold,t.preSolveContext),a==!1&&(e.manifold.pointCount=0)}a&&(o.enableHitEvents||r.enableHitEvents)?e.simFlags|=Nt.b2_simEnableHitEvent:e.simFlags&=~Nt.b2_simEnableHitEvent;for(let p=0;p<d;++p){let b=e.manifold.points[p];b.anchorAX-=s.x,b.anchorAY-=s.y,b.anchorBX-=c.x,b.anchorBY-=c.y,b.normalImpulse=0,b.tangentImpulse=0,b.maxNormalImpulse=0,b.normalVelocity=0,b.persisted=!1;let u=b.id;for(let h=0,m=Bu.pointCount;h<m;++h){let f=Bu.points[h];if(f.id===u){b.normalImpulse=f.normalImpulse,b.tangentImpulse=f.tangentImpulse,b.persisted=!0;break}}}}return a?e.simFlags|=Nt.b2_simTouchingFlag:e.simFlags&=~Nt.b2_simTouchingFlag,a}function Jh(t,e,o,n,s){let r=Bn[t.type][o.type].fcn,i=new ye;return r(t,e,o,n,i,s)}var Nt={b2_simTouchingFlag:65536,b2_simDisjoint:131072,b2_simStartedTouching:262144,b2_simStoppedTouching:524288,b2_simEnableHitEvent:1048576,b2_simEnablePreSolveEvents:2097152};var fi=class{constructor(){this.trees=new Array(tt.b2_bodyTypeCount).fill().map(()=>new hn),this.moveSet=null,this.moveArray=null,this.moveResults=null,this.movePairs=null,this.movePairCapacity=0,this.movePairIndex=0,this.pairSet=null}},qo=t=>t&3,xn=t=>t>>2,Du=(t,e)=>t<<2|e;function In(t,e){ir(t.moveSet,e+1)||t.moveArray.push(e)}function Pu(t){t.moveSet=Gi(),t.moveArray=[],t.moveResults=null,t.movePairs=null,t.movePairCapacity=0,t.movePairIndex=0,t.pairSet=Gi();for(let e=0;e<tt.b2_bodyTypeCount;++e)t.trees[e]=Er()}function ku(t){for(let e=0;e<tt.b2_bodyTypeCount;++e)jr(t.trees[e]);Ri(t.moveSet),t.moveArray=null,Ri(t.pairSet),Object.keys(t).forEach(e=>delete t[e])}function sy(t,e){if(ar(t.moveSet,e+1)){let n=t.moveArray.length;for(let s=0;s<n;++s)if(t.moveArray[s]===e){t.moveArray[s]=t.moveArray[n-1],t.moveArray.pop();break}}}function Ui(t,e,o,n,s,r){let i=Fr(t.trees[e],o,n,s),c=Du(i,e);return(e!==tt.b2_staticBody||r)&&In(t,c),c}function zi(t,e){sy(t,e);let o=qo(e),n=xn(e);Xr(t.trees[o],n)}function Dr(t,e,o){let n=qo(e),s=xn(e);qr(t.trees[n],s,o),In(t,e)}function xl(t,e,o){let n=qo(e),s=xn(e);un(t.trees[n],s,o),In(t,e)}var vu=class{constructor(){this.shapeIndexA=0,this.shapeIndexB=0,this.next=null}},Ju=class{constructor(){this.pairList=null}},Mu=class{constructor(){this.world=null,this.moveResult=null,this.queryTreeType=0,this.queryProxyKey=0,this.queryShapeIndex=0}};function rl(t,e,o){let n=o,s=n.world.broadPhase,r=Du(t,n.queryTreeType);if(r===n.queryProxyKey||n.queryTreeType!==tt.b2_staticBody&&r<n.queryProxyKey&&Li(s.moveSet,r+1))return!0;let i=cr(e,n.queryShapeIndex);if(Li(s.pairSet,i))return!0;let c,a;r<n.queryProxyKey?(c=e,a=n.queryShapeIndex):(c=n.queryShapeIndex,a=e);let l=n.world,d=l.shapeArray[c],p=l.shapeArray[a],b=d.bodyId,u=p.bodyId;if(b===u||!Kr(d.filter,p.filter)||d.isSensor&&p.isSensor)return!0;let h=_t(l,b),m=_t(l,u);if(!zr(l,h,m))return!0;let f=n.world.customFilterFcn;if(f){let C=new St(c+1,l.worldId,d.revision),_=new St(a+1,l.worldId,p.revision);if(!f(C,_,n.world.customFilterContext))return!0}let y=s.movePairIndex++,I;return y<s.movePairCapacity?I=s.movePairs[y]:I=new vu,I.shapeIndexA=c,I.shapeIndexB=a,I.next=n.moveResult.pairList,n.moveResult.pairList=I,!0}function Tu(t){let e=t.broadPhase,o=e.moveArray.length;if(o===0)return;let n=t.stackAllocator;e.moveResults=ze(n,o,"move results",()=>new Ju),ry(0,o,t);let s=t.shapeArray;for(let r of e.moveResults)for(let i=r.pairList;i;i=i.next)Ba(t,s[i.shapeIndexA],s[i.shapeIndexB]);e.moveArray.length=0,Ea(e.moveSet),Ke(n,e.moveResults),e.moveResults=null,Lt(t)}function ry(t,e,o){let n=o.broadPhase,s=new Mu;s.world=o;for(let r=t;r<e;++r){let i=n.moveArray[r];if(i===x)continue;let c=qo(i),a=xn(i);s.queryProxyKey=i;let l=n.trees[c],d=l.nodes[a].aabb;s.queryShapeIndex=wh(l,a);let p=n.moveResults[r];p.pairList=null,s.moveResult=p,c===tt.b2_dynamicBody&&(Rh(n,d,s,tt.b2_kinematicBody),Rh(n,d,s,tt.b2_staticBody)),s.queryTreeType=tt.b2_dynamicBody,oa(n.trees[tt.b2_dynamicBody],d,s)}}function Rh(t,e,o,n){o.queryTreeType=n,oa(t.trees[n],e,o)}function Gu(t){Rs(t.trees[tt.b2_dynamicBody]),Rs(t.trees[tt.b2_kinematicBody])}var er=32,M={b2_staticSet:0,b2_disabledSet:1,b2_awakeSet:2,b2_firstSleepingSet:3},xi=class{stackAllocator=new ds;broadPhase=new fi;constraintGraph=new Ts;bodyArray=[];solverSetArray=[];jointArray=[];contactArray=[];islandArray=[];shapeArray=[];chainArray=[];taskContextArray=[];bodyMoveEventArray=[];sensorBeginEventArray=[];sensorEndEventArray=[];contactBeginArray=[];contactEndArray=[];contactHitArray=[];debugBodySet=new ke;debugJointSet=new ke;debugContactSet=new ke;stepIndex=0;splitIslandId=0;gravity=new g(0,0);hitEventThreshold=0;restitutionThreshold=0;maxLinearVelocity=0;contactPushoutVelocity=0;contactHertz=0;contactDampingRatio=0;jointHertz=0;jointDampingRatio=0;revision=0;preSolveFcn=null;preSolveContext=null;customFilterFcn=null;customFilterContext=null;workerCount=0;userTaskContext=null;userTreeTask=null;inv_h=0;worldId=new Jo;enableSleep=!0;locked=!1;enableWarmStarting=!1;enableContinuous=!1;inUse=!1},Ii=class{constructor(){this.world=null,this.fcn=null,this.filter=null,this.proxy=null,this.transform=null,this.userContext=null}},es=class{constructor(){this.world=null,this.fcn=null,this.filter=null,this.fraction=0,this.userContext=null}},Fu=class{constructor(){this.contactStateBitSet=new ke,this.enlargedSimBitSet=new ke,this.awakeIslandBitSet=new ke,this.splitSleepTime=0,this.splitIslandId=x}};function gt(t){return Ae[t.index1-1]}function O(t){return Ae[t]}function ft(t){let e=Ae[t];return e.locked?null:e}var Ae=null;function Si(){if(Ae==null){Ae=[];for(let t=0;t<er;t++)Ae[t]=new xi,Ae[t].inUse=!1}}function _i(t){let e=x;for(let r=0;r<Ae.length;++r)if(Ae[r].inUse===!1){e=r;break}if(e===x)return new Jo(0,0);Cu();let o=Ae[e],n=o.revision;o.worldId=e,o.revision=n,o.inUse=!0,o.stackAllocator=Fa(),Pu(o.broadPhase),o.constraintGraph=Vc(o.constraintGraph,16),o.bodyIdPool=Ro("body"),o.bodyArray=[],o.solverSetArray=[],o.solverSetIdPool=Ro("solverSet");let s;s=new so,s.setIndex=ne(o.solverSetIdPool),o.solverSetArray.push(s),s=new so,s.setIndex=ne(o.solverSetIdPool),o.solverSetArray.push(s),s=new so,s.setIndex=ne(o.solverSetIdPool),o.solverSetArray.push(s),o.shapeIdPool=Ro("shapeId"),o.shapeArray=[],o.chainIdPool=Ro("chainId"),o.chainArray=[],o.contactIdPool=Ro("contactId"),o.contactArray=[];for(let r=0;r<4096;r++)o.contactArray.push(new tr);o.jointIdPool=Ro("jointId"),o.jointArray=[],o.islandIdPool=Ro("islandId"),o.islandArray=[],o.bodyMoveEventArray=[],o.sensorBeginEventArray=[],o.sensorEndEventArray=[],o.contactBeginArray=[],o.contactEndArray=[],o.contactHitArray=[],o.stepIndex=0,o.splitIslandId=x,o.gravity=t.gravity,o.hitEventThreshold=t.hitEventThreshold,o.restitutionThreshold=t.restitutionThreshold,o.maxLinearVelocity=t.maximumLinearVelocity,o.contactPushoutVelocity=t.contactPushoutVelocity,o.contactHertz=t.contactHertz,o.contactDampingRatio=t.contactDampingRatio,o.jointHertz=t.jointHertz,o.jointDampingRatio=t.jointDampingRatio,o.enableSleep=t.enableSleep,o.locked=!1,o.enableWarmStarting=!0,o.enableContinuous=t.enableContinuous,o.userTreeTask=null,o.workerCount=1,o.userTaskContext=null,o.taskContextArray=[];for(let r=0;r<o.workerCount;++r){let i=new Fu;i.contactStateBitSet=Qe(1024),i.enlargedSimBitSet=Qe(256),i.awakeIslandBitSet=Qe(256),o.taskContextArray[r]=i}return o.debugBodySet=Qe(256),o.debugJointSet=Qe(256),o.debugContactSet=Qe(256),new Jo(e+1,o.revision)}function Yu(t){let e=gt(t);Ze(e.debugBodySet),Ze(e.debugJointSet),Ze(e.debugContactSet);for(let r=0;r<e.workerCount;++r)Ze(e.taskContextArray[r].contactStateBitSet),Ze(e.taskContextArray[r].enlargedSimBitSet),Ze(e.taskContextArray[r].awakeIslandBitSet);e.taskContextArray=null,e.bodyMoveEventArray=null,e.sensorBeginEventArray=null,e.sensorEndEventArray=null,e.contactBeginArray=null,e.contactEndArray=null,e.contactHitArray=null;let o=e.chainArray.length;for(let r=0;r<o;++r){let i=e.chainArray[r];i.id!==x&&(i.shapeIndices=null)}e.bodyArray=null,e.shapeArray=null,e.chainArray=null,e.contactArray=null,e.jointArray=null,e.islandArray=null;let n=e.solverSetArray.length;for(let r=0;r<n;++r)e.solverSetArray[r].setIndex!==x&&Wn(e,r);e.solverSetArray=null,Yc(e.constraintGraph),ku(e.broadPhase),Lo(e.bodyIdPool),Lo(e.shapeIdPool),Lo(e.chainIdPool),Lo(e.contactIdPool),Lo(e.jointIdPool),Lo(e.islandIdPool),Lo(e.solverSetIdPool),Xa(e.stackAllocator);let s=e.revision;e=new xi,e.worldId=x,e.revision=s+1}var Ru=new g,Lu=new g;function iy(t,e,o,n){let s=n,r=s.world,i=r.taskContextArray[o],c=s.contacts,a=r.shapeArray,l=r.bodyArray;for(let d=t;d<e;++d){let p=c[d],b=p.contactId,u=a[p.shapeIdA],h=a[p.shapeIdB];if(!pn(u.fatAABB,h.fatAABB))p.simFlags|=Nt.b2_simDisjoint,p.simFlags&=~Nt.b2_simTouchingFlag,eo(i.contactStateBitSet,b);else{let f=(p.simFlags&Nt.b2_simTouchingFlag)!==0,y=l[u.bodyId],I=l[h.bodyId],C=jt(r,y),_=jt(r,I);p.bodySimIndexA=y.setIndex===M.b2_awakeSet?y.localIndex:x,p.invMassA=C.invMass,p.invIA=C.invInertia,p.bodySimIndexB=I.setIndex===M.b2_awakeSet?I.localIndex:x,p.invMassB=_.invMass,p.invIB=_.invInertia;let S=C.transform,A=_.transform;Ru.x=S.q.c*C.localCenter.x-S.q.s*C.localCenter.y,Ru.y=S.q.s*C.localCenter.x+S.q.c*C.localCenter.y,Lu.x=A.q.c*_.localCenter.x-A.q.s*_.localCenter.y,Lu.y=A.q.s*_.localCenter.x+A.q.c*_.localCenter.y;let B=wu(r,p,u,S,Ru,h,A,Lu);B&&!f?(p.simFlags|=Nt.b2_simStartedTouching,eo(i.contactStateBitSet,b)):!B&&f&&(p.simFlags|=Nt.b2_simStoppedTouching,eo(i.contactStateBitSet,b))}}}function ay(t,e,o){let n=t.solverSetArray[M.b2_awakeSet];e.colorIndex=x,e.localIndex=n.contacts.count,Xe(n.contacts).set(o)}function cy(t,e,o){let n=t.solverSetArray[e];if(no(n.contacts,o)!==x){let r=n.contacts.data[o],i=t.contactArray[r.contactId];i.localIndex=o}}function ly(t){let e=t.world;Gu(e.broadPhase);let o=0,n=e.constraintGraph.colors;for(let u=0;u<te;++u)o+=n[u].contacts.count;let s=e.solverSetArray[M.b2_awakeSet].contacts.count;if(o+=s,o==0)return;let r=[],i=0;for(let u=0;u<te;++u){let h=n[u],m=h.contacts.count,f=h.contacts.data;for(let y=0;y<m;++y)r.push(f[y]),i+=1}{let u=e.solverSetArray[M.b2_awakeSet].contacts.data;for(let h=0;h<s;++h)r.push(u[h]),i+=1}t.contacts=r;let c=fs(e.contactIdPool);for(let u=0;u<e.workerCount;++u)e.taskContextArray[u].contactStateBitSet=to(e.taskContextArray[u].contactStateBitSet,c);iy(0,o,0,t),t.contacts=null;let a=e.taskContextArray[0].contactStateBitSet;for(let u=1;u<e.workerCount;++u)ks(a,e.taskContextArray[u].contactStateBitSet);let l=e.contactArray,d=e.solverSetArray[M.b2_awakeSet],p=e.shapeArray,b=e.worldId;for(let u=0;u<a.blockCount;++u){let h=a.bits[u];for(;h!=0n;){let m=Vr(h),f=64*u+m,y=l[f],I=y.colorIndex,C=y.localIndex,_;I!=x?_=n[I].contacts.data[C]:_=d.contacts.data[C];let S=p[y.shapeIdA],A=p[y.shapeIdB],B=new St(S.id+1,b,S.revision),w=new St(A.id+1,b,A.revision),D=y.flags,v=_.simFlags;if(v&Nt.b2_simDisjoint){if(D&mt.b2_contactTouchingFlag&&D&mt.b2_contactEnableContactEvents){let P=new Rn;P.shapeIdA=B,P.shapeIdB=w,e.contactEndArray.push(P)}y.flags&=~mt.b2_contactTouchingFlag,fo(e,y,!1)}else if(v&Nt.b2_simStartedTouching)if(D&mt.b2_contactSensorFlag){if(D&mt.b2_contactEnableSensorEvents){if(S.isSensor){let P=new br;P.sensorShapeId=B,P.visitorShapeId=w,e.sensorBeginEventArray.push(P)}if(A.isSensor){let P=new br;P.sensorShapeId=w,P.visitorShapeId=B,e.sensorBeginEventArray.push(P)}}_.simFlags&=~Nt.b2_simStartedTouching,y.flags|=mt.b2_contactSensorTouchingFlag}else{if(D&mt.b2_contactEnableContactEvents){let P=new Ei;P.shapeIdA=B,P.shapeIdB=w,P.manifold=_.manifold,e.contactBeginArray.push(P)}y.flags|=mt.b2_contactTouchingFlag,fp(e,y),_=d.contacts.data[C],_.simFlags&=~Nt.b2_simStartedTouching,Pr(e,_,y),cy(e,M.b2_awakeSet,C)}else if(v&Nt.b2_simStoppedTouching)if(_.simFlags&=~Nt.b2_simStoppedTouching,D&mt.b2_contactSensorFlag){if(y.flags&=~mt.b2_contactSensorTouchingFlag,D&mt.b2_contactEnableSensorEvents){if(S.isSensor){let P=new Tn;P.sensorShapeId=B,P.visitorShapeId=w,e.sensorEndEventArray.push(P)}if(A.isSensor){let P=new Tn;P.sensorShapeId=w,P.visitorShapeId=B,e.sensorEndEventArray.push(P)}}}else{if(y.flags&=~mt.b2_contactTouchingFlag,y.flags&mt.b2_contactEnableContactEvents){let R=new Rn;R.shapeIdA=B,R.shapeIdB=w,e.contactEndArray.push(R)}ri(e,y);let P=y.edges[0].bodyId,T=y.edges[1].bodyId;ay(e,y,_),kr(e,P,T,I,C)}h=h&h-1n}}Lt(e),Fh(e)}Ne.b2Vec2Count=0;v2.calls={};Ne.b2Rot2Count=0;J2.calls={};Ne.b2ManifoldCount=0;Ne.b2ManifoldPointCount=0;M2.calls={};Ne.b2PolyCollideCount=0;Ne.b2ContactSimCount=0;Ne.b2TOIInputCount=0;Ne.b2ShapeCastPairInputCount=0;Ne.b2SweepCount=0;function gi(t,e,o){Ne.b2FrameCount++;let n=gt(t);if(n.locked||(n.bodyMoveEventArray=[],n.sensorBeginEventArray=[],n.sensorEndEventArray=[],n.contactBeginArray=[],n.contactEndArray=[],n.contactHitArray=[],e===0))return;n.locked=!0,Tu(n);let s=new Vs;s.world=n,s.dt=e,s.subStepCount=Math.max(1,o),e>0?(s.inv_dt=1/e,s.h=e/s.subStepCount,s.inv_h=s.subStepCount*s.inv_dt):(s.inv_dt=0,s.h=0,s.inv_h=0),n.inv_h=s.inv_h;let r=Math.min(n.contactHertz,.25*s.inv_h),i=Math.min(n.jointHertz,.125*s.inv_h);s.contactSoftness=ie(r,n.contactDampingRatio,s.h),s.staticSoftness=ie(2*r,n.contactDampingRatio,s.h),s.jointSoftness=ie(i,n.jointDampingRatio,s.h),s.restitutionThreshold=n.restitutionThreshold,s.maxLinearVelocity=n.maxLinearVelocity,s.enableWarmStarting=n.enableWarmStarting,ly(s),s.dt>0&&hl(n,s),n.locked=!1}var An=new g,ts=new g,dy=new rt,Eu=new at(An,dy);function Eh(t,e,o,n){let s=o.clone();switch(e.type){case Y.b2_capsuleShape:{let r=e.capsule;Se(s,r.center1,An),Se(s,r.center2,ts),e.image?t.DrawImageCapsule(An,ts,r.radius,e,t.context):e.imageNoDebug||t.DrawSolidCapsule(An,ts,r.radius,n,t.context)}break;case Y.b2_circleShape:{let r=e.circle;K2(s,r.center,Eu),e.image?t.DrawImageCircle(Eu,r.radius,e,t.context):e.imageNoDebug||t.DrawSolidCircle(Eu,r.radius,n,t.context)}break;case Y.b2_polygonShape:{let r=e.polygon;e.image?t.DrawImagePolygon(s,e,t.context):e.imageNoDebug||t.DrawSolidPolygon(s,r.vertices,r.count,r.radius,n,t.context)}break;case Y.b2_segmentShape:{let r=e.segment;Se(s,r.point1,An),Se(s,r.point2,ts),e.imageNoDebug||t.DrawSegment(An,ts,n,t.context)}break;case Y.b2_chainSegmentShape:{let r=e.chainSegment.segment;Se(s,r.point1,An),Se(s,r.point2,ts),e.imageNoDebug||t.DrawSegment(An,ts,n,t.context)}break;default:break}}var Xu=class{constructor(e,o){this.world=e,this.draw=o}};function by(t,e,o){let n=o,s=n.world,r=n.draw,i=s.shapeArray[e];if(eo(s.debugBodySet,i.bodyId),r.drawShapes){let c=s.bodyArray[i.bodyId],a=jt(s,c),l;c.setIndex>=M.b2_firstSleepingSet?l=V.b2_colorGray:i.customColor!==0?l=i.customColor:c.type===tt.b2_dynamicBody&&a.mass===0?l=V.b2_colorRed:c.setIndex===M.b2_disabledSet?l=V.b2_colorSlateGray:i.isSensor?l=V.b2_colorWheat:a.isBullet&&c.setIndex===M.b2_awakeSet?l=V.b2_colorTurquoise:c.isSpeedCapped?l=V.b2_colorYellow:a.isFast?l=V.b2_colorSalmon:c.type===tt.b2_staticBody?l=V.b2_colorPaleGreen:c.type===tt.b2_kinematicBody?l=V.b2_colorRoyalBlue:c.setIndex===M.b2_awakeSet?l=V.b2_colorPink:l=V.b2_colorGray,Eh(r,i,a.transform,l)}if(r.drawAABBs){let c=i.fatAABB,a=[new g(c.lowerBoundX,c.lowerBoundY),new g(c.upperBoundX,c.lowerBoundY),new g(c.upperBoundX,c.upperBoundY),new g(c.lowerBoundX,c.upperBoundY)];r.DrawPolygon(a,4,V.b2_colorGold,r.context)}return!0}function py(t,e){let o=1,n=.3,s=V.b2_colorGray3,r=V.b2_colorGreen,i=V.b2_colorBlue,c=V.b2_colorGray9,a=V.b2_colorMagenta,l=V.b2_colorYellow,d=[V.b2_colorRed,V.b2_colorOrange,V.b2_colorYellow,V.b2_colorGreen,V.b2_colorCyan,V.b2_colorBlue,V.b2_colorViolet,V.b2_colorPink,V.b2_colorChocolate,V.b2_colorGoldenrod,V.b2_colorCoral,V.b2_colorBlack],p=fs(t.bodyIdPool);t.debugBodySet=to(t.debugBodySet,p);let b=fs(t.jointIdPool);t.debugJointSet=to(t.debugJointSet,b);let u=fs(t.contactIdPool);t.debugContactSet=to(t.debugContactSet,u);let h=new Xu(t,e);for(let y=0;y<tt.b2_bodyTypeCount;++y)ve(t.broadPhase.trees[y],e.drawingBounds,Pn,by,h);let m=t.debugBodySet.blockCount,f=t.debugBodySet.bits;for(let y=0;y<m;++y){let I=f[y];for(;I!==0;){let C=Vr(I),_=64*y+C,S=t.bodyArray[_];if(e.drawMass&&S.type===tt.b2_dynamicBody){let B=new g(.1,.1),w=jt(t,S),D=new at(w.center,w.transform.q);e.DrawTransform(D,e.context);let v=H(D,B),P=`  ${w.mass.toFixed(2)}`;e.DrawString(v,P,e.context)}if(e.drawJoints){let B=S.headJointKey;for(;B!==x;){let w=B>>1,D=B&1,v=t.jointArray[w];Lh(t.debugJointSet,w)===!1&&(ca(e,t,v),eo(t.debugJointSet,w)),B=v.edges[D].nextKey}}let A=It;if(e.drawContacts&&S.type===tt.b2_dynamicBody&&S.setIndex===M.b2_awakeSet){let B=S.headContactKey;for(;B!==x;){let w=B>>1,D=B&1,v=t.contactArray[w];if(B=v.edges[D].nextKey,!(v.setIndex!==M.b2_awakeSet||v.colorIndex===x)){if(Lh(t.debugContactSet,w)===!1){let T=t.constraintGraph.colors[v.colorIndex].contacts.data[v.localIndex],R=T.manifold.pointCount,X=new g(T.manifold.normalX,T.manifold.normalY);for(let F=0;F<R;++F){let E=T.manifold.points[F];if(e.drawGraphColors){let W=v.colorIndex===Mt?7.5:5;e.DrawPoint(E.pointX,E.pointY,W,d[v.colorIndex],e.context)}else E.separation>A?e.DrawPoint(E.pointX,E.pointY,5,s,e.context):E.persisted===!1?e.DrawPoint(E.pointX,E.pointY,10,r,e.context):E.persisted===!0&&e.DrawPoint(E.pointX,E.pointY,5,i,e.context);if(e.drawContactNormals){let W=new g(E.pointX,E.pointY),et=$(W,n,X);e.DrawSegment(W,et,c,e.context)}else if(e.drawContactImpulses){let W=new g(E.pointX,E.pointY),et=$(W,o*E.normalImpulse,X);e.DrawSegment(W,et,a,e.context);let st=`${(1e3*E.normalImpulse).toFixed(1)}`;e.DrawString(W,st,e.context)}if(e.drawFrictionImpulses){let W=de(X),et=new g(E.pointX,E.pointY),st=$(et,o*E.tangentImpulse,W);e.DrawSegment(et,st,l,e.context);let ot=`${(1e3*E.tangentImpulse).toFixed(1)}`;e.DrawString(et,ot,e.context)}}eo(t.debugContactSet,w)}B=v.edges[D].nextKey}}}I=I&I-1}}}function Nu(t,e){let o=gt(t);if(!o.locked){if(e.useDrawingBounds){py(o,e);return}if(e.drawShapes){let n=o.solverSetArray.length;for(let s=0;s<n;++s){let r=o.solverSetArray[s],i=r.sims.count;for(let c=0;c<i;++c){let a=r.sims.data[c],l=o.bodyArray[a.bodyId],d=a.transform,p=l.headShapeId;for(;p!==x;){let b=o.shapeArray[p],u;l.setIndex>=M.b2_firstSleepingSet?u=V.b2_colorGray:b.customColor!==0?u=b.customColor:l.type===tt.b2_dynamicBody&&a.mass===0?u=V.b2_colorRed:l.setIndex===M.b2_disabledSet?u=V.b2_colorSlateGray:b.isSensor?u=V.b2_colorWheat:a.isBullet&&l.setIndex===M.b2_awakeSet?u=V.b2_colorTurquoise:l.isSpeedCapped?u=V.b2_colorYellow:a.isFast?u=V.b2_colorSalmon:l.type===tt.b2_staticBody?u=V.b2_colorPaleGreen:l.type===tt.b2_kinematicBody?u=V.b2_colorRoyalBlue:l.setIndex===M.b2_awakeSet?u=V.b2_colorPink:u=V.b2_colorGray,Eh(e,b,d,u),p=b.nextShapeId}}}}if(e.drawJoints){let n=o.jointArray.length;for(let s=0;s<n;++s){let r=o.jointArray[s];r.setIndex!==x&&ca(e,o,r)}}if(e.drawAABBs){let n=V.b2_colorGray,s=M.b2_awakeSet;{let r=o.solverSetArray[s],i=r.sims.count;for(let c=0;c<i;++c){let a=r.sims.data[c],l=at.identity(),p=o.bodyArray[a.bodyId].headShapeId;for(;p!==x;){let b=o.shapeArray[p],u=b.fatAABB,h=[new g(u.lowerBoundX,u.lowerBoundY),new g(u.upperBoundX,u.lowerBoundY),new g(u.upperBoundX,u.upperBoundY),new g(u.lowerBoundX,u.upperBoundY)];e.DrawPolygon(l,h,4,n,e.context),p=b.nextShapeId}}}}if(e.drawMass){let n=new g(.1,.1),s=o.solverSetArray.length;for(let r=0;r<s;++r){let i=o.solverSetArray[r],c=i.sims.count;for(let a=0;a<c;++a){let l=i.sims.data[a],d=new at(l.center,l.transform.q);e.DrawTransform(d,e.context);let p=H(d,n),b=`  ${l.mass.toFixed(2)}`;e.DrawString(p,b,e.context)}}}if(e.drawContacts){let r=It,i=V.b2_colorGray3,c=V.b2_colorGreen,a=V.b2_colorBlue,l=V.b2_colorGray9,d=V.b2_colorMagenta,p=V.b2_colorYellow,b=[V.b2_colorRed,V.b2_colorOrange,V.b2_colorYellow,V.b2_colorGreen,V.b2_colorCyan,V.b2_colorBlue,V.b2_colorViolet,V.b2_colorPink,V.b2_colorChocolate,V.b2_colorGoldenrod,V.b2_colorCoral,V.b2_colorBlack];for(let u=0;u<te;++u){let h=o.constraintGraph.colors[u],m=h.contacts.count;for(let f=0;f<m;++f){let y=h.contacts.data[f],I=y.manifold.pointCount,C=new g(y.manifold.normalX,y.manifold.normalY);for(let _=0;_<I;++_){let S=y.manifold.points[_];if(e.drawGraphColors&&0<=u&&u<=te){let A=u===Mt?7.5:5;e.DrawPoint(S.pointX,S.pointY,A,b[u],e.context)}else S.separation>r?e.DrawPoint(S.pointX,S.pointY,5,i,e.context):S.persisted===!1?e.DrawPoint(S.pointX,S.pointY,10,c,e.context):S.persisted===!0&&e.DrawPoint(S.pointX,S.pointY,5,a,e.context);if(e.drawContactNormals){let A=new g(S.pointX,S.pointY),B=$(A,.3,C);e.DrawSegment(A,B,l,e.context)}else if(e.drawContactImpulses){let A=new g(S.pointX,S.pointY),B=$(A,1*S.normalImpulse,C);e.DrawSegment(A,B,d,e.context);let w=`${(1e3*S.normalImpulse).toFixed(2)}`;e.DrawString(A,w,e.context)}if(e.drawFrictionImpulses){let A=de(C),B=new g(S.pointX,S.pointY),w=$(B,1*S.tangentImpulse,A);e.DrawSegment(B,w,p,e.context);let D=`${S.normalImpulse.toFixed(2)}`;e.DrawString(B,D,e.context)}}}}}}}function Wu(t){let e=gt(t);if(e.locked)return new En;let o=e.bodyMoveEventArray.length,n=new En;return n.moveEvents=e.bodyMoveEventArray,n.moveCount=o,n}function Ou(t){let e=gt(t);if(e.locked)return new Gn;let o=e.sensorBeginEventArray.length,n=e.sensorEndEventArray.length,s=new Gn;return s.beginEvents=e.sensorBeginEventArray,s.endEvents=e.sensorEndEventArray,s.beginCount=o,s.endCount=n,s}function Uu(t){let e=gt(t);if(e.locked)return new Ln;let o=e.contactBeginArray.length,n=e.contactEndArray.length,s=e.contactHitArray.length,r=new Ln;return r.beginEvents=e.contactBeginArray,r.endEvents=e.contactEndArray,r.hitEvents=e.contactHitArray,r.beginCount=o,r.endCount=n,r.hitCount=s,r}function zu(t){if(t===void 0||t.index1<1||er<t.index1)return!1;let e=Ae[t.index1-1];return e.worldId!==t.index1-1?!1:t.revision===e.revision}function Ku(t){if(t===void 0||!(t instanceof Ee)||t.world0<0||er<=t.world0)return!1;let e=Ae[t.world0];if(e.worldId!==t.world0||t.index1<1||e.bodyArray.length<t.index1)return!1;let o=e.bodyArray[t.index1-1];return!(o.setIndex===x||o.revision!==t.revision)}function Hu(t){if(t===void 0||er<=t.world0)return!1;let e=Ae[t.world0];if(e.worldId!==t.world0)return!1;let o=t.index1-1;if(o<0||e.shapeArray.length<=o)return!1;let n=e.shapeArray[o];return n.id===x?!1:t.revision===n.revision}function $u(t){if(t===void 0||t.world0<0||er<=t.world0)return!1;let e=Ae[t.world0];if(e.worldId!==t.world0)return!1;let o=t.index1-1;if(o<0||e.chainArray.length<=o)return!1;let n=e.chainArray[o];return n.id===x?!1:t.revision===n.revision}function Qu(t){if(t===void 0||t.world0<0||er<=t.world0)return!1;let e=Ae[t.world0];if(e.worldId!==t.world0)return!1;let o=t.index1-1;if(o<0||e.jointArray.length<=o)return!1;let n=e.jointArray[o];return n.jointId===x?!1:t.revision===n.revision}function Zu(t,e){let o=gt(t);if(!o.locked&&e!==o.enableSleep&&(o.enableSleep=e,e===!1)){let n=o.solverSetArray.length;for(let s=M.b2_firstSleepingSet;s<n;++s)o.solverSetArray[s].sims.length>0&&qe(o,s)}}function t2(t,e){let o=gt(t);o.locked||(o.enableWarmStarting=e)}function e2(t,e){let o=gt(t);o.locked||(o.enableContinuous=e)}function o2(t,e){let o=gt(t);o.locked||(o.restitutionThreshold=Math.max(0,Math.min(e,Number.MAX_VALUE)))}function n2(t,e){let o=gt(t);o.locked||(o.hitEventThreshold=Math.max(0,Math.min(e,Number.MAX_VALUE)))}function s2(t,e,o,n){let s=gt(t);s.locked||(s.contactHertz=ht(e,0,Number.MAX_VALUE),s.contactDampingRatio=ht(o,0,Number.MAX_VALUE),s.contactPushoutVelocity=ht(n,0,Number.MAX_VALUE))}function uy(t,e,o){let n=o,s=n.world,r=s.shapeArray[e],i=r.filter,c=n.filter;if(!(i.categoryBits&c.maskBits)||!(i.maskBits&c.categoryBits))return!0;let a=new St(e+1,s.worldId,r.revision);return n.fcn(a,n.userContext)}var qu=class{constructor(e=null,o=null,n=null,s=null){this.world=e,this.fcn=o,this.filter=n,this.userContext=s}};function r2(t,e,o,n,s){let r=gt(t);if(r.locked)return;let i=new qu(r,n,o,s);for(let c=0;c<tt.b2_bodyTypeCount;++c)ve(r.broadPhase.trees[c],e,o.maskBits,uy,i)}function i2(t,e,o){let n=o,s=n.world,r=s.shapeArray[e],i=r.filter,c=n.filter;if(!(i.categoryBits&c.maskBits)||!(i.maskBits&c.categoryBits))return!0;let a=_t(s,r.bodyId),l=Rt(s,a),d=new ue;d.proxyA=n.proxy,d.proxyB=$e(r),d.transformA=n.transform,d.transformB=l,d.useRadii=!0;let p=new ye;if(Be(p,d,null,0).distance>0)return!0;let u=new St(r.id+1,s.worldId,r.revision);return n.fcn(u,n.userContext)}function a2(t,e,o,n,s,r){let i=gt(t);if(i.locked)return;let c=jn(e,o),a=new Ii;a.world=i,a.fcn=s,a.filter=n,a.proxy=vt(e.center,1,e.radius),a.transform=o,a.userContext=r;for(let l=0;l<tt.b2_bodyTypeCount;++l)ve(i.broadPhase.trees[l],c,n.maskBits,i2,a)}function c2(t,e,o,n,s,r){let i=gt(t);if(i.locked)return;let c=Fn(e,o),a=new Ii;a.world=i,a.fcn=s,a.filter=n,a.proxy=vt(e.center,2,e.radius),a.transform=o,a.userContext=r;for(let l=0;l<tt.b2_bodyTypeCount;++l)ve(i.broadPhase.trees[l],c,n.maskBits,i2,a)}function l2(t,e,o,n,s,r){let i=gt(t);if(i.locked)return;let c=Xn(e,o),a=new Ii;a.world=i,a.fcn=s,a.filter=n,a.proxy=vt(e.vertices,e.count,e.radius),a.transform=o,a.userContext=r;for(let l=0;l<tt.b2_bodyTypeCount;++l)ve(i.broadPhase.trees[l],c,n.maskBits,i2,a)}function jh(t,e,o,n){let s=n,r=s.world,i=r.shapeArray[o],c=i.filter,a=s.filter;if(!(c.categoryBits&a.maskBits)||!(c.maskBits&a.categoryBits))return t.maxFraction;let l=_t(r,i.bodyId),d=Rt(r,l),p=ec(t,i,d);if(p.hit){let b=new St(o+1,r.worldId,i.revision),u=s.fcn(b,p.point,p.normal,p.fraction,s.userContext);return u>=0&&u<=1&&(s.fraction=u),u}return t.maxFraction}function d2(t,e,o,n,s,r){let i=gt(t);if(i.locked)return;let c=new Po;c.origin=e,c.translation=o,c.maxFraction=1;let a=new es;a.world=i,a.fcn=s,a.filter=n,a.fraction=1,a.userContext=r;for(let l=0;l<tt.b2_bodyTypeCount;++l){if(Gs(i.broadPhase.trees[l],c,n.maskBits,jh,a),a.fraction===0)return;c.maxFraction=a.fraction}}function hy(t,e,o,n,s){let r=s;return r.shapeId=t,r.point=e,r.normal=o,r.fraction=n,r.hit=!0,n}function b2(t,e,o,n){let s=new ys,r=gt(t);if(r.locked)return s;let i=new Po;i.origin=e,i.translation=o,i.maxFraction=1;let c=new es;c.world=r,c.fcn=hy,c.fraction=1,c.userContext=s;for(let a=0;a<tt.b2_bodyTypeCount;++a){if(Gs(r.broadPhase.trees[a],i,n.maskBits,jh,c),c.fraction==0)return s;i.maxFraction=c.fraction}return s}function p2(t,e,o,n){let s=n,r=s.world,i=r.shapeArray[o],c=i.filter,a=s.filter;if(!(c.categoryBits&a.maskBits)||!(c.maskBits&a.categoryBits))return t.maxFraction;let l=_t(r,i.bodyId),d=Rt(r,l),p=oc(t,i,d);if(p.hit){let b=new St(o+1,r.worldId,i.revision),u=s.fcn(b,p.point,p.normal,p.fraction,s.userContext);return s.fraction=u,u}return t.maxFraction}function u2(t,e,o,n,s,r,i){let c=gt(t);if(c.locked)return;let a=new Ko;a.points=[H(o,e.center)],a.count=1,a.radius=e.radius,a.translation=n,a.maxFraction=1;let l=new es;l.world=c,l.fcn=r,l.filter=s,l.fraction=1,l.userContext=i;for(let d=0;d<tt.b2_bodyTypeCount;++d){if(Nn(c.broadPhase.trees[d],a,s.maskBits,p2,l),l.fraction==0)return;a.maxFraction=l.fraction}}function h2(t,e,o,n,s,r,i){let c=gt(t);if(c.locked)return;let a=new Ko;a.points=[H(o,e.center1),H(o,e.center2)],a.count=2,a.radius=e.radius,a.translation=n,a.maxFraction=1;let l=new es;l.world=c,l.fcn=r,l.filter=s,l.fraction=1,l.userContext=i;for(let d=0;d<tt.b2_bodyTypeCount;++d){if(Nn(c.broadPhase.trees[d],a,s.maskBits,p2,l),l.fraction==0)return;a.maxFraction=l.fraction}}function m2(t,e,o,n,s,r,i){let c=gt(t);if(c.locked)return;let a=new Ko;a.points=e.vertices.map(d=>H(o,d)),a.count=e.count,a.radius=e.radius,a.translation=n,a.maxFraction=1;let l=new es;l.world=c,l.fcn=r,l.filter=s,l.fraction=1,l.userContext=i;for(let d=0;d<tt.b2_bodyTypeCount;++d){if(Nn(c.broadPhase.trees[d],a,s.maskBits,p2,l),l.fraction==0)return;a.maxFraction=l.fraction}}function y2(t,e,o){let n=gt(t);n.preSolveFcn=e,n.preSolveContext=o}function f2(t,e,o){let n=gt(t);n.customFilterFcn=e,n.customFilterContext=o}function x2(t,e){let o=gt(t);o.gravity=e}function I2(t){return gt(t).gravity}var Vu=class{constructor(e,o,n,s){this.world=e,this.position=o,this.radius=n,this.magnitude=s}};function my(t,e,o){let n=o,s=n.world,r=s.shapeArray[e],i=s.bodyArray[r.bodyId];if(i.type===tt.b2_kinematicBody||(Ot(s,i),i.setIndex!==M.b2_awakeSet))return!0;let c=Rt(s,i),a=new ue;a.proxyA=$e(r),a.proxyB=vt([n.position],1,0),a.transformA=c,a.transformB=new at(new g(0,0),new rt(1,0)),a.useRadii=!0;let l=new ye,d=Be(l,a,null,0);if(d.distance>n.radius)return!0;let p=d.pointA;if(d.distance===0){let S=Ds(r);p=H(c,S)}let b=.4,u=Za(r),h=n.magnitude*u*(1-b*d.distance/n.radius),m=dt(J(p,n.position)),f=it(h,m),y=i.localIndex,I=s.solverSetArray[M.b2_awakeSet],C=I.states.data[y],_=I.sims.data[y];return C.linearVelocity=$(C.linearVelocity,_.invMass,f),C.angularVelocity+=_.invInertia*z(J(p,_.center),f),!0}function S2(t,e,o,n){let s=gt(t);if(s.locked)return;let r=new Vu(s,e,o,n),i=new xt(e.x-o,e.y-o,e.x+o,e.y+o);ve(s.broadPhase.trees[tt.b2_dynamicBody],i,Pn,my,r)}function ju(t,e){if(e===x)return x;let o=e,n=t.islandArray[e];for(;n.parentIsland!==x;){let s=t.islandArray[n.parentIsland];o=n.parentIsland,n=s}return o}function se(t,e){Array.isArray(t)}function Hn(t){if(!po)return;let e=t.bodyArray.length;for(let o=0;o<e;++o){let n=t.bodyArray[o];if(n.id===x)continue;let s=ju(t,n.islandId),r=n.setIndex,i=n.headContactKey;for(;i!==x;){let a=i>>1,l=i&1,d=t.contactArray[a];if((d.flags&mt.b2_contactTouchingFlag)!==0&&!(d.flags&mt.b2_contactSensorFlag)&&r!==M.b2_staticSet){let b=ju(t,d.islandId)}i=d.edges[l].nextKey}let c=n.headJointKey;for(;c!==x;){let a=c>>1,l=c&1,d=t.jointArray[a],p=l^1,b=t.bodyArray[d.edges[p].bodyId];if(!(r===M.b2_disabledSet||b.setIndex===M.b2_disabledSet))if(r===M.b2_staticSet)b.setIndex,M.b2_staticSet;else{let u=ju(t,d.islandId)}c=d.edges[l].nextKey}}}function Lt(t){if(!po)return;let e=0,o=0,n=0,s=0,r=0,i=t.solverSetArray.length;for(let b=0;b<i;++b){let u=t.solverSetArray[b];if(u.setIndex!==x){e+=1,b===M.b2_staticSet||b===M.b2_awakeSet||M.b2_disabledSet;{let h=t.bodyArray;o+=u.sims.count;for(let m=0;m<u.sims.count;++m){let y=u.sims.data[m].bodyId;se(h,y);let I=h[y];M.b2_disabledSet;let C=x,_=I.headShapeId;for(;_!==x;){t.shapeArray;let B=t.shapeArray[_];if(b!==M.b2_disabledSet){if(b!==M.b2_staticSet){let w=qo(B.proxyKey)}}C=_,_=B.nextShapeId}let S=I.headContactKey;for(;S!==x;){let B=S>>1,w=S&1;se(t.contactArray,B),S=t.contactArray[B].edges[w].nextKey}let A=I.headJointKey;for(;A!==x;){let B=A>>1,w=A&1;se(t.jointArray,B);let D=t.jointArray[B],v=w^1;se(t.bodyArray,D.edges[v].bodyId);let P=t.bodyArray[D.edges[v].bodyId];b===M.b2_disabledSet||P.setIndex===M.b2_disabledSet||b===M.b2_staticSet&&P.setIndex===M.b2_staticSet||b===M.b2_awakeSet||b>=M.b2_firstSleepingSet;let T=No(t,D);A=D.edges[w].nextKey}}}{let h=t.contactArray;s+=u.contacts.count;for(let m=0;m<u.contacts.count;++m){let f=u.contacts.data[m],y=h[f.contactId];M.b2_awakeSet}}{let h=t.jointArray;n+=u.joints.count;for(let m=0;m<u.joints.count;++m){let f=u.joints.data[m],y=h[f.jointId]}}{let h=t.islandArray;r+=u.islands.count;for(let m=0;m<u.islands.count;++m){let f=u.islands.data[m],y=h[f.islandId]}}}}let c=on(t.solverSetIdPool),a=on(t.bodyIdPool),l=on(t.islandIdPool);for(let b=0;b<te;++b){let u=t.constraintGraph.colors[b];{let h=t.contactArray;s+=u.contacts.count;for(let m=0;m<u.contacts.count;++m){let f=u.contacts.data[m];se(h,f.contactId);let y=h[f.contactId],I=y.edges[0].bodyId,C=y.edges[1].bodyId;if(se(t.bodyArray,I),se(t.bodyArray,C),b<Mt){let _=t.bodyArray[I],S=t.bodyArray[C]}}}{let h=t.jointArray;n+=u.joints.count;for(let m=0;m<u.joints.count;++m){let f=u.joints.data[m];se(h,f.jointId);let y=h[f.jointId],I=y.edges[0].bodyId,C=y.edges[1].bodyId;if(se(t.bodyArray,I),se(t.bodyArray,C),b<Mt){let _=t.bodyArray[I],S=t.bodyArray[C]}}}}let d=on(t.contactIdPool),p=on(t.jointIdPool)}function Lh(t,e){let o=Math.floor(e/64);return o>=t.blockCount?!1:(t.bits[o]&BigInt(1)<<BigInt(e%64))!==BigInt(0)}function Fh(t){if(!po)return;let e=t.contactArray.length,o=0;for(let s=0;s<e;++s){let r=t.contactArray[s];if(r.contactId===x)continue;o+=1;let i=(r.flags&mt.b2_contactTouchingFlag)!==0,c=(r.flags&mt.b2_contactSensorTouchingFlag)!==0,a=(r.flags&mt.b2_contactSensorFlag)!==0,l=r.setIndex;l===M.b2_awakeSet||l>=M.b2_firstSleepingSet;let p=(Yn(t,r).simFlags&Nt.b2_simTouchingFlag)!==0}let n=on(t.contactIdPool)}function Xh(){}function qh(){}function Vh(){}var Cg=new g;var _2=class{constructor(){this.bodyId=null,this.jointId=null,this.frictionScale=1,this.parentIndex=-1,this.name=""}},Aa=class{static HumanBones={e_hip:0,e_torso:1,e_head:2,e_upperLeftLeg:3,e_lowerLeftLeg:4,e_upperRightLeg:5,e_lowerRightLeg:6,e_upperLeftArm:7,e_lowerLeftArm:8,e_upperRightArm:9,e_lowerRightArm:10,e_count:11};static sideViewHuman11={BONE_DATA:[{name:"hip",parentIndex:-1,position:[0,.95],capsule:{center1:[0,-.02],center2:[0,.02],radius:.095}},{name:"torso",parentIndex:0,position:[0,1.2],capsule:{center1:[0,-.135],center2:[0,.135],radius:.09},frictionScale:.5},{name:"head",parentIndex:1,position:[0,1.5],capsule:{center1:[0,-.0325],center2:[0,.0325],radius:.08},frictionScale:.25,linearDamping:.1},{name:"upperLeftLeg",parentIndex:0,position:[0,.775],capsule:{center1:[0,-.125],center2:[0,.125],radius:.06}},{name:"lowerLeftLeg",parentIndex:3,position:[0,.475],capsule:{center1:[0,-.14],center2:[0,.125],radius:.05},frictionScale:.5,foot:"right"},{name:"upperRightLeg",parentIndex:0,position:[0,.775],capsule:{center1:[0,-.125],center2:[0,.125],radius:.06}},{name:"lowerRightLeg",parentIndex:5,position:[0,.475],capsule:{center1:[0,-.14],center2:[0,.125],radius:.05},frictionScale:.5,foot:"right"},{name:"upperLeftArm",parentIndex:1,position:[0,1.225],capsule:{center1:[0,-.125],center2:[0,.125],radius:.035},frictionScale:.5},{name:"lowerLeftArm",parentIndex:7,position:[0,.975],capsule:{center1:[0,-.125],center2:[0,.125],radius:.03},frictionScale:.1,linearDamping:.1},{name:"upperRightArm",parentIndex:1,position:[0,1.225],capsule:{center1:[0,-.125],center2:[0,.125],radius:.035},frictionScale:.5},{name:"lowerRightArm",parentIndex:9,position:[0,.975],capsule:{center1:[0,-.125],center2:[0,.125],radius:.03},frictionScale:.1,linearDamping:.1}],JOINT_DATA:[{boneName:"torso",pivot:[0,1],limits:[-.25*Math.PI,0]},{boneName:"head",pivot:[0,1.4],limits:[-.3*Math.PI,.1*Math.PI]},{boneName:"upperLeftLeg",pivot:[0,.9],limits:[-.05*Math.PI,.4*Math.PI]},{boneName:"lowerLeftLeg",pivot:[0,.625],limits:[-.5*Math.PI,-.02*Math.PI]},{boneName:"upperRightLeg",pivot:[0,.9],limits:[-.05*Math.PI,.4*Math.PI]},{boneName:"lowerRightLeg",pivot:[0,.625],limits:[-.5*Math.PI,-.02*Math.PI]},{boneName:"upperLeftArm",pivot:[0,1.35],limits:[-.1*Math.PI,.8*Math.PI]},{boneName:"lowerLeftArm",pivot:[0,1.1],limits:[.01*Math.PI,.5*Math.PI]},{boneName:"upperRightArm",pivot:[0,1.35],limits:null},{boneName:"lowerRightArm",pivot:[0,1.1],limits:[.01*Math.PI,.5*Math.PI]}]};static frontViewHuman11={BONE_DATA:[{name:"hip",parentIndex:-1,position:[0,.95],capsule:{center1:[-.03,0],center2:[.03,0],radius:.095}},{name:"torso",parentIndex:0,position:[0,1.2],capsule:{center1:[0,-.135],center2:[0,.135],radius:.09},frictionScale:.5},{name:"head",parentIndex:1,position:[0,1.5],capsule:{center1:[0,-.0325],center2:[0,.0325],radius:.08},frictionScale:.25,linearDamping:.1},{name:"upperLeftLeg",parentIndex:0,position:[-.1,.775],capsule:{center1:[0,-.125],center2:[0,.125],radius:.06}},{name:"lowerLeftLeg",parentIndex:3,position:[-.1,.475],capsule:{center1:[0,-.14],center2:[0,.125],radius:.05},frictionScale:.5,foot:"left"},{name:"upperRightLeg",parentIndex:0,position:[.1,.775],capsule:{center1:[0,-.125],center2:[0,.125],radius:.06}},{name:"lowerRightLeg",parentIndex:5,position:[.1,.475],capsule:{center1:[0,-.14],center2:[0,.125],radius:.05},frictionScale:.5,foot:"right"},{name:"upperLeftArm",parentIndex:1,position:[-.15,1.22],capsule:{center1:[0,-.125],center2:[.05,.125],radius:.035},frictionScale:.5},{name:"lowerLeftArm",parentIndex:7,position:[-.15,.97],capsule:{center1:[0,-.125],center2:[0,.125],radius:.03},frictionScale:.1,linearDamping:.1},{name:"upperRightArm",parentIndex:1,position:[.15,1.22],capsule:{center1:[0,-.125],center2:[-.05,.125],radius:.035},frictionScale:.5},{name:"lowerRightArm",parentIndex:9,position:[.15,.97],capsule:{center1:[0,-.125],center2:[0,.125],radius:.03},frictionScale:.1,linearDamping:.1}],JOINT_DATA:[{boneName:"torso",pivot:[0,1],limits:[-.1*Math.PI,.1*Math.PI]},{boneName:"head",pivot:[0,1.4],limits:[-.2*Math.PI,.2*Math.PI]},{boneName:"upperLeftLeg",pivot:[-.1,.9],limits:[-.3*Math.PI,.1*Math.PI]},{boneName:"lowerLeftLeg",pivot:[-.1,.625],limits:[0,.5*Math.PI]},{boneName:"upperRightLeg",pivot:[.1,.9],limits:[-.1*Math.PI,.3*Math.PI]},{boneName:"lowerRightLeg",pivot:[.1,.625],limits:[-.5*Math.PI,0]},{boneName:"upperLeftArm",pivot:[-.12,1.35],limits:[-.7*Math.PI,.1*Math.PI]},{boneName:"lowerLeftArm",pivot:[-.16,1.1],limits:[0,.75*Math.PI]},{boneName:"upperRightArm",pivot:[.12,1.35],limits:[-.1*Math.PI,.7*Math.PI]},{boneName:"lowerRightArm",pivot:[.14,1.1],limits:[0,.75*Math.PI]}]};static ElephantBones={e_torso:0,e_head:1,e_trunkBase:2,e_trunkMid:3,e_trunkTip:4,e_upperFrontLegL:5,e_lowerFrontLegL:6,e_upperRearLegL:7,e_lowerRearLegL:8,e_tail:9,e_ear:10,e_count:11};static sideViewElephant={BONE_DATA:[{name:"torso",parentIndex:-1,position:[0,1.5],capsule:{center1:[.8,0],center2:[-.8,0],radius:.6},frictionScale:.5},{name:"head",parentIndex:0,position:[-1.4,2.2],capsule:{center1:[.3,0],center2:[-.3,0],radius:.35},frictionScale:.25,linearDamping:.1},{name:"trunkBase",parentIndex:1,position:[-1.95,1.85],capsule:{center1:[0,-.2],center2:[0,.2],radius:.15}},{name:"trunkMid",parentIndex:2,position:[-1.95,1.4],capsule:{center1:[0,-.2],center2:[0,.2],radius:.12}},{name:"trunkTip",parentIndex:3,position:[-1.95,1.05],capsule:{center1:[0,-.2],center2:[0,.2],radius:.08},frictionScale:.1,linearDamping:.1},{name:"upperFrontLeg",parentIndex:0,position:[-.6,.8],capsule:{center1:[0,-.3],center2:[0,.3],radius:.2}},{name:"lowerFrontLeg",parentIndex:5,position:[-.6,.2],capsule:{center1:[0,-.3],center2:[0,.3],radius:.18},frictionScale:.5},{name:"upperBackLeg",parentIndex:0,position:[.7,.8],capsule:{center1:[0,-.3],center2:[0,.3],radius:.22}},{name:"lowerBackLeg",parentIndex:7,position:[.7,.2],capsule:{center1:[0,-.3],center2:[0,.3],radius:.2},frictionScale:.5},{name:"tail",parentIndex:0,position:[1.2,1.6],capsule:{center1:[0,-.3],center2:[0,.3],radius:.05},frictionScale:.1,linearDamping:.1},{name:"ear",parentIndex:1,position:[-1.1,2],capsule:{center1:[0,-.15],center2:[0,.15],radius:.3},frictionScale:.1,linearDamping:.1}],JOINT_DATA:[{boneName:"head",pivot:[-1,2],limits:[-.1*Math.PI,.3*Math.PI]},{boneName:"trunkBase",pivot:[-1.95,2],limits:[-.5*Math.PI,.5*Math.PI]},{boneName:"trunkMid",pivot:[-1.95,1.55],limits:[-.7*Math.PI,.7*Math.PI]},{boneName:"trunkTip",pivot:[-1.95,1.15],limits:[-.9*Math.PI,.9*Math.PI]},{boneName:"upperFrontLeg",pivot:[-.6,1.1],limits:[-.2*Math.PI,.2*Math.PI]},{boneName:"lowerFrontLeg",pivot:[-.6,.5],limits:[-.3*Math.PI,.1*Math.PI]},{boneName:"upperBackLeg",pivot:[.7,1.1],limits:[-.2*Math.PI,.2*Math.PI]},{boneName:"lowerBackLeg",pivot:[.7,.5],limits:[-.1*Math.PI,.3*Math.PI]},{boneName:"tail",pivot:[1.2,1.9],limits:[-.4*Math.PI,.4*Math.PI]},{boneName:"ear",pivot:[-1.1,2.2],limits:[-.3*Math.PI,.9*Math.PI]}]}},Ca=class{constructor(e,o,n,s,r,i,c=2){this.skeleton=e,this.position=new g(o,n),this.worldId=s,this.groupIndex=r,this.color=i,this.m_scale=c,this.frictionTorque=.05,this.hertz=0,this.dampingRatio=.5,this.jointDrawSize=.5,this.maxTorque=this.frictionTorque*this.m_scale,this.m_bones=[],this.create()}createBone(e){let{bodyId:o}=Bi({worldId:this.worldId,position:U(new g(e.position[0]*this.m_scale,e.position[1]*this.m_scale),this.position),type:tt.b2_dynamicBody,center1:new g(e.capsule.center1[0]*this.m_scale,e.capsule.center1[1]*this.m_scale),center2:new g(e.capsule.center2[0]*this.m_scale,e.capsule.center2[1]*this.m_scale),radius:e.capsule.radius*this.m_scale,density:1,friction:.2,groupIndex:-this.groupIndex,color:this.color}),n=new _2;if(n.name=e.name,n.parentIndex=e.parentIndex,n.frictionScale=e.frictionScale||1,n.bodyId=o,e.foot){let s=fe();s.density=1,s.friction=.2,s.filter.groupIndex=-this.groupIndex,s.filter.maskBits=1,s.customColor=this.color;let r=e.foot=="left"?-1:1,i=new _e;i.center1=new g(r*-.02*this.m_scale,-.175*this.m_scale),i.center2=new g(r*.13*this.m_scale,-.175*this.m_scale),i.radius=.03*this.m_scale,qn(o,s,i)}return n}createJoint(e){let o=this.m_bones.find(i=>i.name===e.boneName),n=this.m_bones[o.parentIndex],s=U(new g(e.pivot[0]*this.m_scale,e.pivot[1]*this.m_scale),this.position),r=new ho;return r.bodyIdA=n.bodyId,r.bodyIdB=o.bodyId,r.localAnchorA=zs(r.bodyIdA,s),r.localAnchorB=zs(r.bodyIdB,s),e.limits&&(r.enableLimit=!0,r.lowerAngle=e.limits[0],r.upperAngle=e.limits[1]),r.enableMotor=!0,r.maxMotorTorque=o.frictionScale*this.maxTorque,r.enableSpring=this.hertz>0,r.hertz=this.hertz,r.dampingRatio=this.dampingRatio,r.drawSize=this.jointDrawSize,Sn(this.worldId,r)}create(){return this.m_bones=this.skeleton.BONE_DATA.map(e=>this.createBone(e)),this.skeleton.JOINT_DATA.forEach(e=>{let o=this.m_bones.find(n=>n.name===e.boneName);o.jointId=this.createJoint(e)}),this.m_bones.forEach(e=>gn(e.bodyId,this)),this}destroy(){for(let e=0;e<this.m_bones.length;++e)this.m_bones[e].jointId&&this.m_bones[e].jointId.index1-1!=x&&(ni(this.m_bones[e].jointId),this.m_bones[e].jointId=new zt);for(let e=0;e<this.m_bones.length;++e)this.m_bones[e].bodyId.index1-1!=x&&(_n(this.m_bones[e].bodyId),this.m_bones[e].bodyId=null);this.m_bones=null}};var g2=2;function G(t,e,o){return o!==void 0?(t[e]=o,!0):!1}var io=new Map,Cn=30;function Yh(t){Cn=t}function Nh(){return Cn}function Wh(t){return t*Cn}function Oh(t){return t/Cn}function or(t,e){return new g(t/Cn,e/Cn)}function wa(t){return new rt(Math.cos(-t),Math.sin(-t))}function Uh(t,e,o){io.has(t)||io.set(t,new Map),io.get(t).set(e,o)}function zh(t,e,o=!1){if(io.has(t)){let n=io.get(t),s=n.get(e);if(s&&o){let r=s.bodyId;_n(r)}n.delete(e)}}function Kh(t){io.has(t)&&io.get(t).clear()}function Hh(t,e){return io.has(t)?io.get(t).get(e):null}function $h(t){io.has(t)&&io.get(t).forEach((e,o)=>{B2(e,o)})}function B2(t,e){let o=ii(t.bodyId);e.x=o.p.x*Cn,e.y=-(o.p.y*Cn),e.rotation=-Math.atan2(o.q.s,o.q.c)}function Qh(t,e,o){let n=e?.scaleX||e?.scale?.x||1,s=e?.scaleY||e?.scale?.y||1,r={worldId:t,type:g2,size:or(e.width*n/2,e.height*s/2)},i=C2({...r,...o});return Ks(i.bodyId,or(e.x,-e.y),wa(e.rotation)),i}function Zh(t,e,o){let n=e?.scaleX||e?.scale?.x||1,s=e?.scaleY||e?.scale?.y||1,r={worldId:t,type:g2,size:or(e.width*n/2,e.height*s/2)},i=A2({...r,...o});return Ks(i.bodyId,or(e.x,-e.y),wa(e.rotation)),i}function tm(t){let e=t.worldDef;return e||(e=lr()),Si(),{worldId:_i(e)}}var Ja=0;function em(t){let e=t.fixedTimeStep;e||(e=1/60);let o=t.subStepCount;o||(o=4);let n=e*2;Ja=Math.min(Ja+t.deltaTime,e+n);let r=2;t.deltaTime>e&&(r=0);let i=0;for(;Ja>=e&&r-->=0&&i<e;){let c=performance.now();gi(t.worldId,e,o),i=(performance.now()-c)/1e3,Ja-=e}return i}function om(t){let e=os(t.firstLinkPosition,t.lastLinkPosition)/t.chainLinks,o=t.type!==void 0?t.type:tt.b2_dynamicBody,n=t.density!==void 0?t.density:1,s=t.friction!==void 0?t.friction:.5,r=t.color!==void 0?t.color:V.b2_colorGold,i=t.radius!==void 0?t.radius:.5;var c=null,a=U(t.firstLinkPosition,new g(t.linkLength,0));let l=[];for(let d=0;d<t.chainLinks;d++){let p=Bi({worldId:t.worldId,type:o,position:a,center1:new g(-t.linkLength/2+t.radius,0),center2:new g(t.linkLength/2-t.radius,0),radius:i,density:n,friction:s,groupIndex:-1,color:r});l.push(p),d==0?t.fixEnds&&Ai({worldId:t.worldId,bodyIdA:t.groundId,bodyIdB:p.bodyId,anchorA:t.firstLinkPosition,anchorB:new g(-t.linkLength/2,0)}):Ai({worldId:t.worldId,bodyIdA:c.bodyId,bodyIdB:p.bodyId,anchorA:new g(t.linkLength/2,0),anchorB:new g(-t.linkLength/2,0)}),c=p,a=U(a,new g(e,0))}return t.fixEnds&&Ai({worldId:t.worldId,bodyIdA:t.groundId,bodyIdB:c.bodyId,anchorA:t.lastLinkPosition,anchorB:new g(t.linkLength/2,0)}),l}function A2(t){let e=t.bodyDef;e||(e=Fe()),G(e,"type",t.type),G(e,"position",t.position);let o=t.bodyId;o||(o=Bo(t.worldId,e));let n=t.shapeDef;n||(n=fe()),G(n,"density",t.density),G(n,"friction",t.friction),G(n.filter,"groupIndex",t.groupIndex),G(n.filter,"categoryBits",t.categoryBits),G(n.filter,"maskBits",t.maskBits),G(n,"customColor",t.color),G(n,"enablePreSolveEvents",t.preSolve),G(n,"isSensor",t.isSensor),G(n,"restitution",t.restitution);let s=new ce;G(s,"radius",t.radius),t.bodyId&&G(s,"center",t.offset);let r=Ms(o,n,s);return{bodyId:o,shapeId:r,object:s}}function Bi(t){let e=t.bodyDef;e||(e=Fe()),G(e,"type",t.type),G(e,"position",t.position),G(e,"fixedRotation",t.fixedRotation),G(e,"linearDamping",t.linearDamping);let o=t.bodyId;o||(o=Bo(t.worldId,e));let n=t.shapeDef;n||(n=fe()),G(n,"density",t.density),G(n,"friction",t.friction),G(n.filter,"groupIndex",t.groupIndex),G(n.filter,"categoryBits",t.categoryBits),G(n.filter,"maskBits",t.maskBits),G(n,"customColor",t.color);let s=new _e;t.width&&(t.radius=t.width/2),t.height&&(t.radius=Math.min(t.radius,t.height/2),t.center1=new g(0,-(t.height/2)),t.center2=new g(0,t.height/2)),G(s,"center1",t.center1),G(s,"center2",t.center2),G(s,"radius",t.radius);let r=qn(o,n,s);return{bodyId:o,shapeId:r,object:s}}function C2(t){let e=t.bodyDef;e||(e=Fe()),G(e,"type",t.type),G(e,"position",t.position),G(e,"fixedRotation",t.fixedRotation),G(e,"linearDamping",t.linearDamping),G(e,"angularDamping",t.angularDamping);let o=t.bodyId;o||(o=Bo(t.worldId,e));let n=t.shapeDef;n||(n=fe()),t.userData&&gn(o,t.userData),G(n,"density",t.density),G(n,"friction",t.friction),G(n,"restitution",t.restitution),G(n.filter,"groupIndex",t.groupIndex),G(n.filter,"categoryBits",t.categoryBits),G(n.filter,"maskBits",t.maskBits),G(n,"customColor",t.color),G(n,"enablePreSolveEvents",t.preSolve);let r;t.size instanceof g?t.bodyId?r=Ir(t.size.x,t.size.y,t.position,0):r=Fo(t.size.x,t.size.y):r=Fo(t.size,t.size);let i=yo(o,n,r);return{bodyId:o,shapeId:i,object:r}}function nm(t){if(t.sides<3||t.sides>Ce)return null;let e=t.bodyDef||Fe();G(e,"type",t.type),G(e,"position",t.position);let o=t.bodyId;o||(o=Bo(t.worldId,e));let n=t.shapeDef||fe();G(n,"density",t.density),G(n,"friction",t.friction),G(n.filter,"groupIndex",t.groupIndex),G(n,"customColor",t.color);let s=[],r=2*Math.PI/t.sides;for(let l=0;l<t.sides;l++){let d=l*r,p=t.radius*Math.cos(d),b=t.radius*Math.sin(d);s.push(new g(p,b))}let i,c=nn(s,t.sides);if(t.bodyId!=null){let l=he(t.worldId,t.bodyId),d=new at(t.position,l.q);i=gs(c,0,d)}else i=sn(c,0);let a=yo(o,n,i);return{bodyId:o,shapeId:a,object:i}}function va(t){if(t.vertices.length<3||t.vertices.length>Ce)return null;let e=t.bodyDef||Fe();G(e,"type",t.type),G(e,"position",t.position);let o=t.bodyId;o||(o=Bo(t.worldId,e));let n=t.shapeDef||fe();G(n,"density",t.density),G(n,"friction",t.friction),G(n.filter,"groupIndex",t.groupIndex),G(n,"customColor",t.color);let s,r=nn(t.vertices,t.vertices.length);if(t.bodyId!=null){let c=he(t.worldId,t.bodyId),a=new at(t.position,c.q);s=gs(r,0,a)}else s=sn(r,0);let i=yo(o,n,s);return{bodyId:o,shapeId:i,object:s}}function sm(t){if(t.vertices.length<3)return null;let e=t.bodyDef||Fe();G(e,"type",t.type),G(e,"position",t.position);let o=t.shapeDef||fe();G(o,"density",t.density),G(o,"friction",t.friction),G(o,"restitution",t.restitution),G(o.filter,"groupIndex",t.groupIndex),G(o,"customColor",t.color);let n=[],s=t.vertexScale;s||(s=new g(1,1));let r=t.vertexOffset;r||(r=new g(0,0));for(let c=0,a=t.indices[0].length;c<a;c+=3){let l=[];for(let d=0;d<3;d++){let p=t.indices[0][c+d]*2;l.push(new g((t.vertices[p]+r.x)*s.x,(t.vertices[p+1]+r.y)*s.y))}n.push(l)}let i=null;n.forEach(c=>{if(!i)i=va({worldId:t.worldId,type:tt.b2_dynamicBody,bodyDef:e,vertices:c,density:1,friction:.3,color:V.b2_colorSkyBlue});else{let a=nn(c,c.length),l=sn(a,0);yo(i.bodyId,o,l)}})}function w2(t){if(t.vertices.length<3)return null;let e=t.bodyDef||Fe();G(e,"type",t.type),G(e,"position",t.position);let o=t.shapeDef||fe();G(o,"density",t.density),G(o,"friction",t.friction),G(o,"restitution",t.restitution),G(o.filter,"groupIndex",t.groupIndex),G(o,"customColor",t.color);let n=t.vertexScale;n||(n=new g(1,1));let s=t.vertexOffset;s||(s=new g(0,0));let r=[];for(let c=0,a=t.indices.length;c<a;c++){let l=[],d=t.indices[c];for(let p=0,b=d.length;p<b;p++){let u=d[p]*2;l.push(new g((t.vertices[u]+s.x)*n.x,(t.vertices[u+1]+s.y)*n.y))}r.push(l)}let i=null;r.forEach(c=>{if(!i)i=va({worldId:t.worldId,type:tt.b2_dynamicBody,bodyDef:e,vertices:c,density:1,friction:.3,color:V.b2_colorSkyBlue});else{let a=nn(c,c.length),l=sn(a,0);yo(i.bodyId,o,l)}})}function rm(t){let e=t.key,o=t.url;async function n(i){try{let a=await(await fetch(i)).text();return new DOMParser().parseFromString(a,"text/xml")}catch(c){throw c}}function s(i,c){let a=c.querySelectorAll(`body[name=${i}] fixtures polygon`),l=[],d=[];function p(b,u){let m=l.length;for(let f=0;f<m;f+=2)if(Math.abs(l[f]-b)<1e-6&&Math.abs(l[f+1]-u)<1e-6)return f/2;return l.push(b,u),m/2}return Array.from(a).forEach(b=>{let u=b.textContent.trim().split(/[,\s]+/).map(Number),h=[];for(let m=0;m<u.length;m+=2){let f=p(u[m],u[m+1]);h.push(f)}d.push(h)}),{vertices:l,indices:d}}function r(i){return w2({...t,indices:i.indices,vertices:i.vertices})}return new Promise(async(i,c)=>{try{let a=await n(o),l=s(e,a),d=r(l);i(d)}catch(a){c(a)}})}function Ai(t){let e=t.jointDef;return e||(e=new ho),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,G(e,"localAnchorA",t.anchorA),G(e,"localAnchorB",t.anchorB),G(e,"lowerAngle",t.lowerAngle),G(e,"upperAngle",t.upperAngle),G(e,"enableLimit",t.enableLimit),G(e,"enableMotor",t.enableMotor),G(e,"motorSpeed",t.motorSpeed),G(e,"maxMotorTorque",t.maxMotorTorque),G(e,"enableSpring",t.enableSpring),G(e,"hertz",t.hertz),G(e,"dampingRatio",t.dampingRatio),G(e,"collideConnected",t.collideConnected),G(e,"drawSize",t.drawSize),{jointId:Sn(t.worldId,e)}}function im(t){let e=t.jointDef;e||(e=new tn),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,G(e,"localAnchorA",t.anchorA),G(e,"localAnchorB",t.anchorB);let o=Us(t.bodyIdA),n=Us(t.bodyIdB);return e.referenceAngle=oe(n,o),G(e,"referenceAngle",t.referenceAngle),G(e,"angularHertz",t.hertz),G(e,"angularDampingRatio",t.dampingRatio),G(e,"collideConnected",t.collideConnected),{jointId:ei(t.worldId,e)}}function am(t){let e=t.jointDef;return e||(e=new Ho),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,G(e,"localAnchorA",t.anchorA),G(e,"localAnchorB",t.anchorB),G(e,"length",t.length),G(e,"minLength",t.minLength),G(e,"maxLength",t.maxLength),G(e,"enableSpring",t.enableSpring),G(e,"hertz",t.hertz),G(e,"dampingRatio",t.dampingRatio),G(e,"enableLimit",t.enableLimit),G(e,"collideConnected",t.collideConnected),{jointId:$r(t.worldId,e)}}function cm(t){let e=t.jointDef;return e||(e=new en),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,G(e,"localAnchorA",t.anchorA),G(e,"localAnchorB",t.anchorB),G(e,"enableSpring",t.enableSpring),G(e,"localAxisA",t.axis),G(e,"hertz",t.hertz),G(e,"dampingRatio",t.dampingRatio),G(e,"enableLimit",t.enableLimit),G(e,"lowerTranslation",t.lowerTranslation),G(e,"upperTranslation",t.upperTranslation),G(e,"enableMotor",t.enableMotor),G(e,"maxMotorTorque",t.maxMotorTorque),G(e,"motorSpeed",t.motorSpeed),G(e,"collideConnected",t.collideConnected),{jointId:oi(t.worldId,e)}}function lm(t){let e=t.jointDef;return e||(e=new Zo),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,G(e,"localAnchorA",t.anchorA),G(e,"localAnchorB",t.anchorB),G(e,"localAxisA",t.axis),G(e,"referenceAngle",t.referenceAngle),G(e,"enableSpring",t.enableSpring),G(e,"hertz",t.hertz),G(e,"dampingRatio",t.dampingRatio),G(e,"enableLimit",t.enableLimit),G(e,"lowerTranslation",t.lowerTranslation),G(e,"upperTranslation",t.upperTranslation),G(e,"enableMotor",t.enableMotor),G(e,"maxMotorForce",t.maxMotorForce),G(e,"motorSpeed",t.motorSpeed),G(e,"collideConnected",t.collideConnected),{jointId:ti(t.worldId,e)}}function dm(t){let e=t.jointDef;return e||(e=new $o),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,G(e,"linearOffset",t.linearOffset),G(e,"maxForce",t.maxForce),G(e,"angularOffset",t.angularOffset),G(e,"maxTorque",t.maxTorque),G(e,"correctionFactor",t.correctionFactor),G(e,"collideConnected",t.collideConnected),{jointId:Qr(t.worldId,e)}}function bm(t){let e=t.jointDef;return e||(e=new Qo),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,G(e,"target",t.target),G(e,"hertz",t.hertz),G(e,"dampingRatio",t.dampingRatio),G(e,"maxForce",t.maxForce),G(e,"collideConnected",t.collideConnected),{jointId:Zr(t.worldId,e)}}var lA=0,dA=1,bA=2;export{Uh as AddSpriteToWorld,ph as B2_ID_EQUALS,bh as B2_IS_NON_NULL,dh as B2_IS_NULL,x as B2_NULL_INDEX,B2 as BodyToSprite,Kh as ClearWorldSprites,C2 as CreateBoxPolygon,Bi as CreateCapsule,om as CreateChain,A2 as CreateCircle,am as CreateDistanceJoint,dm as CreateMotorJoint,bm as CreateMouseJoint,nm as CreateNGonPolygon,rm as CreatePhysicsEditorShape,va as CreatePolygon,sm as CreatePolygonFromEarcut,w2 as CreatePolygonFromVertices,lm as CreatePrismaticJoint,Ai as CreateRevoluteJoint,im as CreateWeldJoint,cm as CreateWheelJoint,tm as CreateWorld,bA as DYNAMIC,Hh as GetBodyFromSprite,Nh as GetWorldScale,dA as KINEMATIC,Ca as Ragdoll,zh as RemoveSpriteFromWorld,wa as RotFromRad,lA as STATIC,Yh as SetWorldScale,Aa as Skeletons,Qh as SpriteToBox,Zh as SpriteToCircle,$h as UpdateWorldSprites,em as WorldStep,xt as b2AABB,Le as b2AABB_Center,vo as b2AABB_Contains,rs as b2AABB_Extents,ka as b2AABB_IsValid,qt as b2AABB_Union,nr as b2Abs,k2 as b2AbsFloat,R2 as b2AbsInt,U as b2Add,ps as b2BodyDef,En as b2BodyEvents,Ee as b2BodyId,tt as b2BodyType,Lp as b2Body_ApplyAngularImpulse,kp as b2Body_ApplyForce,Ia as b2Body_ApplyForceToCenter,Gp as b2Body_ApplyLinearImpulse,Rp as b2Body_ApplyLinearImpulseToCenter,Op as b2Body_ApplyMassFromShapes,Tp as b2Body_ApplyTorque,Bp as b2Body_ComputeAABB,iu as b2Body_Disable,au as b2Body_Enable,pu as b2Body_EnableHitEvents,ru as b2Body_EnableSleep,Hp as b2Body_GetAngularDamping,Mp as b2Body_GetAngularVelocity,_p as b2Body_GetContactCapacity,gp as b2Body_GetContactData,Qp as b2Body_GetGravityScale,qp as b2Body_GetInertiaTensor,hu as b2Body_GetJointCount,mu as b2Body_GetJoints,zp as b2Body_GetLinearDamping,Jp as b2Body_GetLinearVelocity,Vp as b2Body_GetLocalCenterOfMass,zs as b2Body_GetLocalPoint,wp as b2Body_GetLocalVector,Xp as b2Body_GetMass,Wp as b2Body_GetMassData,Ap as b2Body_GetPosition,Us as b2Body_GetRotation,uu as b2Body_GetShapeCount,Sa as b2Body_GetShapes,su as b2Body_GetSleepThreshold,ii as b2Body_GetTransform,Ep as b2Body_GetType,Fp as b2Body_GetUserData,Yp as b2Body_GetWorldCenterOfMass,Cp as b2Body_GetWorldPoint,vp as b2Body_GetWorldVector,Zp as b2Body_IsAwake,bu as b2Body_IsBullet,eu as b2Body_IsEnabled,lu as b2Body_IsFixedRotation,ou as b2Body_IsSleepEnabled,Ku as b2Body_IsValid,Kp as b2Body_SetAngularDamping,Pp as b2Body_SetAngularVelocity,tu as b2Body_SetAwake,du as b2Body_SetBullet,cu as b2Body_SetFixedRotation,$p as b2Body_SetGravityScale,Up as b2Body_SetLinearDamping,Dp as b2Body_SetLinearVelocity,Np as b2Body_SetMassData,nu as b2Body_SetSleepThreshold,Ks as b2Body_SetTransform,jp as b2Body_SetType,gn as b2Body_SetUserData,_e as b2Capsule,me as b2CastOutput,hs as b2ChainDef,Mo as b2ChainId,Ue as b2ChainSegment,$u as b2Chain_IsValid,Lc as b2Chain_SetFriction,Ec as b2Chain_SetRestitution,ce as b2Circle,j2 as b2Clamp,ht as b2ClampFloat,L2 as b2ClampInt,$s as b2CollideCapsuleAndCircle,Qs as b2CollideCapsules,mi as b2CollideChainSegmentAndCapsule,hi as b2CollideChainSegmentAndCircle,Zs as b2CollideChainSegmentAndPolygon,ci as b2CollideCircles,bi as b2CollidePolygonAndCapsule,li as b2CollidePolygonAndCircle,Zn as b2CollidePolygons,di as b2CollideSegmentAndCapsule,pi as b2CollideSegmentAndCircle,ui as b2CollideSegmentAndPolygon,V2 as b2ComputeAngularVelocity,Fn as b2ComputeCapsuleAABB,As as b2ComputeCapsuleMass,jn as b2ComputeCircleAABB,Bs as b2ComputeCircleMass,nn as b2ComputeHull,Xn as b2ComputePolygonAABB,Sr as b2ComputePolygonMass,Cs as b2ComputeSegmentAABB,Xi as b2ContactData,Ln as b2ContactEvents,Bo as b2CreateBody,qn as b2CreateCapsuleShape,$a as b2CreateChain,Ms as b2CreateCircleShape,$r as b2CreateDistanceJoint,Qr as b2CreateMotorJoint,Zr as b2CreateMouseJoint,yo as b2CreatePolygonShape,ti as b2CreatePrismaticJoint,Sn as b2CreateRevoluteJoint,Ka as b2CreateSegmentShape,sh as b2CreateTimer,ei as b2CreateWeldJoint,oi as b2CreateWheelJoint,_i as b2CreateWorld,Si as b2CreateWorldArray,z as b2Cross,Gt as b2CrossSV,Oo as b2CrossVS,pr as b2DebugDraw,Fe as b2DefaultBodyDef,Va as b2DefaultChainDef,Qb as b2DefaultDistanceJointDef,dr as b2DefaultFilter,Zb as b2DefaultMotorJointDef,tp as b2DefaultMouseJointDef,ep as b2DefaultPrismaticJointDef,qa as b2DefaultQueryFilter,ia as b2DefaultRevoluteJointDef,fe as b2DefaultShapeDef,op as b2DefaultWeldJointDef,np as b2DefaultWheelJointDef,lr as b2DefaultWorldDef,_n as b2DestroyBody,Qa as b2DestroyChain,ni as b2DestroyJoint,Ha as b2DestroyShape,Yu as b2DestroyWorld,os as b2Distance,ye as b2DistanceCache,ue as b2DistanceInput,Ho as b2DistanceJointDef,_l as b2DistanceJoint_EnableLimit,Tl as b2DistanceJoint_EnableMotor,vl as b2DistanceJoint_EnableSpring,wl as b2DistanceJoint_GetCurrentLength,kl as b2DistanceJoint_GetDampingRatio,Pl as b2DistanceJoint_GetHertz,Sl as b2DistanceJoint_GetLength,Cl as b2DistanceJoint_GetMaxLength,Fl as b2DistanceJoint_GetMaxMotorForce,Al as b2DistanceJoint_GetMinLength,El as b2DistanceJoint_GetMotorForce,Ll as b2DistanceJoint_GetMotorSpeed,gl as b2DistanceJoint_IsLimitEnabled,Gl as b2DistanceJoint_IsMotorEnabled,Jl as b2DistanceJoint_IsSpringEnabled,Il as b2DistanceJoint_SetLength,Bl as b2DistanceJoint_SetLengthRange,jl as b2DistanceJoint_SetMaxMotorForce,Rl as b2DistanceJoint_SetMotorSpeed,Dl as b2DistanceJoint_SetSpringDampingRatio,Ml as b2DistanceJoint_SetSpringHertz,as as b2DistanceOutput,Pe as b2DistanceProxy,pe as b2DistanceSquared,j as b2Dot,hn as b2DynamicTree,Er as b2DynamicTree_Create,Fr as b2DynamicTree_CreateProxy,jr as b2DynamicTree_Destroy,Xr as b2DynamicTree_DestroyProxy,un as b2DynamicTree_EnlargeProxy,Zc as b2DynamicTree_GetAreaRatio,sl as b2DynamicTree_GetByteCount,Qc as b2DynamicTree_GetHeight,el as b2DynamicTree_GetMaxBalance,$c as b2DynamicTree_GetProxyCount,qr as b2DynamicTree_MoveProxy,ve as b2DynamicTree_Query,Gs as b2DynamicTree_RayCast,Rs as b2DynamicTree_Rebuild,ol as b2DynamicTree_RebuildBottomUp,Nn as b2DynamicTree_ShapeCast,nl as b2DynamicTree_ShiftOrigin,tl as b2DynamicTree_Validate,uo as b2Filter,nh as b2GetByteCount,ss as b2GetInverse22,Ye as b2GetLengthAndNormalize,Ga as b2GetLengthUnitsPerMeter,ih as b2GetMilliseconds,ah as b2GetMillisecondsAndReset,we as b2GetSweepTransform,rh as b2GetTicks,La as b2GetVersion,V as b2HexColor,Jn as b2Hull,X2 as b2IntegrateRotation,z2 as b2InvMulRot,Pi as b2InvMulTransforms,Ie as b2InvRotateVector,Re as b2InvTransformPoint,Ci as b2IsNormalized,ae as b2IsValid,Na as b2IsValidRay,zt as b2JointId,k as b2JointType,rp as b2Joint_GetBodyA,ip as b2Joint_GetBodyB,dp as b2Joint_GetCollideConnected,up as b2Joint_GetConstraintForce,hp as b2Joint_GetConstraintTorque,ap as b2Joint_GetLocalAnchorA,cp as b2Joint_GetLocalAnchorB,sp as b2Joint_GetType,pp as b2Joint_GetUserData,Qu as b2Joint_IsValid,lp as b2Joint_SetCollideConnected,bp as b2Joint_SetUserData,Hr as b2Joint_WakeBodies,le as b2LeftPerp,Yt as b2Length,be as b2LengthSquared,$t as b2Lerp,Fo as b2MakeBox,Ir as b2MakeOffsetBox,gs as b2MakeOffsetPolygon,sn as b2MakePolygon,vt as b2MakeProxy,Mi as b2MakeRot,Wa as b2MakeRoundedBox,xr as b2MakeSquare,To as b2Manifold,je as b2MassData,Ji as b2Max,P2 as b2MaxFloat,G2 as b2MaxInt,vi as b2Min,D2 as b2MinFloat,T2 as b2MinInt,$o as b2MotorJointDef,ub as b2MotorJoint_GetAngularOffset,Ib as b2MotorJoint_GetCorrectionFactor,bb as b2MotorJoint_GetLinearOffset,mb as b2MotorJoint_GetMaxForce,fb as b2MotorJoint_GetMaxTorque,pb as b2MotorJoint_SetAngularOffset,xb as b2MotorJoint_SetCorrectionFactor,db as b2MotorJoint_SetLinearOffset,hb as b2MotorJoint_SetMaxForce,yb as b2MotorJoint_SetMaxTorque,Qo as b2MouseJointDef,kb as b2MouseJoint_GetMaxForce,Db as b2MouseJoint_GetSpringDampingRatio,Jb as b2MouseJoint_GetSpringHertz,wb as b2MouseJoint_GetTarget,Pb as b2MouseJoint_SetMaxForce,Mb as b2MouseJoint_SetSpringDampingRatio,vb as b2MouseJoint_SetSpringHertz,Cb as b2MouseJoint_SetTarget,E2 as b2Mul,$ as b2MulAdd,ns as b2MulMV,Pa as b2MulRot,it as b2MulSV,yt as b2MulSub,H2 as b2MulTransforms,Di as b2NLerp,Ht as b2Neg,dt as b2Normalize,ki as b2NormalizeChecked,sr as b2NormalizeRot,gr as b2PointInCapsule,_r as b2PointInCircle,Br as b2PointInPolygon,ge as b2Polygon,Zo as b2PrismaticJointDef,$l as b2PrismaticJoint_EnableLimit,od as b2PrismaticJoint_EnableMotor,Wl as b2PrismaticJoint_EnableSpring,Zl as b2PrismaticJoint_GetLowerLimit,cd as b2PrismaticJoint_GetMaxMotorForce,id as b2PrismaticJoint_GetMotorForce,rd as b2PrismaticJoint_GetMotorSpeed,Hl as b2PrismaticJoint_GetSpringDampingRatio,zl as b2PrismaticJoint_GetSpringHertz,td as b2PrismaticJoint_GetUpperLimit,Ql as b2PrismaticJoint_IsLimitEnabled,nd as b2PrismaticJoint_IsMotorEnabled,Ol as b2PrismaticJoint_IsSpringEnabled,ed as b2PrismaticJoint_SetLimits,ad as b2PrismaticJoint_SetMaxMotorForce,sd as b2PrismaticJoint_SetMotorSpeed,Kl as b2PrismaticJoint_SetSpringDampingRatio,Ul as b2PrismaticJoint_SetSpringHertz,ms as b2QueryFilter,ws as b2RayCastCapsule,He as b2RayCastCircle,Po as b2RayCastInput,vs as b2RayCastPolygon,rn as b2RayCastSegment,ys as b2RayResult,oe as b2RelativeAngle,ho as b2RevoluteJointDef,gd as b2RevoluteJoint_EnableLimit,vd as b2RevoluteJoint_EnableMotor,md as b2RevoluteJoint_EnableSpring,_d as b2RevoluteJoint_GetAngle,Ad as b2RevoluteJoint_GetLowerLimit,Td as b2RevoluteJoint_GetMaxMotorTorque,Dd as b2RevoluteJoint_GetMotorSpeed,Pd as b2RevoluteJoint_GetMotorTorque,Sd as b2RevoluteJoint_GetSpringDampingRatio,xd as b2RevoluteJoint_GetSpringHertz,Cd as b2RevoluteJoint_GetUpperLimit,Bd as b2RevoluteJoint_IsLimitEnabled,Jd as b2RevoluteJoint_IsMotorEnabled,yd as b2RevoluteJoint_IsSpringEnabled,wd as b2RevoluteJoint_SetLimits,kd as b2RevoluteJoint_SetMaxMotorTorque,Md as b2RevoluteJoint_SetMotorSpeed,Id as b2RevoluteJoint_SetSpringDampingRatio,fd as b2RevoluteJoint_SetSpringHertz,de as b2RightPerp,rt as b2Rot,Y2 as b2Rot_GetAngle,N2 as b2Rot_GetXAxis,W2 as b2Rot_GetYAxis,$2 as b2Rot_IsValid,K as b2RotateVector,Oe as b2Segment,hr as b2SegmentDistance,is as b2SegmentDistanceResult,Gn as b2SensorEvents,oh as b2SetAllocator,Ra as b2SetAssertFcn,Ta as b2SetLengthUnitsPerMeter,jo as b2ShapeCast,Cr as b2ShapeCastCapsule,Ar as b2ShapeCastCircle,Ko as b2ShapeCastInput,co as b2ShapeCastPairInput,wr as b2ShapeCastPolygon,Js as b2ShapeCastSegment,us as b2ShapeDef,Be as b2ShapeDistance,St as b2ShapeId,Y as b2ShapeType,Sc as b2Shape_AreContactEventsEnabled,Ac as b2Shape_AreHitEventsEnabled,gc as b2Shape_ArePreSolveEventsEnabled,xc as b2Shape_AreSensorEventsEnabled,Ic as b2Shape_EnableContactEvents,Bc as b2Shape_EnableHitEvents,_c as b2Shape_EnablePreSolveEvents,fc as b2Shape_EnableSensorEvents,Xc as b2Shape_GetAABB,nc as b2Shape_GetBody,Mc as b2Shape_GetCapsule,Jc as b2Shape_GetChainSegment,wc as b2Shape_GetCircle,qc as b2Shape_GetClosestPoint,jc as b2Shape_GetContactCapacity,Fc as b2Shape_GetContactData,dc as b2Shape_GetDensity,mc as b2Shape_GetFilter,pc as b2Shape_GetFriction,Rc as b2Shape_GetParentChain,Dc as b2Shape_GetPolygon,hc as b2Shape_GetRestitution,vc as b2Shape_GetSegment,Cc as b2Shape_GetType,rc as b2Shape_GetUserData,ic as b2Shape_IsSensor,Hu as b2Shape_IsValid,cc as b2Shape_RayCast,kc as b2Shape_SetCapsule,Pc as b2Shape_SetCircle,lc as b2Shape_SetDensity,yc as b2Shape_SetFilter,bc as b2Shape_SetFriction,Gc as b2Shape_SetPolygon,uc as b2Shape_SetRestitution,Tc as b2Shape_SetSegment,sc as b2Shape_SetUserData,ac as b2Shape_TestPoint,Mn as b2Simplex,ch as b2SleepMilliseconds,zo as b2Solve22,J as b2Sub,lo as b2Sweep,cs as b2TOIInput,ls as b2TOIOutput,_s as b2TimeOfImpact,at as b2Transform,H as b2TransformPoint,Oa as b2TransformPolygon,wo as b2UnwindAngle,mr as b2ValidateHull,g as b2Vec2,rr as b2Vec2_IsValid,tn as b2WeldJointDef,Wb as b2WeldJoint_GetAngularDampingRatio,Yb as b2WeldJoint_GetAngularHertz,qb as b2WeldJoint_GetLinearDampingRatio,Fb as b2WeldJoint_GetLinearHertz,Nb as b2WeldJoint_SetAngularDampingRatio,Vb as b2WeldJoint_SetAngularHertz,Xb as b2WeldJoint_SetLinearDampingRatio,jb as b2WeldJoint_SetLinearHertz,en as b2WheelJointDef,Od as b2WheelJoint_EnableLimit,$d as b2WheelJoint_EnableMotor,Xd as b2WheelJoint_EnableSpring,zd as b2WheelJoint_GetLowerLimit,nb as b2WheelJoint_GetMaxMotorTorque,tb as b2WheelJoint_GetMotorSpeed,eb as b2WheelJoint_GetMotorTorque,Wd as b2WheelJoint_GetSpringDampingRatio,Yd as b2WheelJoint_GetSpringHertz,Kd as b2WheelJoint_GetUpperLimit,Ud as b2WheelJoint_IsLimitEnabled,Qd as b2WheelJoint_IsMotorEnabled,qd as b2WheelJoint_IsSpringEnabled,Hd as b2WheelJoint_SetLimits,ob as b2WheelJoint_SetMaxMotorTorque,Zd as b2WheelJoint_SetMotorSpeed,Nd as b2WheelJoint_SetSpringDampingRatio,Vd as b2WheelJoint_SetSpringHertz,bs as b2WorldDef,Jo as b2WorldId,h2 as b2World_CastCapsule,u2 as b2World_CastCircle,m2 as b2World_CastPolygon,d2 as b2World_CastRay,b2 as b2World_CastRayClosest,Nu as b2World_Draw,Vh as b2World_DumpMemoryStats,e2 as b2World_EnableContinuous,Zu as b2World_EnableSleeping,t2 as b2World_EnableWarmStarting,S2 as b2World_Explode,Wu as b2World_GetBodyEvents,Uu as b2World_GetContactEvents,qh as b2World_GetCounters,I2 as b2World_GetGravity,Xh as b2World_GetProfile,Ou as b2World_GetSensorEvents,zu as b2World_IsValid,r2 as b2World_OverlapAABB,c2 as b2World_OverlapCapsule,a2 as b2World_OverlapCircle,l2 as b2World_OverlapPolygon,s2 as b2World_SetContactTuning,f2 as b2World_SetCustomFilterCallback,x2 as b2World_SetGravity,n2 as b2World_SetHitEventThreshold,y2 as b2World_SetPreSolveCallback,o2 as b2World_SetRestitutionThreshold,gi as b2World_Step,lh as b2Yield,Wh as mpx,Oh as pxm,or as pxmVec2};
